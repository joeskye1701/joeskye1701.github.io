<!DOCTYPE html>
<html lang="zh">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
<title>分类: JDK6 源码 - Joe|博客</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



    <meta property="og:type" content="website">
<meta property="og:title" content="Joe|博客">
<meta property="og:url" content="https://joeskye1701.github.io/categories/JDK6-源码/page/2/index.html">
<meta property="og:site_name" content="Joe|博客">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Joe|博客">





<link rel="icon" href="/images/thank-you-kobe.jpg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/xcode.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    

    
    
<script>
var _hmt = _hmt || [];
(function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?c422b171d3bdb7dbfae47ff3f70f9d30";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
})();
</script>

    
    

    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    

    
    
    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                Joe|博客
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item" href="/">主页</a>
                
                <a class="navbar-item" href="/archives">归档</a>
                
                <a class="navbar-item" href="/categories">分类</a>
                
                <a class="navbar-item" href="/tags">标签</a>
                
                <a class="navbar-item" href="/about">关于</a>
                
            </div>
            
            <div class="navbar-end">
                
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main"><div class="card">
    <div class="card-content">
        <nav class="breadcrumb" aria-label="breadcrumbs">
        <ul>
            <li><a href="/categories">分类</a></li>
            
            <li class="is-active"><a href="#" aria-current="page">JDK6 源码</a></li>
        </ul>
        </nav>
    </div>
</div>

    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2016-07-07T04:37:22.000Z">2016-07-07</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/JDK6-源码/">JDK6 源码</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    18 分钟 读完 (大约 2651 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/JDK1.6-Executors/">JDK1.6 Executors</a>
            
        </h1>
        <div class="content">
            <!-- TOC -->
<ul>
<li><a href="#1-介绍">1 介绍</a></li>
<li><a href="#2-源码解析">2 源码解析</a><ul>
<li><a href="#executorsnewfixedthreadpool">Executors#newFixedThreadPool()</a></li>
<li><a href="#executorsnewfixedthreadpoolthreadfactory">Executors#newFixedThreadPool(ThreadFactory)</a></li>
<li><a href="#executorsnewsinglethreadexecutor">Executors#newSingleThreadExecutor()</a></li>
<li><a href="#executorsfinalizabledelegatedexecutorservice">Executors#FinalizableDelegatedExecutorService</a></li>
<li><a href="#executorsdelegatedexecutorservice">Executors#DelegatedExecutorService</a></li>
<li><a href="#executorsnewcachedthreadpool">Executors#newCachedThreadPool()</a></li>
<li><a href="#executorsunconfigurableexecutorservice">Executors#unconfigurableExecutorService()</a></li>
<li><a href="#executorsnewscheduledthreadpool">Executors#newScheduledThreadPool()</a></li>
<li><a href="#executorsnewsinglethreadscheduledexecutor">Executors#newSingleThreadScheduledExecutor()</a></li>
<li><a href="#executorsdelegatedscheduledexecutorservice">Executors#DelegatedScheduledExecutorService</a></li>
<li><a href="#executorsunconfigurablescheduledexecutorservice">Executors#unconfigurableScheduledExecutorService()</a></li>
<li><a href="#executorsdefaultthreadfactory">Executors#DefaultThreadFactory()</a></li>
<li><a href="#executorsprivilegedthreadfactory">Executors#PrivilegedThreadFactory()</a></li>
<li><a href="#executorscallable">Executors#callable()</a></li>
<li><a href="#executorsrunnableadapter">Executors#RunnableAdapter()</a></li>
<li><a href="#executorsprivilegedcallable">Executors#PrivilegedCallable</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h1 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1 介绍"></a>1 介绍</h1><p>Executors是JUC包提供的一个工具性质的帮助类，它针对ExecutorService、ScheduledExecutorService、ThreadFactory和Callable提供了一系列工厂方法和工具方法。</p>
<h1 id="2-源码解析"><a href="#2-源码解析" class="headerlink" title="2 源码解析"></a>2 源码解析</h1><h2 id="Executors-newFixedThreadPool"><a href="#Executors-newFixedThreadPool" class="headerlink" title="Executors#newFixedThreadPool()"></a>Executors#newFixedThreadPool()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Creates a thread pool that reuses a fixed number of threads</span></span><br><span class="line"><span class="hljs-comment"> * operating off a shared unbounded queue.  At any point, at most</span></span><br><span class="line"><span class="hljs-comment"> * &lt;tt&gt;nThreads&lt;/tt&gt; threads will be active processing tasks.</span></span><br><span class="line"><span class="hljs-comment"> * If additional tasks are submitted when all threads are active,</span></span><br><span class="line"><span class="hljs-comment"> * they will wait in the queue until a thread is available.</span></span><br><span class="line"><span class="hljs-comment"> * If any thread terminates due to a failure during execution</span></span><br><span class="line"><span class="hljs-comment"> * prior to shutdown, a new one will take its place if needed to</span></span><br><span class="line"><span class="hljs-comment"> * execute subsequent tasks.  The threads in the pool will exist</span></span><br><span class="line"><span class="hljs-comment"> * until it is explicitly &#123;<span class="hljs-doctag">@link</span> ExecutorService#shutdown shutdown&#125;.</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> nThreads the number of threads in the pool</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> the newly created thread pool</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> IllegalArgumentException if &lt;tt&gt;nThreads &amp;lt;= 0&lt;/tt&gt;</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-title">newFixedThreadPool</span><span class="hljs-params">(<span class="hljs-keyword">int</span> nThreads)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ThreadPoolExecutor(nThreads, nThreads,</span><br><span class="line">                                  <span class="hljs-number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                  <span class="hljs-keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>这个方法创建了一个核心线程数量和最大线程数量一致的，并且任务队列是无界队列的线程池。</li>
<li>由于默认核心线程不会超时，所以超时相关的参数也没有意义。</li>
<li>如果在线程关闭之前，一个工作线程由于某种原因挂了，那么线程池会自动补上一个新的工作线程。</li>
</ul>
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/JDK1.6-Executors/#more">阅读更多</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2016-07-03T04:37:22.000Z">2016-07-03</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/JDK6-源码/">JDK6 源码</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    10 分钟 读完 (大约 1520 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/JDK1.6-ExecutorCompletionService/">JDK1.6 ExecutorCompletionService</a>
            
        </h1>
        <div class="content">
            <!-- TOC -->
<ul>
<li><a href="#1-介绍">1 介绍</a></li>
<li><a href="#2-源码分析">2 源码分析</a><ul>
<li><a href="#completionservice">CompletionService()</a></li>
<li><a href="#executorcompletionservicequeueingfuture">ExecutorCompletionService#QueueingFuture</a></li>
<li><a href="#executorcompletionservice-构造函数">ExecutorCompletionService 构造函数</a></li>
<li><a href="#executorcompletionservicenewtaskfor">ExecutorCompletionService#newTaskFor()</a></li>
<li><a href="#abstractexecutorservicenewtaskfor">AbstractExecutorService#newTaskFor</a></li>
<li><a href="#executorcompletionservicesubmit">ExecutorCompletionService#submit()</a></li>
<li><a href="#executor-接口">Executor 接口</a></li>
<li><a href="#scheduledthreadpoolexecutorexecute">ScheduledThreadPoolExecutor#execute()</a></li>
<li><a href="#futuretaskdone">FutureTask#done()</a></li>
<li><a href="#executorcompletionservicequeueingfuture">ExecutorCompletionService#QueueingFuture</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h1 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1 介绍"></a>1 介绍</h1><p>ExecutorCompletionService用于执行一批任务，然后按照任务执行完成的顺序来获取任务结果。可以在获取到了若干个执行结果后，把其他的任务取消掉(ThreadPoolExecutor中的invokeAny就是通过这货实现的)。<br>比如这样的场景：你的业务需要调用10个接口来获取一些信息，业务规定只需要其中任意2个接口的信息，那么就可以使用ExecutorCompletionService，获取前两个成功完成的任务结果，然后将其他的任务取消。</p>
<h1 id="2-源码分析"><a href="#2-源码分析" class="headerlink" title="2 源码分析"></a>2 源码分析</h1><p>ExecutorCompletionService实现CompletionService接口。</p>
<h2 id="CompletionService"><a href="#CompletionService" class="headerlink" title="CompletionService()"></a>CompletionService()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CompletionService</span>&lt;<span class="hljs-title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Submits a value-returning task for execution and returns a Future</span></span><br><span class="line"><span class="hljs-comment">     * representing the pending results of the task.  Upon completion,</span></span><br><span class="line"><span class="hljs-comment">     * this task may be taken or polled.</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> task the task to submit</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> a Future representing pending completion of the task</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> RejectedExecutionException if the task cannot be</span></span><br><span class="line"><span class="hljs-comment">     *         scheduled for execution</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> NullPointerException if the task is null</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-comment">// 1</span></span><br><span class="line">    <span class="hljs-function">Future&lt;V&gt; <span class="hljs-title">submit</span><span class="hljs-params">(Callable&lt;V&gt; task)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Submits a Runnable task for execution and returns a Future</span></span><br><span class="line"><span class="hljs-comment">     * representing that task.  Upon completion, this task may be</span></span><br><span class="line"><span class="hljs-comment">     * taken or polled.</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> task the task to submit</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> result the result to return upon successful completion</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> a Future representing pending completion of the task,</span></span><br><span class="line"><span class="hljs-comment">     *         and whose &lt;tt&gt;get()&lt;/tt&gt; method will return the given</span></span><br><span class="line"><span class="hljs-comment">     *         result value upon completion</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> RejectedExecutionException if the task cannot be</span></span><br><span class="line"><span class="hljs-comment">     *         scheduled for execution</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> NullPointerException if the task is null</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-comment">// 2</span></span><br><span class="line">    <span class="hljs-function">Future&lt;V&gt; <span class="hljs-title">submit</span><span class="hljs-params">(Runnable task, V result)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Retrieves and removes the Future representing the next</span></span><br><span class="line"><span class="hljs-comment">     * completed task, waiting if none are yet present.</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> the Future representing the next completed task</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> InterruptedException if interrupted while waiting</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-comment">// 3</span></span><br><span class="line">    <span class="hljs-function">Future&lt;V&gt; <span class="hljs-title">take</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Retrieves and removes the Future representing the next</span></span><br><span class="line"><span class="hljs-comment">     * completed task or &lt;tt&gt;null&lt;/tt&gt; if none are present.</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> the Future representing the next completed task, or</span></span><br><span class="line"><span class="hljs-comment">     *         &lt;tt&gt;null&lt;/tt&gt; if none are present</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-comment">// 4</span></span><br><span class="line">    <span class="hljs-function">Future&lt;V&gt; <span class="hljs-title">poll</span><span class="hljs-params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Retrieves and removes the Future representing the next</span></span><br><span class="line"><span class="hljs-comment">     * completed task, waiting if necessary up to the specified wait</span></span><br><span class="line"><span class="hljs-comment">     * time if none are yet present.</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> timeout how long to wait before giving up, in units of</span></span><br><span class="line"><span class="hljs-comment">     *        &lt;tt&gt;unit&lt;/tt&gt;</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> unit a &lt;tt&gt;TimeUnit&lt;/tt&gt; determining how to interpret the</span></span><br><span class="line"><span class="hljs-comment">     *        &lt;tt&gt;timeout&lt;/tt&gt; parameter</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> the Future representing the next completed task or</span></span><br><span class="line"><span class="hljs-comment">     *         &lt;tt&gt;null&lt;/tt&gt; if the specified waiting time elapses</span></span><br><span class="line"><span class="hljs-comment">     *         before one is present</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> InterruptedException if interrupted while waiting</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-comment">// 5</span></span><br><span class="line">    <span class="hljs-function">Future&lt;V&gt; <span class="hljs-title">poll</span><span class="hljs-params">(<span class="hljs-keyword">long</span> timeout, TimeUnit unit)</span> <span class="hljs-keyword">throws</span> InterruptedException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>标注代码分析</p>
<ol>
<li>提交一个有返回值的任务。</li>
<li>提交一个Runnable和一个返回值。</li>
<li>获取并移除下一个完成的任务，如果当前没有任务完成，阻塞等待。</li>
<li>获取并移除下一个完成的任务，如果当前没有任务完成，返回null。</li>
<li>获取并移除下一个完成的任务，如果当前没有任务完成，阻塞等待，如果在超时前仍然没有任务完成，返回null。</li>
</ol>
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/JDK1.6-ExecutorCompletionService/#more">阅读更多</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2016-06-01T04:37:22.000Z">2016-06-01</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/JDK6-源码/">JDK6 源码</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    17 分钟 读完 (大约 2621 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/JDK1.6-CyclicBarrier/">JDK1.6 CyclicBarrier</a>
            
        </h1>
        <div class="content">
            <!-- TOC -->
<ul>
<li><a href="#1-介绍">1 介绍</a></li>
<li><a href="#2-源码分析">2 源码分析</a><ul>
<li><a href="#cyclicbarrierawait">CyclicBarrier#await()</a></li>
<li><a href="#cyclicbarrierdowait">CyclicBarrier#dowait()</a></li>
<li><a href="#cyclicbarriernextgeneration">CyclicBarrier#nextGeneration()</a></li>
<li><a href="#cyclicbarrierbreakbarrier">CyclicBarrier#breakBarrier()</a></li>
<li><a href="#cyclicbarrier">CyclicBarrier</a></li>
</ul>
</li>
<li><a href="#3-总结">3 总结</a></li>
</ul>
<!-- /TOC -->
<h1 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1 介绍"></a>1 介绍</h1><ol>
<li>CyclicBarrier是一种可重复使用的栅栏机制，可以让一组线程在某个点上相互等待，这个点就可以类比为栅栏。并且这个栅栏是可重复使用的，这点可以和前面分析过的CountDownLatch做对比，CountDownLatch只能用一次。</li>
<li>CyclicBarrier还支持在所有线程到达栅栏之后，在所有线程从等待状态转到可运行状态之前，执行一个命令(或者说是动作)。当然，在某些情况下，栅栏可以被打破。比如某个线程无法在规定的时间内到达栅栏。</li>
</ol>
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/JDK1.6-CyclicBarrier/#more">阅读更多</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2016-05-27T04:37:22.000Z">2016-05-27</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/JDK6-源码/">JDK6 源码</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    9 分钟 读完 (大约 1357 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/JDK1.6-CountDownLatch/">JDK1.6 CountDownLatch</a>
            
        </h1>
        <div class="content">
            <!-- TOC -->
<ul>
<li><a href="#1-介绍countdownlatch">1 介绍CountDownLatch</a></li>
<li><a href="#2-源码分析">2 源码分析</a><ul>
<li><a href="#countdownlatchsync">CountDownLatch#Sync</a></li>
<li><a href="#countdownlatch">CountDownLatch</a></li>
</ul>
</li>
<li><a href="#3-总结">3 总结</a></li>
</ul>
<!-- /TOC -->
<h1 id="1-介绍CountDownLatch"><a href="#1-介绍CountDownLatch" class="headerlink" title="1 介绍CountDownLatch"></a>1 介绍CountDownLatch</h1><p>一种锁，称为闭锁。可以让一个或多个线程等待另外一个或多个线程执行完毕后再执行。<br>CountDownLatch是基于AQS构建，使用共享模式。<br>CountDownLatch中提供一个count值来表示要等待的(其他任务)完成次数，常规用法有两种：Count(1)和Count(N)。举个栗子，百米赛跑，N个选手，每个选手可以看成是一个线程。起跑前，选手准备(线程启动，然后在Count(1)上阻塞)，当发令枪响后(相当于Count(1)闭锁释放)，选手一起起跑(相当于线程通过Count(1)继续执行)，当所有选手都通过终点(相当于Count(N)闭锁释放)，然后再统计成绩。</p>
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/JDK1.6-CountDownLatch/#more">阅读更多</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2016-05-10T04:37:22.000Z">2016-05-10</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/JDK6-源码/">JDK6 源码</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    几秒 读完 (大约 78 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/JDK1.6-ConcurrentSkipListSet/">JDK1.6 ConcurrentSkipListSet</a>
            
        </h1>
        <div class="content">
            <p>ConcurrentSkipListSet基于ConcurrentSkipListMap实现。<br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConcurrentSkipListSet</span>&lt;<span class="hljs-title">E</span>&gt;</span></span><br><span class="line"><span class="hljs-class">    <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractSet</span>&lt;<span class="hljs-title">E</span>&gt;</span></span><br><span class="line"><span class="hljs-class">    <span class="hljs-keyword">implements</span> <span class="hljs-title">NavigableSet</span>&lt;<span class="hljs-title">E</span>&gt;, <span class="hljs-title">Cloneable</span>, <span class="hljs-title">java</span>.<span class="hljs-title">io</span>.<span class="hljs-title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = -<span class="hljs-number">2479143111061671589L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * The underlying map. Uses Boolean.TRUE as value for each</span></span><br><span class="line"><span class="hljs-comment">     * element.  This field is declared final for the sake of thread</span></span><br><span class="line"><span class="hljs-comment">     * safety, which entails some ugliness in clone()</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentNavigableMap&lt;E,Object&gt; m;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Constructs a new, empty set that orders its elements according to</span></span><br><span class="line"><span class="hljs-comment">     * their &#123;<span class="hljs-doctag">@linkplain</span> Comparable natural ordering&#125;.</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ConcurrentSkipListSet</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        m = <span class="hljs-keyword">new</span> ConcurrentSkipListMap&lt;E,Object&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure></p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2016-05-08T04:37:22.000Z">2016-05-08</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/JDK6-源码/">JDK6 源码</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    33 分钟 读完 (大约 4877 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/JDK1.6-ConcurrentSkipListMap/">JDK1.6 ConcurrentSkipListMap</a>
            
        </h1>
        <div class="content">
            <!-- TOC -->
<ul>
<li><a href="#1-介绍">1 介绍</a></li>
<li><a href="#2-源码分析">2 源码分析</a><ul>
<li><a href="#数据结构">数据结构</a></li>
<li><a href="#concurrentskiplistmapnodek-key-object-value-nodekv-next">ConcurrentSkipListMap#Node(K key, Object value, Node&lt;K,V&gt; next)</a></li>
<li><a href="#concurrentskiplistmapnodenodekv-next">ConcurrentSkipListMap#Node(Node&lt;K,V&gt; next)</a></li>
<li><a href="#concurrentskiplistmapnode原子更新">ConcurrentSkipListMap#Node#原子更新</a></li>
<li><a href="#concurrentskiplistmapnodehelpdelete">ConcurrentSkipListMap#Node#helpDelete()</a></li>
<li><a href="#concurrentskiplistmapindex属性">ConcurrentSkipListMap#Index属性</a></li>
<li><a href="#concurrentskiplistmapindexlink">ConcurrentSkipListMap#Index#link()</a></li>
<li><a href="#concurrentskiplistmapindexunlink">ConcurrentSkipListMap#Index#unlink()</a></li>
<li><a href="#concurrentskiplistmapheadindex">ConcurrentSkipListMap#HeadIndex</a></li>
<li><a href="#concurrentskiplistmap属性">ConcurrentSkipListMap属性</a></li>
<li><a href="#concurrentskiplistmap构造方法">ConcurrentSkipListMap构造方法</a></li>
<li><a href="#concurrentskiplistmapinitialize">ConcurrentSkipListMap#initialize()</a></li>
<li><a href="#concurrentskiplistmapput">ConcurrentSkipListMap#put()</a></li>
<li><a href="#concurrentskiplistmapdoput">ConcurrentSkipListMap#doPut</a></li>
<li><a href="#concurrentskiplistmapcomparable">ConcurrentSkipListMap#comparable()</a></li>
<li><a href="#concurrentskiplistmapaddindex">ConcurrentSkipListMap#addIndex()</a></li>
<li><a href="#concurrentskiplistmapfindpredecessor">ConcurrentSkipListMap#findPredecessor()</a></li>
<li><a href="#concurrentskiplistmaprandomlevel">ConcurrentSkipListMap#randomLevel()</a></li>
<li><a href="#concurrentskiplistmapinsertindex">ConcurrentSkipListMap#insertIndex()</a></li>
<li><a href="#concurrentskiplistmapaddindex">ConcurrentSkipListMap#addIndex()</a></li>
<li><a href="#concurrentskiplistmapfindnode">ConcurrentSkipListMap#findNode()</a></li>
<li><a href="#put总结">put()总结</a></li>
<li><a href="#concurrentskiplistmapget">ConcurrentSkipListMap#get()</a></li>
<li><a href="#concurrentskiplistmapdoget">ConcurrentSkipListMap#doGet()</a></li>
<li><a href="#concurrentskiplistmapgetusingfindnode">ConcurrentSkipListMap#getUsingFindNode()</a></li>
<li><a href="#concurrentskiplistmapcontainskey">ConcurrentSkipListMap#containsKey()</a></li>
<li><a href="#concurrentskiplistmapremove">ConcurrentSkipListMap#remove()</a></li>
<li><a href="#concurrentskiplistmapdoremove">ConcurrentSkipListMap#doRemove()</a></li>
<li><a href="#concurrentskiplistmaptryreducelevel">ConcurrentSkipListMap#tryReduceLevel()</a></li>
<li><a href="#concurrentskiplistmapcontainsvalue">ConcurrentSkipListMap#containsValue()</a></li>
<li><a href="#concurrentskiplistmapfindfirst">ConcurrentSkipListMap#findFirst()</a></li>
<li><a href="#concurrentskiplistmapsize">ConcurrentSkipListMap#size()</a></li>
<li><a href="#concurrentskiplistmapisempty">ConcurrentSkipListMap#isEmpty()</a></li>
<li><a href="#concurrentskiplistmaplastkey">ConcurrentSkipListMap#lastKey()</a></li>
<li><a href="#concurrentskiplistmapfindlast">ConcurrentSkipListMap#findLast()</a></li>
<li><a href="#concurrentskiplistmaplowerentry">ConcurrentSkipListMap#lowerEntry()</a></li>
<li><a href="#concurrentskiplistmapgetnear">ConcurrentSkipListMap#getNear()</a></li>
<li><a href="#concurrentskiplistmapfindnear">ConcurrentSkipListMap#findNear()</a></li>
<li><a href="#concurrentskiplistmapfloorentry">ConcurrentSkipListMap#floorEntry()</a></li>
<li><a href="#concurrentskiplistmapceilingentry">ConcurrentSkipListMap#ceilingEntry()</a></li>
<li><a href="#concurrentskiplistmaphigherentry">ConcurrentSkipListMap#higherEntry()</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h1 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1 介绍"></a>1 介绍</h1><p>ConcurrentSkipListMap是一种线程安全的有序的Map。一般我们使用有序Map，不要求线程安全的情况下，可以使用TreeMap，要求线程安全的话，就可以使用ConcurrentSkipListMap。<br>ConcurrentSkipListMap内部的数据结构是SkipList(跳表)，内部Entry顺序是由实现了Comparable的key或者构造时指定的Comparator来保证。和TreeMap一样，对ConcurrentSkipListMap中元素的put()、get()和remove()等操作的平均时间复杂度也是O(log(n))。</p>
<h1 id="2-源码分析"><a href="#2-源码分析" class="headerlink" title="2 源码分析"></a>2 源码分析</h1><h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><p>源码中也提供图形化的注释。<br>有3中节点：Head节点、Index节点和普通的Node节点。<br><img src="./skiplistMap-1.gif" alt><br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">* Head nodes          Index nodes</span><br><span class="line">* +-+    right        +-+                      +-+</span><br><span class="line">* |2|----------------&gt;| |---------------------&gt;| |-&gt;null</span><br><span class="line">* +-+                 +-+                      +-+</span><br><span class="line">*  | down              |                        |</span><br><span class="line">*  v                   v                        v</span><br><span class="line">* +-+            +-+  +-+       +-+            +-+       +-+</span><br><span class="line">* |1|-----------&gt;| |-&gt;| |------&gt;| |-----------&gt;| |------&gt;| |-&gt;null</span><br><span class="line">* +-+            +-+  +-+       +-+            +-+       +-+</span><br><span class="line">*  v              |    |         |              |         |</span><br><span class="line">* Nodes  next     v    v         v              v         v</span><br><span class="line">* +-+  +-+  +-+  +-+  +-+  +-+  +-+  +-+  +-+  +-+  +-+  +-+</span><br><span class="line">* | |-&gt;|A|-&gt;|B|-&gt;|C|-&gt;|D|-&gt;|E|-&gt;|F|-&gt;|G|-&gt;|H|-&gt;|I|-&gt;|J|-&gt;|K|-&gt;null</span><br><span class="line">* +-+  +-+  +-+  +-+  +-+  +-+  +-+  +-+  +-+  +-+  +-+  +-+</span><br></pre></td></tr></table></figure></p>
<h2 id="ConcurrentSkipListMap-Node-K-key-Object-value-Node-lt-K-V-gt-next"><a href="#ConcurrentSkipListMap-Node-K-key-Object-value-Node-lt-K-V-gt-next" class="headerlink" title="ConcurrentSkipListMap#Node(K key, Object value, Node&lt;K,V&gt; next)"></a>ConcurrentSkipListMap#Node(K key, Object value, Node&lt;K,V&gt; next)</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">         * Creates a new regular node.</span></span><br><span class="line"><span class="hljs-comment">         */</span></span><br><span class="line">        Node(K key, Object value, Node&lt;K,V&gt; next) &#123;</span><br><span class="line">            <span class="hljs-keyword">this</span>.key = key;</span><br><span class="line">            <span class="hljs-keyword">this</span>.value = value;</span><br><span class="line">            <span class="hljs-keyword">this</span>.next = next;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>创建一个普通节点。</p>
<h2 id="ConcurrentSkipListMap-Node-Node-lt-K-V-gt-next"><a href="#ConcurrentSkipListMap-Node-Node-lt-K-V-gt-next" class="headerlink" title="ConcurrentSkipListMap#Node(Node&lt;K,V&gt; next)"></a>ConcurrentSkipListMap#Node(Node&lt;K,V&gt; next)</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">        <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">         * Creates a new marker node. A marker is distinguished by</span></span><br><span class="line"><span class="hljs-comment">         * having its value field point to itself.  Marker nodes also</span></span><br><span class="line"><span class="hljs-comment">         * have null keys, a fact that is exploited in a few places,</span></span><br><span class="line"><span class="hljs-comment">         * but this doesn't distinguish markers from the base-level</span></span><br><span class="line"><span class="hljs-comment">         * header node (head.node), which also has a null key.</span></span><br><span class="line"><span class="hljs-comment">         */</span></span><br><span class="line">        Node(Node&lt;K,V&gt; next) &#123;</span><br><span class="line">            <span class="hljs-keyword">this</span>.key = <span class="hljs-keyword">null</span>;</span><br><span class="line">            <span class="hljs-keyword">this</span>.value = <span class="hljs-keyword">this</span>;</span><br><span class="line">            <span class="hljs-keyword">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">``` </span><br><span class="line">创建一个标记节点。key==<span class="hljs-keyword">null</span>无法区分标记节点和base-level链表头节点，因为base-level链表头节点的key也是<span class="hljs-keyword">null</span>。</span><br><span class="line"></span><br><span class="line">&lt;!-- more --&gt;</span><br><span class="line">## ConcurrentSkipListMap#Node#原子更新</span><br><span class="line">指定的<span class="hljs-keyword">volatile</span>引用字段进行原子更新。</span><br><span class="line">``` java</span><br><span class="line">       <span class="hljs-comment">/** Updater for casNext */</span></span><br><span class="line">        <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> AtomicReferenceFieldUpdater&lt;Node, Node&gt;</span><br><span class="line">            nextUpdater = AtomicReferenceFieldUpdater.newUpdater</span><br><span class="line">            (Node.class, Node.class, <span class="hljs-string">"next"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">/** Updater for casValue */</span></span><br><span class="line">        <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> AtomicReferenceFieldUpdater&lt;Node, Object&gt;</span><br><span class="line">            valueUpdater = AtomicReferenceFieldUpdater.newUpdater</span><br><span class="line">            (Node.class, Object.class, <span class="hljs-string">"value"</span>);</span><br></pre></td></tr></table></figure>
<p>nextUpdater和valueUpdater分别对next、value进行更新</p>
<h2 id="ConcurrentSkipListMap-Node-helpDelete"><a href="#ConcurrentSkipListMap-Node-helpDelete" class="headerlink" title="ConcurrentSkipListMap#Node#helpDelete()"></a>ConcurrentSkipListMap#Node#helpDelete()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">helpDelete</span><span class="hljs-params">(Node&lt;K,V&gt; b, Node&lt;K,V&gt; f)</span> </span>&#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (f == next &amp;&amp; <span class="hljs-keyword">this</span> == b.next) &#123;</span><br><span class="line">                <span class="hljs-comment">// 1</span></span><br><span class="line">                <span class="hljs-keyword">if</span> (f == <span class="hljs-keyword">null</span> || f.value != f) <span class="hljs-comment">// not already marked</span></span><br><span class="line">                    appendMarker(f);</span><br><span class="line">                <span class="hljs-keyword">else</span> <span class="hljs-comment">// 2</span></span><br><span class="line">                    b.casNext(<span class="hljs-keyword">this</span>, f.next);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>标注代码分析</p>
<ol>
<li>后继节点f是null，新增一个节点标记(marker)。</li>
<li><p>删除节点b与f.next之间的节点，b#next指向f#next。</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">     +------+       +------+      +------+</span><br><span class="line">...  |   b  |------&gt;|   n  |-----&gt;|   f  | ...</span><br><span class="line">     +------+       +------+      +------+</span><br><span class="line">    </span><br><span class="line">     +------+       +------+      +------+       +------+</span><br><span class="line">...  |   b  |------&gt;|   n  |-----&gt;|marker|------&gt;|   f  | ...</span><br><span class="line">     +------+       +------+      +------+       +------+</span><br><span class="line">  </span><br><span class="line">     +------+                                    +------+</span><br><span class="line">...  |   b  |-----------------------------------&gt;|   f  | ...</span><br><span class="line">     +------+                                    +------+</span><br></pre></td></tr></table></figure>
</li>
<li><p>当前节点为n，n的前驱节点为b，n的后继节点为f。</p>
</li>
<li>现在要删除节点n，那么首先要对n进行标记。要删除节点n，首先是往节点n后面追加一个标记节点。</li>
<li>直接将节点n和后面的标记节点一起删除。</li>
</ol>
<h2 id="ConcurrentSkipListMap-Index属性"><a href="#ConcurrentSkipListMap-Index属性" class="headerlink" title="ConcurrentSkipListMap#Index属性"></a>ConcurrentSkipListMap#Index属性</h2><p>Index节点表示跳表的层级。<br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 1</span></span><br><span class="line"><span class="hljs-keyword">final</span> Node&lt;K,V&gt; node;</span><br><span class="line"><span class="hljs-comment">// 2</span></span><br><span class="line"><span class="hljs-keyword">final</span> Index&lt;K,V&gt; down;</span><br><span class="line"><span class="hljs-comment">// 3</span></span><br><span class="line"><span class="hljs-keyword">volatile</span> Index&lt;K,V&gt; right;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-comment">/** Updater for casRight */</span></span><br><span class="line"><span class="hljs-comment">// 4</span></span><br><span class="line"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> AtomicReferenceFieldUpdater&lt;Index, Index&gt;</span><br><span class="line">    rightUpdater = AtomicReferenceFieldUpdater.newUpdater</span><br><span class="line">    (Index.class, Index.class, <span class="hljs-string">"right"</span>);</span><br></pre></td></tr></table></figure></p>
<p>标注代码分析</p>
<ol>
<li>索引指向的节点, 纵向上所有索引指向链表最下面的节点。</li>
<li>下level层的Index。</li>
<li>右边的Index。</li>
<li>原子更新right属性。</li>
</ol>
<h2 id="ConcurrentSkipListMap-Index-link"><a href="#ConcurrentSkipListMap-Index-link" class="headerlink" title="ConcurrentSkipListMap#Index#link()"></a>ConcurrentSkipListMap#Index#link()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">link</span><span class="hljs-params">(Index&lt;K,V&gt; succ, Index&lt;K,V&gt; newSucc)</span> </span>&#123;</span><br><span class="line">            Node&lt;K,V&gt; n = node;</span><br><span class="line">            newSucc.right = succ;</span><br><span class="line">            <span class="hljs-keyword">return</span> n.value != <span class="hljs-keyword">null</span> &amp;&amp; casRight(succ, newSucc);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>在index本身和succ之间插入一个新的节点newSucc。</p>
<h2 id="ConcurrentSkipListMap-Index-unlink"><a href="#ConcurrentSkipListMap-Index-unlink" class="headerlink" title="ConcurrentSkipListMap#Index#unlink()"></a>ConcurrentSkipListMap#Index#unlink()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">unlink</span><span class="hljs-params">(Index&lt;K,V&gt; succ)</span> </span>&#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> !indexesDeletedNode() &amp;&amp; casRight(succ, succ.right);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>将当前的节点index设置其的right为 succ.right等于删除succ节点。</p>
<h2 id="ConcurrentSkipListMap-HeadIndex"><a href="#ConcurrentSkipListMap-HeadIndex" class="headerlink" title="ConcurrentSkipListMap#HeadIndex"></a>ConcurrentSkipListMap#HeadIndex</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Nodes heading each level keep track of their level.</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HeadIndex</span>&lt;<span class="hljs-title">K</span>,<span class="hljs-title">V</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">Index</span>&lt;<span class="hljs-title">K</span>,<span class="hljs-title">V</span>&gt; </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> level;</span><br><span class="line">        HeadIndex(Node&lt;K,V&gt; node, Index&lt;K,V&gt; down, Index&lt;K,V&gt; right, <span class="hljs-keyword">int</span> level) &#123;</span><br><span class="line">            <span class="hljs-keyword">super</span>(node, down, right);</span><br><span class="line">            <span class="hljs-keyword">this</span>.level = level;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>头索引节点，只是增加level属性用来标示索引层级。</p>
<h2 id="ConcurrentSkipListMap属性"><a href="#ConcurrentSkipListMap属性" class="headerlink" title="ConcurrentSkipListMap属性"></a>ConcurrentSkipListMap属性</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">   * Special value used to identify base-level header</span></span><br><span class="line"><span class="hljs-comment">   */</span></span><br><span class="line">  <span class="hljs-comment">// 1</span></span><br><span class="line">  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Object BASE_HEADER = <span class="hljs-keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">  <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">   * The topmost head index of the skiplist.</span></span><br><span class="line"><span class="hljs-comment">   */</span></span><br><span class="line">  <span class="hljs-comment">// 2</span></span><br><span class="line">  <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> HeadIndex&lt;K,V&gt; head;</span><br></pre></td></tr></table></figure>
<p>标注代码分析</p>
<ol>
<li>用来定义base-level的头结点。</li>
<li>跳表最高层的head index。 </li>
</ol>
<h2 id="ConcurrentSkipListMap构造方法"><a href="#ConcurrentSkipListMap构造方法" class="headerlink" title="ConcurrentSkipListMap构造方法"></a>ConcurrentSkipListMap构造方法</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">  * Constructs a new, empty map, sorted according to the</span></span><br><span class="line"><span class="hljs-comment">  * &#123;<span class="hljs-doctag">@linkplain</span> Comparable natural ordering&#125; of the keys.</span></span><br><span class="line"><span class="hljs-comment">  */</span></span><br><span class="line"> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ConcurrentSkipListMap</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">     <span class="hljs-keyword">this</span>.comparator = <span class="hljs-keyword">null</span>;</span><br><span class="line">     initialize();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>keys排序，并且调用ConcurrentSkipListMap#initialize()。</p>
<h2 id="ConcurrentSkipListMap-initialize"><a href="#ConcurrentSkipListMap-initialize" class="headerlink" title="ConcurrentSkipListMap#initialize()"></a>ConcurrentSkipListMap#initialize()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Initializes or resets state. Needed by constructors, clone,</span></span><br><span class="line"><span class="hljs-comment"> * clear, readObject. and ConcurrentSkipListSet.clone.</span></span><br><span class="line"><span class="hljs-comment"> * (Note that comparator must be separately initialized.)</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initialize</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    keySet = <span class="hljs-keyword">null</span>;</span><br><span class="line">    entrySet = <span class="hljs-keyword">null</span>;</span><br><span class="line">    values = <span class="hljs-keyword">null</span>;</span><br><span class="line">    descendingMap = <span class="hljs-keyword">null</span>;</span><br><span class="line">    randomSeed = seedGenerator.nextInt() | <span class="hljs-number">0x0100</span>; <span class="hljs-comment">// ensure nonzero</span></span><br><span class="line">    <span class="hljs-comment">// 1</span></span><br><span class="line">    head = <span class="hljs-keyword">new</span> HeadIndex&lt;K,V&gt;(<span class="hljs-keyword">new</span> Node&lt;K,V&gt;(<span class="hljs-keyword">null</span>, BASE_HEADER, <span class="hljs-keyword">null</span>),</span><br><span class="line">                              <span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>, <span class="hljs-number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>标注代码分析</p>
<ol>
<li>生成头节点，该节点value是BASE_HEADER，level是1。</li>
</ol>
<h2 id="ConcurrentSkipListMap-put"><a href="#ConcurrentSkipListMap-put" class="headerlink" title="ConcurrentSkipListMap#put()"></a>ConcurrentSkipListMap#put()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> V <span class="hljs-title">put</span><span class="hljs-params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (value == <span class="hljs-keyword">null</span>)</span><br><span class="line">            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();</span><br><span class="line">        <span class="hljs-keyword">return</span> doPut(key, value, <span class="hljs-keyword">false</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="ConcurrentSkipListMap-doPut"><a href="#ConcurrentSkipListMap-doPut" class="headerlink" title="ConcurrentSkipListMap#doPut"></a>ConcurrentSkipListMap#doPut</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> V <span class="hljs-title">doPut</span><span class="hljs-params">(K kkey, V value, <span class="hljs-keyword">boolean</span> onlyIfAbsent)</span> </span>&#123;</span><br><span class="line">       <span class="hljs-comment">// 1</span></span><br><span class="line">       Comparable&lt;? <span class="hljs-keyword">super</span> K&gt; key = comparable(kkey);</span><br><span class="line">       <span class="hljs-keyword">for</span> (;;) &#123;</span><br><span class="line">           <span class="hljs-comment">// 2</span></span><br><span class="line">           Node&lt;K,V&gt; b = findPredecessor(key);</span><br><span class="line">           Node&lt;K,V&gt; n = b.next;</span><br><span class="line">           <span class="hljs-keyword">for</span> (;;) &#123;</span><br><span class="line">               <span class="hljs-keyword">if</span> (n != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">                   <span class="hljs-comment">// 3</span></span><br><span class="line">                   Node&lt;K,V&gt; f = n.next;</span><br><span class="line">                   <span class="hljs-comment">// 4</span></span><br><span class="line">                   <span class="hljs-keyword">if</span> (n != b.next)               <span class="hljs-comment">// inconsistent read</span></span><br><span class="line">                       <span class="hljs-keyword">break</span>;;</span><br><span class="line">                   Object v = n.value;</span><br><span class="line">                   <span class="hljs-comment">// 5</span></span><br><span class="line">                   <span class="hljs-keyword">if</span> (v == <span class="hljs-keyword">null</span>) &#123;               <span class="hljs-comment">// n is deleted</span></span><br><span class="line">                       n.helpDelete(b, f);</span><br><span class="line">                       <span class="hljs-keyword">break</span>;</span><br><span class="line">                   &#125;</span><br><span class="line">                   <span class="hljs-comment">// 6</span></span><br><span class="line">                   <span class="hljs-keyword">if</span> (v == n || b.value == <span class="hljs-keyword">null</span>) <span class="hljs-comment">// b is deleted</span></span><br><span class="line">                       <span class="hljs-keyword">break</span>;</span><br><span class="line">                   <span class="hljs-keyword">int</span> c = key.compareTo(n.key);</span><br><span class="line">                   <span class="hljs-comment">// 7</span></span><br><span class="line">                   <span class="hljs-keyword">if</span> (c &gt; <span class="hljs-number">0</span>) &#123;</span><br><span class="line">                       b = n;</span><br><span class="line">                       n = f;</span><br><span class="line">                       <span class="hljs-keyword">continue</span>;</span><br><span class="line">                   &#125;</span><br><span class="line">                   <span class="hljs-keyword">if</span> (c == <span class="hljs-number">0</span>) &#123;</span><br><span class="line">                       <span class="hljs-comment">// 8</span></span><br><span class="line">                       <span class="hljs-keyword">if</span> (onlyIfAbsent || n.casValue(v, value))</span><br><span class="line">                           <span class="hljs-keyword">return</span> (V)v;</span><br><span class="line">                       <span class="hljs-keyword">else</span></span><br><span class="line">                           <span class="hljs-keyword">break</span>; <span class="hljs-comment">// restart if lost race to replace value</span></span><br><span class="line">                   &#125;</span><br><span class="line">                   <span class="hljs-comment">// else c &lt; 0; fall through</span></span><br><span class="line">               &#125;</span><br><span class="line">               <span class="hljs-comment">// 9</span></span><br><span class="line">               Node&lt;K,V&gt; z = <span class="hljs-keyword">new</span> Node&lt;K,V&gt;(kkey, value, n);</span><br><span class="line">               <span class="hljs-keyword">if</span> (!b.casNext(n, z))</span><br><span class="line">                   <span class="hljs-keyword">break</span>;         <span class="hljs-comment">// restart if lost race to append to b</span></span><br><span class="line">               <span class="hljs-keyword">int</span> level = randomLevel();</span><br><span class="line">               <span class="hljs-comment">// 10</span></span><br><span class="line">               <span class="hljs-keyword">if</span> (level &gt; <span class="hljs-number">0</span>)</span><br><span class="line">                   insertIndex(z, level);</span><br><span class="line">               <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>标注代码分析</p>
<ol>
<li>以key为参数生成Comparable接口的子类，用于比较key，确定前驱节点和后续节点位置。</li>
<li>通过key找到要插入位置的前驱节点。key的前驱节点是b，b的后续节点是n，key的Node节点是n(key会和n#key做判断，才能确定是不是节点n)。</li>
<li>n#next值是f，f是n的后续节点。</li>
<li>b#next != n 可能是put冲突，造成读不一样。结束本次put()。</li>
<li>节点n被删除，删除节点b和节点f之间的节点。</li>
<li>节点b被删除，无法找到前驱节点，退出本次循环。</li>
<li>n#key和key比较，c &gt; 0当前的节点应该排在n的后面，节点b和节点n重新赋值，后移1个节点。</li>
<li>c = 0，key的节点是n，CAS进行替换value，如果CAS失败结束本次循环。</li>
<li>新建1个节点z，b#next和n比较，如果相等，b#next=z。</li>
<li>插入成功后，随机生成一个层级。</li>
</ol>
<h2 id="ConcurrentSkipListMap-comparable"><a href="#ConcurrentSkipListMap-comparable" class="headerlink" title="ConcurrentSkipListMap#comparable()"></a>ConcurrentSkipListMap#comparable()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">private</span> Comparable&lt;? <span class="hljs-keyword">super</span> K&gt; comparable(Object key) <span class="hljs-keyword">throws</span> ClassCastException &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (key == <span class="hljs-keyword">null</span>)</span><br><span class="line">            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();</span><br><span class="line">        <span class="hljs-keyword">if</span> (comparator != <span class="hljs-keyword">null</span>)</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ComparableUsingComparator&lt;K&gt;((K)key, comparator);</span><br><span class="line">        <span class="hljs-keyword">else</span></span><br><span class="line">            <span class="hljs-keyword">return</span> (Comparable&lt;? <span class="hljs-keyword">super</span> K&gt;)key;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>如果指定Comparator，就使用Comparator；没指定Comparator，就使用Key的自然序(Key需要实现Comparable接口)。</p>
<h2 id="ConcurrentSkipListMap-addIndex"><a href="#ConcurrentSkipListMap-addIndex" class="headerlink" title="ConcurrentSkipListMap#addIndex()"></a>ConcurrentSkipListMap#addIndex()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Adds given index nodes from given level down to 1.</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> idx the topmost index node being inserted</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> h the value of head to use to insert. This must be</span></span><br><span class="line"><span class="hljs-comment"> * snapshotted by callers to provide correct insertion level</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> indexLevel the level of the index</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addIndex</span><span class="hljs-params">(Index&lt;K,V&gt; idx, HeadIndex&lt;K,V&gt; h, <span class="hljs-keyword">int</span> indexLevel)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-comment">// Track next level to insert in case of retries</span></span><br><span class="line">    <span class="hljs-keyword">int</span> insertionLevel = indexLevel;</span><br><span class="line">    Comparable&lt;? <span class="hljs-keyword">super</span> K&gt; key = comparable(idx.node.key);</span><br><span class="line">    <span class="hljs-keyword">if</span> (key == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// Similar to findPredecessor, but adding index nodes along</span></span><br><span class="line">    <span class="hljs-comment">// path to key.</span></span><br><span class="line">    <span class="hljs-keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> j = h.level;</span><br><span class="line">        Index&lt;K,V&gt; q = h;</span><br><span class="line">        Index&lt;K,V&gt; r = q.right;</span><br><span class="line">        Index&lt;K,V&gt; t = idx;</span><br><span class="line">        <span class="hljs-keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (r != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">                Node&lt;K,V&gt; n = r.node;</span><br><span class="line">                <span class="hljs-comment">// compare before deletion check avoids needing recheck</span></span><br><span class="line">                <span class="hljs-keyword">int</span> c = key.compareTo(n.key);</span><br><span class="line">                <span class="hljs-keyword">if</span> (n.value == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">                    <span class="hljs-keyword">if</span> (!q.unlink(r))</span><br><span class="line">                        <span class="hljs-keyword">break</span>;</span><br><span class="line">                    r = q.right;</span><br><span class="line">                    <span class="hljs-keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-keyword">if</span> (c &gt; <span class="hljs-number">0</span>) &#123;</span><br><span class="line">                    q = r;</span><br><span class="line">                    r = r.right;</span><br><span class="line">                    <span class="hljs-keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">if</span> (j == insertionLevel) &#123;</span><br><span class="line">                <span class="hljs-comment">// Don't insert index if node already deleted</span></span><br><span class="line">                <span class="hljs-keyword">if</span> (t.indexesDeletedNode()) &#123;</span><br><span class="line">                    findNode(key); <span class="hljs-comment">// cleans up</span></span><br><span class="line">                    <span class="hljs-keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-keyword">if</span> (!q.link(r, t))</span><br><span class="line">                    <span class="hljs-keyword">break</span>; <span class="hljs-comment">// restart</span></span><br><span class="line">                <span class="hljs-keyword">if</span> (--insertionLevel == <span class="hljs-number">0</span>) &#123;</span><br><span class="line">                    <span class="hljs-comment">// need final deletion check before return</span></span><br><span class="line">                    <span class="hljs-keyword">if</span> (t.indexesDeletedNode())</span><br><span class="line">                        findNode(key);</span><br><span class="line">                    <span class="hljs-keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">if</span> (--j &gt;= insertionLevel &amp;&amp; j &lt; indexLevel)</span><br><span class="line">                t = t.down;</span><br><span class="line">            q = q.down;</span><br><span class="line">            r = q.right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ConcurrentSkipListMap-findPredecessor"><a href="#ConcurrentSkipListMap-findPredecessor" class="headerlink" title="ConcurrentSkipListMap#findPredecessor()"></a>ConcurrentSkipListMap#findPredecessor()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">    * Returns a base-level node with key strictly less than given key,</span></span><br><span class="line"><span class="hljs-comment">    * or the base-level header if there is no such node.  Also</span></span><br><span class="line"><span class="hljs-comment">    * unlinks indexes to deleted nodes found along the way.  Callers</span></span><br><span class="line"><span class="hljs-comment">    * rely on this side-effect of clearing indices to deleted nodes.</span></span><br><span class="line"><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> key the key</span></span><br><span class="line"><span class="hljs-comment">    * <span class="hljs-doctag">@return</span> a predecessor of key</span></span><br><span class="line"><span class="hljs-comment">    */</span></span><br><span class="line">   <span class="hljs-function"><span class="hljs-keyword">private</span> Node&lt;K,V&gt; <span class="hljs-title">findPredecessor</span><span class="hljs-params">(Comparable&lt;? <span class="hljs-keyword">super</span> K&gt; key)</span> </span>&#123;</span><br><span class="line">       <span class="hljs-keyword">if</span> (key == <span class="hljs-keyword">null</span>)</span><br><span class="line">           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException(); <span class="hljs-comment">// don't postpone errors</span></span><br><span class="line">       <span class="hljs-keyword">for</span> (;;) &#123;</span><br><span class="line">           Index&lt;K,V&gt; q = head;</span><br><span class="line">           Index&lt;K,V&gt; r = q.right;</span><br><span class="line">           <span class="hljs-keyword">for</span> (;;) &#123;</span><br><span class="line">               <span class="hljs-keyword">if</span> (r != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">                   Node&lt;K,V&gt; n = r.node;</span><br><span class="line">                   K k = n.key;</span><br><span class="line">                   <span class="hljs-keyword">if</span> (n.value == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">                       <span class="hljs-keyword">if</span> (!q.unlink(r))</span><br><span class="line">                           <span class="hljs-keyword">break</span>;           <span class="hljs-comment">// restart</span></span><br><span class="line">                       r = q.right;         <span class="hljs-comment">// reread r</span></span><br><span class="line">                       <span class="hljs-keyword">continue</span>;</span><br><span class="line">                   &#125;</span><br><span class="line">                   <span class="hljs-keyword">if</span> (key.compareTo(k) &gt; <span class="hljs-number">0</span>) &#123;</span><br><span class="line">                       q = r;</span><br><span class="line">                       r = r.right;</span><br><span class="line">                       <span class="hljs-keyword">continue</span>;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">               Index&lt;K,V&gt; d = q.down;</span><br><span class="line">               <span class="hljs-keyword">if</span> (d != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">                   q = d;</span><br><span class="line">                   r = d.right;</span><br><span class="line">               &#125; <span class="hljs-keyword">else</span></span><br><span class="line">                   <span class="hljs-keyword">return</span> q.node;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>从最高层的头节点开始找，给定key大于当前节点，就往右找，否则就往下找，一直找到最底层链上的节点，这个节点就是给定key在base_level上的前驱节点。</p>
<h2 id="ConcurrentSkipListMap-randomLevel"><a href="#ConcurrentSkipListMap-randomLevel" class="headerlink" title="ConcurrentSkipListMap#randomLevel()"></a>ConcurrentSkipListMap#randomLevel()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Returns a random level for inserting a new node.</span></span><br><span class="line"><span class="hljs-comment">     * Hardwired to k=1, p=0.5, max 31 (see above and</span></span><br><span class="line"><span class="hljs-comment">     * Pugh's "Skip List Cookbook", sec 3.4).</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * This uses the simplest of the generators described in George</span></span><br><span class="line"><span class="hljs-comment">     * Marsaglia's "Xorshift RNGs" paper.  This is not a high-quality</span></span><br><span class="line"><span class="hljs-comment">     * generator but is acceptable here.</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">randomLevel</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> x = randomSeed;</span><br><span class="line">        x ^= x &lt;&lt; <span class="hljs-number">13</span>;</span><br><span class="line">        x ^= x &gt;&gt;&gt; <span class="hljs-number">17</span>;</span><br><span class="line">        randomSeed = x ^= x &lt;&lt; <span class="hljs-number">5</span>;</span><br><span class="line">        <span class="hljs-keyword">if</span> ((x &amp; <span class="hljs-number">0x8001</span>) != <span class="hljs-number">0</span>) <span class="hljs-comment">// test highest and lowest bits</span></span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">        <span class="hljs-keyword">int</span> level = <span class="hljs-number">1</span>;</span><br><span class="line">        <span class="hljs-keyword">while</span> (((x &gt;&gt;&gt;= <span class="hljs-number">1</span>) &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span>) ++level;</span><br><span class="line">        <span class="hljs-keyword">return</span> level;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>50%的几率返回0，25%的几率返回1，12.5%的几率返回2，最大返回31。</p>
<h2 id="ConcurrentSkipListMap-insertIndex"><a href="#ConcurrentSkipListMap-insertIndex" class="headerlink" title="ConcurrentSkipListMap#insertIndex()"></a>ConcurrentSkipListMap#insertIndex()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Creates and adds index nodes for the given node.</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> z the node</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> level the level of the index</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insertIndex</span><span class="hljs-params">(Node&lt;K,V&gt; z, <span class="hljs-keyword">int</span> level)</span> </span>&#123;</span><br><span class="line">    HeadIndex&lt;K,V&gt; h = head;</span><br><span class="line">    <span class="hljs-keyword">int</span> max = h.level;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (level &lt;= max) &#123;</span><br><span class="line">        Index&lt;K,V&gt; idx = <span class="hljs-keyword">null</span>;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= level; ++i)</span><br><span class="line">            idx = <span class="hljs-keyword">new</span> Index&lt;K,V&gt;(z, idx, <span class="hljs-keyword">null</span>);</span><br><span class="line">        addIndex(idx, h, level);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">// Add a new level</span></span><br><span class="line">        <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">         * To reduce interference by other threads checking for</span></span><br><span class="line"><span class="hljs-comment">         * empty levels in tryReduceLevel, new levels are added</span></span><br><span class="line"><span class="hljs-comment">         * with initialized right pointers. Which in turn requires</span></span><br><span class="line"><span class="hljs-comment">         * keeping levels in an array to access them while</span></span><br><span class="line"><span class="hljs-comment">         * creating new head index nodes from the opposite</span></span><br><span class="line"><span class="hljs-comment">         * direction.</span></span><br><span class="line"><span class="hljs-comment">         */</span></span><br><span class="line">        level = max + <span class="hljs-number">1</span>;</span><br><span class="line">        Index&lt;K,V&gt;[] idxs = (Index&lt;K,V&gt;[])<span class="hljs-keyword">new</span> Index[level+<span class="hljs-number">1</span>];</span><br><span class="line">        Index&lt;K,V&gt; idx = <span class="hljs-keyword">null</span>;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= level; ++i)</span><br><span class="line">            idxs[i] = idx = <span class="hljs-keyword">new</span> Index&lt;K,V&gt;(z, idx, <span class="hljs-keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        HeadIndex&lt;K,V&gt; oldh;</span><br><span class="line">        <span class="hljs-keyword">int</span> k;</span><br><span class="line">        <span class="hljs-keyword">for</span> (;;) &#123;</span><br><span class="line">            oldh = head;</span><br><span class="line">            <span class="hljs-keyword">int</span> oldLevel = oldh.level;</span><br><span class="line">            <span class="hljs-keyword">if</span> (level &lt;= oldLevel) &#123; <span class="hljs-comment">// lost race to add level</span></span><br><span class="line">                k = level;</span><br><span class="line">                <span class="hljs-keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            HeadIndex&lt;K,V&gt; newh = oldh;</span><br><span class="line">            Node&lt;K,V&gt; oldbase = oldh.node;</span><br><span class="line">            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = oldLevel+<span class="hljs-number">1</span>; j &lt;= level; ++j)</span><br><span class="line">                newh = <span class="hljs-keyword">new</span> HeadIndex&lt;K,V&gt;(oldbase, newh, idxs[j], j);</span><br><span class="line">            <span class="hljs-keyword">if</span> (casHead(oldh, newh)) &#123;</span><br><span class="line">                k = oldLevel;</span><br><span class="line">                <span class="hljs-keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        addIndex(idxs[k], oldh, k);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ConcurrentSkipListMap-addIndex-1"><a href="#ConcurrentSkipListMap-addIndex-1" class="headerlink" title="ConcurrentSkipListMap#addIndex()"></a>ConcurrentSkipListMap#addIndex()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Adds given index nodes from given level down to 1.</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> idx the topmost index node being inserted</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> h the value of head to use to insert. This must be</span></span><br><span class="line"><span class="hljs-comment"> * snapshotted by callers to provide correct insertion level</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> indexLevel the level of the index</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addIndex</span><span class="hljs-params">(Index&lt;K,V&gt; idx, HeadIndex&lt;K,V&gt; h, <span class="hljs-keyword">int</span> indexLevel)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-comment">// Track next level to insert in case of retries</span></span><br><span class="line">    <span class="hljs-keyword">int</span> insertionLevel = indexLevel;</span><br><span class="line">    Comparable&lt;? <span class="hljs-keyword">super</span> K&gt; key = comparable(idx.node.key);</span><br><span class="line">    <span class="hljs-keyword">if</span> (key == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// Similar to findPredecessor, but adding index nodes along</span></span><br><span class="line">    <span class="hljs-comment">// path to key.</span></span><br><span class="line">    <span class="hljs-keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="hljs-keyword">int</span> j = h.level;</span><br><span class="line">        Index&lt;K,V&gt; q = h;</span><br><span class="line">        Index&lt;K,V&gt; r = q.right;</span><br><span class="line">        Index&lt;K,V&gt; t = idx;</span><br><span class="line">        <span class="hljs-keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (r != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">                Node&lt;K,V&gt; n = r.node;</span><br><span class="line">                <span class="hljs-comment">// compare before deletion check avoids needing recheck</span></span><br><span class="line">                <span class="hljs-keyword">int</span> c = key.compareTo(n.key);</span><br><span class="line">                <span class="hljs-keyword">if</span> (n.value == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">                    <span class="hljs-keyword">if</span> (!q.unlink(r))</span><br><span class="line">                        <span class="hljs-keyword">break</span>;</span><br><span class="line">                    r = q.right;</span><br><span class="line">                    <span class="hljs-keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-keyword">if</span> (c &gt; <span class="hljs-number">0</span>) &#123;</span><br><span class="line">                    q = r;</span><br><span class="line">                    r = r.right;</span><br><span class="line">                    <span class="hljs-keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">if</span> (j == insertionLevel) &#123;</span><br><span class="line">                <span class="hljs-comment">// Don't insert index if node already deleted</span></span><br><span class="line">                <span class="hljs-keyword">if</span> (t.indexesDeletedNode()) &#123;</span><br><span class="line">                    findNode(key); <span class="hljs-comment">// cleans up</span></span><br><span class="line">                    <span class="hljs-keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-keyword">if</span> (!q.link(r, t))</span><br><span class="line">                    <span class="hljs-keyword">break</span>; <span class="hljs-comment">// restart</span></span><br><span class="line">                <span class="hljs-keyword">if</span> (--insertionLevel == <span class="hljs-number">0</span>) &#123;</span><br><span class="line">                    <span class="hljs-comment">// need final deletion check before return</span></span><br><span class="line">                    <span class="hljs-keyword">if</span> (t.indexesDeletedNode())</span><br><span class="line">                        findNode(key);</span><br><span class="line">                    <span class="hljs-keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">if</span> (--j &gt;= insertionLevel &amp;&amp; j &lt; indexLevel)</span><br><span class="line">                t = t.down;</span><br><span class="line">            q = q.down;</span><br><span class="line">            r = q.right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>给定的节点和level值，将之前建立的从上到下的Index节点链接进来。<br><img src="./ConcurrentSkipListMap-1.jpg" alt><br>检测当前的idx节点有没有被删除，如果有，要调用一个ConcurrentSkipListMap#findNode()来做调整。</p>
<h2 id="ConcurrentSkipListMap-findNode"><a href="#ConcurrentSkipListMap-findNode" class="headerlink" title="ConcurrentSkipListMap#findNode()"></a>ConcurrentSkipListMap#findNode()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> Node&lt;K,V&gt; <span class="hljs-title">findNode</span><span class="hljs-params">(Comparable&lt;? <span class="hljs-keyword">super</span> K&gt; key)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">for</span> (;;) &#123;</span><br><span class="line">            Node&lt;K,V&gt; b = findPredecessor(key);</span><br><span class="line">            Node&lt;K,V&gt; n = b.next;</span><br><span class="line">            <span class="hljs-keyword">for</span> (;;) &#123;</span><br><span class="line">                <span class="hljs-keyword">if</span> (n == <span class="hljs-keyword">null</span>)</span><br><span class="line">                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;</span><br><span class="line">                Node&lt;K,V&gt; f = n.next;</span><br><span class="line">                <span class="hljs-keyword">if</span> (n != b.next)                <span class="hljs-comment">// inconsistent read</span></span><br><span class="line">                    <span class="hljs-keyword">break</span>;</span><br><span class="line">                Object v = n.value;</span><br><span class="line">                <span class="hljs-keyword">if</span> (v == <span class="hljs-keyword">null</span>) &#123;                <span class="hljs-comment">// n is deleted</span></span><br><span class="line">                    n.helpDelete(b, f);</span><br><span class="line">                    <span class="hljs-keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-keyword">if</span> (v == n || b.value == <span class="hljs-keyword">null</span>)  <span class="hljs-comment">// b is deleted</span></span><br><span class="line">                    <span class="hljs-keyword">break</span>;</span><br><span class="line">                <span class="hljs-keyword">int</span> c = key.compareTo(n.key);</span><br><span class="line">                <span class="hljs-keyword">if</span> (c == <span class="hljs-number">0</span>)</span><br><span class="line">                    <span class="hljs-keyword">return</span> n;</span><br><span class="line">                <span class="hljs-keyword">if</span> (c &lt; <span class="hljs-number">0</span>)</span><br><span class="line">                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;</span><br><span class="line">                b = n;</span><br><span class="line">                n = f;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="put-总结"><a href="#put-总结" class="headerlink" title="put()总结"></a>put()总结</h2><ol>
<li>首先要根据给定的key找出在base_level链表中对应的前驱节点(从结构图的左上角往右或往下一路找过来)，注意put方法使用的log(n)时间主要体现在这个过程，这个查找过程中会顺便帮忙推进一些节点的删除。</li>
<li>找到前驱节点后，然后从这个前驱节点往后找到要插入的位置(注意当前已经在base_level上，所以只需要往后找)，这个查找过程中也会顺便帮忙推进一些节点的删除。</li>
<li>找到了要插入的位置，尝试插入，如果竞争导致插入失败，返回到第1步重试；如果插入成功，接下来会随机生成一个level，如果这个level大于0，需要将插入的节点在垂直线上生成level(level&lt;=maxLevel + 1)个Index节点。</li>
</ol>
<h2 id="ConcurrentSkipListMap-get"><a href="#ConcurrentSkipListMap-get" class="headerlink" title="ConcurrentSkipListMap#get()"></a>ConcurrentSkipListMap#get()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> V <span class="hljs-title">get</span><span class="hljs-params">(Object key)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> doGet(key);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="ConcurrentSkipListMap-doGet"><a href="#ConcurrentSkipListMap-doGet" class="headerlink" title="ConcurrentSkipListMap#doGet()"></a>ConcurrentSkipListMap#doGet()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> V <span class="hljs-title">doGet</span><span class="hljs-params">(Object okey)</span> </span>&#123;</span><br><span class="line">        Comparable&lt;? <span class="hljs-keyword">super</span> K&gt; key = comparable(okey);</span><br><span class="line">        Node&lt;K,V&gt; bound = <span class="hljs-keyword">null</span>;</span><br><span class="line">        Index&lt;K,V&gt; q = head;</span><br><span class="line">        Index&lt;K,V&gt; r = q.right;</span><br><span class="line">        Node&lt;K,V&gt; n;</span><br><span class="line">        K k;</span><br><span class="line">        <span class="hljs-keyword">int</span> c;</span><br><span class="line">        <span class="hljs-keyword">for</span> (;;) &#123;</span><br><span class="line">            Index&lt;K,V&gt; d;</span><br><span class="line">            <span class="hljs-comment">// Traverse rights</span></span><br><span class="line">            <span class="hljs-keyword">if</span> (r != <span class="hljs-keyword">null</span> &amp;&amp; (n = r.node) != bound &amp;&amp; (k = n.key) != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">                <span class="hljs-keyword">if</span> ((c = key.compareTo(k)) &gt; <span class="hljs-number">0</span>) &#123;</span><br><span class="line">                    q = r;</span><br><span class="line">                    r = r.right;</span><br><span class="line">                    <span class="hljs-keyword">continue</span>;</span><br><span class="line">                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (c == <span class="hljs-number">0</span>) &#123;</span><br><span class="line">                    Object v = n.value;</span><br><span class="line">                    <span class="hljs-keyword">return</span> (v != <span class="hljs-keyword">null</span>)? (V)v : getUsingFindNode(key);</span><br><span class="line">                &#125; <span class="hljs-keyword">else</span></span><br><span class="line">                    bound = n;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="hljs-comment">// Traverse down</span></span><br><span class="line">            <span class="hljs-keyword">if</span> ((d = q.down) != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">                q = d;</span><br><span class="line">                r = d.right;</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span></span><br><span class="line">                <span class="hljs-keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">// Traverse nexts</span></span><br><span class="line">        <span class="hljs-keyword">for</span> (n = q.node.next;  n != <span class="hljs-keyword">null</span>; n = n.next) &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> ((k = n.key) != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">                <span class="hljs-keyword">if</span> ((c = key.compareTo(k)) == <span class="hljs-number">0</span>) &#123;</span><br><span class="line">                    Object v = n.value;</span><br><span class="line">                    <span class="hljs-keyword">return</span> (v != <span class="hljs-keyword">null</span>)? (V)v : getUsingFindNode(key);</span><br><span class="line">                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (c &lt; <span class="hljs-number">0</span>)</span><br><span class="line">                    <span class="hljs-keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>从最左最高的头节点开始往右或者往下(通过key的比较)遍历，一直找到base_level，然后往后一直找到给定节点，找不到的话返回null。<br> 代码中还会看到，如果找到了节点，还会判断节点上的value是否为null。如果不为null，直接返回这个value；如果为null，说明这个节点被删除了(正在删除过程中)，那么需要调用一个ConcurrentSkipListMap#getUsingFindNode()。</p>
<h2 id="ConcurrentSkipListMap-getUsingFindNode"><a href="#ConcurrentSkipListMap-getUsingFindNode" class="headerlink" title="ConcurrentSkipListMap#getUsingFindNode()"></a>ConcurrentSkipListMap#getUsingFindNode()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> V <span class="hljs-title">getUsingFindNode</span><span class="hljs-params">(Comparable&lt;? <span class="hljs-keyword">super</span> K&gt; key)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">         * Loop needed here and elsewhere in case value field goes</span></span><br><span class="line"><span class="hljs-comment">         * null just as it is about to be returned, in which case we</span></span><br><span class="line"><span class="hljs-comment">         * lost a race with a deletion, so must retry.</span></span><br><span class="line"><span class="hljs-comment">         */</span></span><br><span class="line">        <span class="hljs-keyword">for</span> (;;) &#123;</span><br><span class="line">            Node&lt;K,V&gt; n = findNode(key);</span><br><span class="line">            <span class="hljs-keyword">if</span> (n == <span class="hljs-keyword">null</span>)</span><br><span class="line">                <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;</span><br><span class="line">            Object v = n.value;</span><br><span class="line">            <span class="hljs-keyword">if</span> (v != <span class="hljs-keyword">null</span>)</span><br><span class="line">                <span class="hljs-keyword">return</span> (V)v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>调用前面分析过的findNode方法来查找一个key对应的Node，注意方法中外侧还是包了一层无限循环，为的是避免由于竞争导致findNode方法返回的Node又是一个被删除的节点。</p>
<h2 id="ConcurrentSkipListMap-containsKey"><a href="#ConcurrentSkipListMap-containsKey" class="headerlink" title="ConcurrentSkipListMap#containsKey()"></a>ConcurrentSkipListMap#containsKey()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">containsKey</span><span class="hljs-params">(Object key)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> doGet(key) != <span class="hljs-keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>ConcurrentSkipListMap#doGet()来实现。</p>
<h2 id="ConcurrentSkipListMap-remove"><a href="#ConcurrentSkipListMap-remove" class="headerlink" title="ConcurrentSkipListMap#remove()"></a>ConcurrentSkipListMap#remove()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> V <span class="hljs-title">remove</span><span class="hljs-params">(Object key)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> doRemove(key, <span class="hljs-keyword">null</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="ConcurrentSkipListMap-doRemove"><a href="#ConcurrentSkipListMap-doRemove" class="headerlink" title="ConcurrentSkipListMap#doRemove()"></a>ConcurrentSkipListMap#doRemove()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">final</span> V <span class="hljs-title">doRemove</span><span class="hljs-params">(Object okey, Object value)</span> </span>&#123;</span><br><span class="line">        Comparable&lt;? <span class="hljs-keyword">super</span> K&gt; key = comparable(okey);</span><br><span class="line">        <span class="hljs-keyword">for</span> (;;) &#123;</span><br><span class="line">            Node&lt;K,V&gt; b = findPredecessor(key);</span><br><span class="line">            Node&lt;K,V&gt; n = b.next;</span><br><span class="line">            <span class="hljs-keyword">for</span> (;;) &#123;</span><br><span class="line">                <span class="hljs-keyword">if</span> (n == <span class="hljs-keyword">null</span>)</span><br><span class="line">                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;</span><br><span class="line">                Node&lt;K,V&gt; f = n.next;</span><br><span class="line">                <span class="hljs-keyword">if</span> (n != b.next)                    <span class="hljs-comment">// inconsistent read</span></span><br><span class="line">                    <span class="hljs-keyword">break</span>;</span><br><span class="line">                Object v = n.value;</span><br><span class="line">                <span class="hljs-keyword">if</span> (v == <span class="hljs-keyword">null</span>) &#123;                    <span class="hljs-comment">// n is deleted</span></span><br><span class="line">                    n.helpDelete(b, f);</span><br><span class="line">                    <span class="hljs-keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-keyword">if</span> (v == n || b.value == <span class="hljs-keyword">null</span>)      <span class="hljs-comment">// b is deleted</span></span><br><span class="line">                    <span class="hljs-keyword">break</span>;</span><br><span class="line">                <span class="hljs-keyword">int</span> c = key.compareTo(n.key);</span><br><span class="line">                <span class="hljs-keyword">if</span> (c &lt; <span class="hljs-number">0</span>)</span><br><span class="line">                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;</span><br><span class="line">                <span class="hljs-keyword">if</span> (c &gt; <span class="hljs-number">0</span>) &#123;</span><br><span class="line">                    b = n;</span><br><span class="line">                    n = f;</span><br><span class="line">                    <span class="hljs-keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-keyword">if</span> (value != <span class="hljs-keyword">null</span> &amp;&amp; !value.equals(v))</span><br><span class="line">                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;</span><br><span class="line">                <span class="hljs-keyword">if</span> (!n.casValue(v, <span class="hljs-keyword">null</span>))</span><br><span class="line">                    <span class="hljs-keyword">break</span>;</span><br><span class="line">                <span class="hljs-keyword">if</span> (!n.appendMarker(f) || !b.casNext(n, f))</span><br><span class="line">                    findNode(key);                  <span class="hljs-comment">// Retry via findNode</span></span><br><span class="line">                <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">                    findPredecessor(key);           <span class="hljs-comment">// Clean index</span></span><br><span class="line">                    <span class="hljs-keyword">if</span> (head.right == <span class="hljs-keyword">null</span>)</span><br><span class="line">                        tryReduceLevel();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-keyword">return</span> (V)v;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="ConcurrentSkipListMap-tryReduceLevel"><a href="#ConcurrentSkipListMap-tryReduceLevel" class="headerlink" title="ConcurrentSkipListMap#tryReduceLevel()"></a>ConcurrentSkipListMap#tryReduceLevel()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">tryReduceLevel</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        HeadIndex&lt;K,V&gt; h = head;</span><br><span class="line">        HeadIndex&lt;K,V&gt; d;</span><br><span class="line">        HeadIndex&lt;K,V&gt; e;</span><br><span class="line">        <span class="hljs-keyword">if</span> (h.level &gt; <span class="hljs-number">3</span> &amp;&amp;</span><br><span class="line">            (d = (HeadIndex&lt;K,V&gt;)h.down) != <span class="hljs-keyword">null</span> &amp;&amp;</span><br><span class="line">            (e = (HeadIndex&lt;K,V&gt;)d.down) != <span class="hljs-keyword">null</span> &amp;&amp;</span><br><span class="line">            e.right == <span class="hljs-keyword">null</span> &amp;&amp;</span><br><span class="line">            d.right == <span class="hljs-keyword">null</span> &amp;&amp;</span><br><span class="line">            h.right == <span class="hljs-keyword">null</span> &amp;&amp;</span><br><span class="line">            casHead(h, d) &amp;&amp; <span class="hljs-comment">// try to set</span></span><br><span class="line">            h.right != <span class="hljs-keyword">null</span>) <span class="hljs-comment">// recheck</span></span><br><span class="line">            casHead(d, h);   <span class="hljs-comment">// try to backout</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>如果最高的前三个HeadIndex都为null(当前看起来)，那么就将level减少1层，其实就是将h(当前的head)设置为d(head的下一层)，设置完成之后，还有检测h(之前的head)的right是否为null(因为可能刚才由于竞争的原因，导致看到h的right为null)，如果这会儿又不是null，那么还得回退回来，再次将head设置为h。</p>
<h2 id="ConcurrentSkipListMap-containsValue"><a href="#ConcurrentSkipListMap-containsValue" class="headerlink" title="ConcurrentSkipListMap#containsValue()"></a>ConcurrentSkipListMap#containsValue()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">containsValue</span><span class="hljs-params">(Object value)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (value == <span class="hljs-keyword">null</span>)</span><br><span class="line">            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();</span><br><span class="line">        <span class="hljs-keyword">for</span> (Node&lt;K,V&gt; n = findFirst(); n != <span class="hljs-keyword">null</span>; n = n.next) &#123;</span><br><span class="line">            V v = n.getValidValue();</span><br><span class="line">            <span class="hljs-keyword">if</span> (v != <span class="hljs-keyword">null</span> &amp;&amp; value.equals(v))</span><br><span class="line">                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>base_level链的第一个节点，然后一直往后找，比较value值。</p>
<h2 id="ConcurrentSkipListMap-findFirst"><a href="#ConcurrentSkipListMap-findFirst" class="headerlink" title="ConcurrentSkipListMap#findFirst()"></a>ConcurrentSkipListMap#findFirst()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function">Node&lt;K,V&gt; <span class="hljs-title">findFirst</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">for</span> (;;) &#123;</span><br><span class="line">            Node&lt;K,V&gt; b = head.node;</span><br><span class="line">            Node&lt;K,V&gt; n = b.next;</span><br><span class="line">            <span class="hljs-keyword">if</span> (n == <span class="hljs-keyword">null</span>)</span><br><span class="line">                <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;</span><br><span class="line">            <span class="hljs-keyword">if</span> (n.value != <span class="hljs-keyword">null</span>)</span><br><span class="line">                <span class="hljs-keyword">return</span> n;</span><br><span class="line">            n.helpDelete(b, n.next);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>就是找到head中node(BASE_HEADER节点)的next，有可能next节点被删除了，所以会做检测，删除的话，推进一下删除，然后继续获取。ConcurrentSkipListMap#size()和ConcurrentSkipListMap#isEmpty()也是基于这个方法实现的。</p>
<h2 id="ConcurrentSkipListMap-size"><a href="#ConcurrentSkipListMap-size" class="headerlink" title="ConcurrentSkipListMap#size()"></a>ConcurrentSkipListMap#size()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">size</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">       <span class="hljs-keyword">long</span> count = <span class="hljs-number">0</span>;</span><br><span class="line">       <span class="hljs-keyword">for</span> (Node&lt;K,V&gt; n = findFirst(); n != <span class="hljs-keyword">null</span>; n = n.next) &#123;</span><br><span class="line">           <span class="hljs-keyword">if</span> (n.getValidValue() != <span class="hljs-keyword">null</span>)</span><br><span class="line">               ++count;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="hljs-keyword">return</span> (count &gt;= Integer.MAX_VALUE)? Integer.MAX_VALUE : (<span class="hljs-keyword">int</span>)count;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h2 id="ConcurrentSkipListMap-isEmpty"><a href="#ConcurrentSkipListMap-isEmpty" class="headerlink" title="ConcurrentSkipListMap#isEmpty()"></a>ConcurrentSkipListMap#isEmpty()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isEmpty</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> findFirst() == <span class="hljs-keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>ConcurrentSkipListMap实现ConcurrentMap接口。覆写putIfAbsent()、 remove()、replace()。<br>ConcurrentSkipListMap同样实现SortedMap。</p>
<h2 id="ConcurrentSkipListMap-lastKey"><a href="#ConcurrentSkipListMap-lastKey" class="headerlink" title="ConcurrentSkipListMap#lastKey()"></a>ConcurrentSkipListMap#lastKey()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> K <span class="hljs-title">lastKey</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        Node&lt;K,V&gt; n = findLast();</span><br><span class="line">        <span class="hljs-keyword">if</span> (n == <span class="hljs-keyword">null</span>)</span><br><span class="line">            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoSuchElementException();</span><br><span class="line">        <span class="hljs-keyword">return</span> n.key;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="ConcurrentSkipListMap-findLast"><a href="#ConcurrentSkipListMap-findLast" class="headerlink" title="ConcurrentSkipListMap#findLast()"></a>ConcurrentSkipListMap#findLast()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function">Node&lt;K,V&gt; <span class="hljs-title">findLast</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">         * findPredecessor can't be used to traverse index level</span></span><br><span class="line"><span class="hljs-comment">         * because this doesn't use comparisons.  So traversals of</span></span><br><span class="line"><span class="hljs-comment">         * both levels are folded together.</span></span><br><span class="line"><span class="hljs-comment">         */</span></span><br><span class="line">        Index&lt;K,V&gt; q = head;</span><br><span class="line">        <span class="hljs-keyword">for</span> (;;) &#123;</span><br><span class="line">            Index&lt;K,V&gt; d, r;</span><br><span class="line">            <span class="hljs-keyword">if</span> ((r = q.right) != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">                <span class="hljs-keyword">if</span> (r.indexesDeletedNode()) &#123;</span><br><span class="line">                    q.unlink(r);</span><br><span class="line">                    q = head; <span class="hljs-comment">// restart</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-keyword">else</span></span><br><span class="line">                    q = r;</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((d = q.down) != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">                q = d;</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">                Node&lt;K,V&gt; b = q.node;</span><br><span class="line">                Node&lt;K,V&gt; n = b.next;</span><br><span class="line">                <span class="hljs-keyword">for</span> (;;) &#123;</span><br><span class="line">                    <span class="hljs-keyword">if</span> (n == <span class="hljs-keyword">null</span>)</span><br><span class="line">                        <span class="hljs-keyword">return</span> (b.isBaseHeader())? <span class="hljs-keyword">null</span> : b;</span><br><span class="line">                    Node&lt;K,V&gt; f = n.next;            <span class="hljs-comment">// inconsistent read</span></span><br><span class="line">                    <span class="hljs-keyword">if</span> (n != b.next)</span><br><span class="line">                        <span class="hljs-keyword">break</span>;</span><br><span class="line">                    Object v = n.value;</span><br><span class="line">                    <span class="hljs-keyword">if</span> (v == <span class="hljs-keyword">null</span>) &#123;                 <span class="hljs-comment">// n is deleted</span></span><br><span class="line">                        n.helpDelete(b, f);</span><br><span class="line">                        <span class="hljs-keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="hljs-keyword">if</span> (v == n || b.value == <span class="hljs-keyword">null</span>)   <span class="hljs-comment">// b is deleted</span></span><br><span class="line">                        <span class="hljs-keyword">break</span>;</span><br><span class="line">                    b = n;</span><br><span class="line">                    n = f;</span><br><span class="line">                &#125;</span><br><span class="line">                q = head; <span class="hljs-comment">// restart</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="ConcurrentSkipListMap-lowerEntry"><a href="#ConcurrentSkipListMap-lowerEntry" class="headerlink" title="ConcurrentSkipListMap#lowerEntry()"></a>ConcurrentSkipListMap#lowerEntry()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> Map.<span class="hljs-function">Entry&lt;K,V&gt; <span class="hljs-title">lowerEntry</span><span class="hljs-params">(K key)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> getNear(key, LT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>找到一个比给定key小的所有key里面最大的key对应的Entry，里面调用了getNear()。</p>
<h2 id="ConcurrentSkipListMap-getNear"><a href="#ConcurrentSkipListMap-getNear" class="headerlink" title="ConcurrentSkipListMap#getNear()"></a>ConcurrentSkipListMap#getNear()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">AbstractMap.<span class="hljs-function">SimpleImmutableEntry&lt;K,V&gt; <span class="hljs-title">getNear</span><span class="hljs-params">(K key, <span class="hljs-keyword">int</span> rel)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">for</span> (;;) &#123;</span><br><span class="line">            Node&lt;K,V&gt; n = findNear(key, rel);</span><br><span class="line">            <span class="hljs-keyword">if</span> (n == <span class="hljs-keyword">null</span>)</span><br><span class="line">                <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;</span><br><span class="line">            AbstractMap.SimpleImmutableEntry&lt;K,V&gt; e = n.createSnapshot();</span><br><span class="line">            <span class="hljs-keyword">if</span> (e != <span class="hljs-keyword">null</span>)</span><br><span class="line">                <span class="hljs-keyword">return</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="ConcurrentSkipListMap-findNear"><a href="#ConcurrentSkipListMap-findNear" class="headerlink" title="ConcurrentSkipListMap#findNear()"></a>ConcurrentSkipListMap#findNear()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function">Node&lt;K,V&gt; <span class="hljs-title">findNear</span><span class="hljs-params">(K kkey, <span class="hljs-keyword">int</span> rel)</span> </span>&#123;</span><br><span class="line">        Comparable&lt;? <span class="hljs-keyword">super</span> K&gt; key = comparable(kkey);</span><br><span class="line">        <span class="hljs-keyword">for</span> (;;) &#123;</span><br><span class="line">            Node&lt;K,V&gt; b = findPredecessor(key);</span><br><span class="line">            Node&lt;K,V&gt; n = b.next;</span><br><span class="line">            <span class="hljs-keyword">for</span> (;;) &#123;</span><br><span class="line">                <span class="hljs-keyword">if</span> (n == <span class="hljs-keyword">null</span>)</span><br><span class="line">                    <span class="hljs-keyword">return</span> ((rel &amp; LT) == <span class="hljs-number">0</span> || b.isBaseHeader())? <span class="hljs-keyword">null</span> : b;</span><br><span class="line">                Node&lt;K,V&gt; f = n.next;</span><br><span class="line">                <span class="hljs-keyword">if</span> (n != b.next)                  <span class="hljs-comment">// inconsistent read</span></span><br><span class="line">                    <span class="hljs-keyword">break</span>;</span><br><span class="line">                Object v = n.value;</span><br><span class="line">                <span class="hljs-keyword">if</span> (v == <span class="hljs-keyword">null</span>) &#123;                  <span class="hljs-comment">// n is deleted</span></span><br><span class="line">                    n.helpDelete(b, f);</span><br><span class="line">                    <span class="hljs-keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-keyword">if</span> (v == n || b.value == <span class="hljs-keyword">null</span>)    <span class="hljs-comment">// b is deleted</span></span><br><span class="line">                    <span class="hljs-keyword">break</span>;</span><br><span class="line">                <span class="hljs-keyword">int</span> c = key.compareTo(n.key);</span><br><span class="line">                <span class="hljs-keyword">if</span> ((c == <span class="hljs-number">0</span> &amp;&amp; (rel &amp; EQ) != <span class="hljs-number">0</span>) ||</span><br><span class="line">                    (c &lt;  <span class="hljs-number">0</span> &amp;&amp; (rel &amp; LT) == <span class="hljs-number">0</span>))</span><br><span class="line">                    <span class="hljs-keyword">return</span> n;</span><br><span class="line">                <span class="hljs-keyword">if</span> ( c &lt;= <span class="hljs-number">0</span> &amp;&amp; (rel &amp; LT) != <span class="hljs-number">0</span>)</span><br><span class="line">                    <span class="hljs-keyword">return</span> (b.isBaseHeader())? <span class="hljs-keyword">null</span> : b;</span><br><span class="line">                b = n;</span><br><span class="line">                n = f;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> EQ = <span class="hljs-number">1</span>;</span><br><span class="line"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> LT = <span class="hljs-number">2</span>;</span><br><span class="line"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> GT = <span class="hljs-number">0</span>; <span class="hljs-comment">// Actually checked as !LT</span></span><br></pre></td></tr></table></figure>
<p>这个方法其实和findNode类似，都是从head开始先找到base_level的上给定key的前驱节点，然后再往后找。区别是这里传入关系参数-EQ、LT、GT(GT在代码里面没直接用，而是通过没有LT来判断)，我们可以通过lowerEntry方法来分析，lowerEntry方法中间接调用的findNear方法传入的是LT，所以当在findNear方法中定位到目标节点n的时候，节点关系是这样的：[b-&gt;n-&gt;f]，节点key和给定key的大小关系是这样的：<code>[b&lt;k&lt;=n&lt;f]</code>，所以代码会从findNear中的出口3(见注释)返回。</p>
<h2 id="ConcurrentSkipListMap-floorEntry"><a href="#ConcurrentSkipListMap-floorEntry" class="headerlink" title="ConcurrentSkipListMap#floorEntry()"></a>ConcurrentSkipListMap#floorEntry()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> Map.<span class="hljs-function">Entry&lt;K,V&gt; <span class="hljs-title">floorEntry</span><span class="hljs-params">(K key)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> getNear(key, LT|EQ);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>floorEntry方法中间接调用的findNear方法传入的是LT|EQ，所以当在findNear方法中定位到目标节点n的时候，节点关系是这样的：[b-&gt;n-&gt;f]，节点key和给定key的大小关系是这样的：<code>[b&lt;k&lt;=n&lt;f]</code>，这里分两种情况：1.如果<code>k&lt;n</code>，那么会从出口3退出，返回b；2.如果k=n，那么会从出口2退出(满足条件(c == 0 &amp;&amp; (rel &amp; EQ) != 0))，返回n。</p>
<h2 id="ConcurrentSkipListMap-ceilingEntry"><a href="#ConcurrentSkipListMap-ceilingEntry" class="headerlink" title="ConcurrentSkipListMap#ceilingEntry()"></a>ConcurrentSkipListMap#ceilingEntry()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> Map.<span class="hljs-function">Entry&lt;K,V&gt; <span class="hljs-title">ceilingEntry</span><span class="hljs-params">(K key)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> getNear(key, GT|EQ);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ceilingEntry方法中间接调用的findNear方法传入的是GT|EQ，所以当在findNear方法中定位到目标节点n的时候，节点关系是这样的：[b-&gt;n-&gt;f]，节点key和给定key的大小关系是这样的：<code>[b&lt;k&lt;=n&lt;f]</code>，这里分两种情况：1.如果<code>k&lt;n(k&gt;b)</code>，那么会从出口2退出(满足条件(c &lt;  0 &amp;&amp; (rel &amp; LT) == 0))，返回b；2.如果k=n，那么也会从出口2退出(满足条件(c == 0 &amp;&amp; (rel &amp; EQ) != 0))，返回n。</p>
<h2 id="ConcurrentSkipListMap-higherEntry"><a href="#ConcurrentSkipListMap-higherEntry" class="headerlink" title="ConcurrentSkipListMap#higherEntry()"></a>ConcurrentSkipListMap#higherEntry()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> Map.<span class="hljs-function">Entry&lt;K,V&gt; <span class="hljs-title">higherEntry</span><span class="hljs-params">(K key)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> getNear(key, GT);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>higherEntry方法中间接调用的findNear方法传入的是GT，所以当在findNear方法中定位到目标节点n的时候，节点关系是这样的：[b-&gt;n-&gt;f]，节点key和给定key的大小关系是这样的：<code>[b&lt;k&lt;=n&lt;f]</code>，这里分两种情况：1.如果<code>k&lt;n</code>，那么会从出口2退出(满足条件(c &lt;  0 &amp;&amp; (rel &amp; LT) == 0))，返回b；2.如果k=n，那么会进入下一次循环，关系变成这样：<code>[b&lt;n=k&lt;f]</code>，这时会从出口2退出(满足条件(c &lt;  0 &amp;&amp; (rel &amp; LT) == 0))，这时返回的是f。<br>上面分析的所有方法，都会遇到在findNear中遇到n==null的可能，这时关系图如下<code>[b&lt;k-null]</code>，k一定大于b，所以只有传入LT，才可以返回b；否则都是null。而且如果b本身是BaseHead，也只能返回null。</p>

        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2016-05-03T04:37:22.000Z">2016-05-03</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/JDK6-源码/">JDK6 源码</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    14 分钟 读完 (大约 2130 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/JDK1.6-ConcurrentLinkedQueue/">JDK1.6 ConcurrentLinkedQueue</a>
            
        </h1>
        <div class="content">
            <!-- TOC -->
<ul>
<li><a href="#1-介绍">1 介绍</a></li>
<li><a href="#2-源码分析">2 源码分析</a><ul>
<li><a href="#concurrentlinkedqueue">ConcurrentLinkedQueue</a></li>
<li><a href="#concurrentlinkedqueueadd">ConcurrentLinkedQueue#add()</a></li>
<li><a href="#concurrentlinkedqueueoffer">ConcurrentLinkedQueue#offer()</a><ul>
<li><a href="#没有竞争">没有竞争</a></li>
<li><a href="#有竞争">有竞争</a></li>
</ul>
</li>
<li><a href="#concurrentlinkedqueuesucc">ConcurrentLinkedQueue#succ()</a></li>
<li><a href="#concurrentlinkedqueuehops">ConcurrentLinkedQueue#HOPS</a></li>
<li><a href="#concurrentlinkedqueuepoll">ConcurrentLinkedQueue#poll()</a></li>
<li><a href="#concurrentlinkedqueueupdatehead">ConcurrentLinkedQueue#updateHead()</a></li>
<li><a href="#concurrentlinkedqueuepeek">ConcurrentLinkedQueue#peek()</a></li>
<li><a href="#concurrentlinkedqueuefirst">ConcurrentLinkedQueue#first()</a></li>
<li><a href="#concurrentlinkedqueueisempty">ConcurrentLinkedQueue#isEmpty()</a></li>
<li><a href="#concurrentlinkedqueuesize">ConcurrentLinkedQueue#size()</a></li>
</ul>
</li>
<li><a href="#3-总结">3 总结</a><ul>
<li><a href="#concurrentlinkedqueueiterator">ConcurrentLinkedQueue#iterator()</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h1 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1 介绍"></a>1 介绍</h1><ul>
<li>ConcurrentLinkedQueue是一种基于单向链表实现的无界的线程安全队列。队列中的元素遵循先入先出(FIFO)的规则。新元素插入到队列的尾部，从队列头部取出元素。</li>
<li>ConcurrentLinkedQueue内部采用一种wait-free(无等待)算法来实现。<h1 id="2-源码分析"><a href="#2-源码分析" class="headerlink" title="2 源码分析"></a>2 源码分析</h1><h2 id="ConcurrentLinkedQueue"><a href="#ConcurrentLinkedQueue" class="headerlink" title="ConcurrentLinkedQueue"></a>ConcurrentLinkedQueue</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConcurrentLinkedQueue</span>&lt;<span class="hljs-title">E</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractQueue</span>&lt;<span class="hljs-title">E</span>&gt;</span></span><br><span class="line"><span class="hljs-class">        <span class="hljs-keyword">implements</span> <span class="hljs-title">Queue</span>&lt;<span class="hljs-title">E</span>&gt;, <span class="hljs-title">java</span>.<span class="hljs-title">io</span>.<span class="hljs-title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span class="hljs-number">196745693267521676L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">     * ...略 </span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Node</span>&lt;<span class="hljs-title">E</span>&gt; </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> E item;</span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> Node&lt;E&gt; next;</span><br><span class="line"></span><br><span class="line">        Node(E item) &#123;</span><br><span class="line">            <span class="hljs-comment">// Piggyback on imminent casNext()</span></span><br><span class="line">            lazySetItem(item);</span><br><span class="line">         &#125; </span><br><span class="line"></span><br><span class="line">        <span class="hljs-function">E <span class="hljs-title">getItem</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> item;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">casItem</span><span class="hljs-params">(E cmp, E val)</span> </span>&#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> UNSAFE.compareAndSwapObject(<span class="hljs-keyword">this</span>, itemOffset, cmp, val);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setItem</span><span class="hljs-params">(E val)</span> </span>&#123;</span><br><span class="line">             item = val;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">lazySetItem</span><span class="hljs-params">(E val)</span> </span>&#123;</span><br><span class="line">            UNSAFE.putOrderedObject(<span class="hljs-keyword">this</span>, itemOffset, val);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">lazySetNext</span><span class="hljs-params">(Node&lt;E&gt; val)</span> </span>&#123;</span><br><span class="line">            UNSAFE.putOrderedObject(<span class="hljs-keyword">this</span>, nextOffset, val);</span><br><span class="line">        &#125; </span><br><span class="line"></span><br><span class="line">        <span class="hljs-function">Node&lt;E&gt; <span class="hljs-title">getNext</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">casNext</span><span class="hljs-params">(Node&lt;E&gt; cmp, Node&lt;E&gt; val)</span> </span>&#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> UNSAFE.compareAndSwapObject(<span class="hljs-keyword">this</span>, nextOffset, cmp, val);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">// Unsafe mechanics</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> sun.misc.Unsafe UNSAFE =</span><br><span class="line">        sun.misc.Unsafe.getUnsafe();</span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> nextOffset =</span><br><span class="line">        objectFieldOffset(UNSAFE, <span class="hljs-string">"next"</span>, Node.class);</span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> itemOffset =</span><br><span class="line">        objectFieldOffset(UNSAFE, <span class="hljs-string">"item"</span>, Node.class);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">    * A node from which the first live (non-deleted) node (if any)</span></span><br><span class="line"><span class="hljs-comment">    * can be reached in O(1) time.</span></span><br><span class="line"><span class="hljs-comment">    * Invariants:</span></span><br><span class="line"><span class="hljs-comment">    * - all live nodes are reachable from head via succ()</span></span><br><span class="line"><span class="hljs-comment">    * - head != null</span></span><br><span class="line"><span class="hljs-comment">    * - (tmp = head).next != tmp || tmp != head</span></span><br><span class="line"><span class="hljs-comment">    * Non-invariants:</span></span><br><span class="line"><span class="hljs-comment">    * - head.item may or may not be null.</span></span><br><span class="line"><span class="hljs-comment">    * - it is permitted for tail to lag behind head, that is, for tail</span></span><br><span class="line"><span class="hljs-comment">    * to not be reachable from head!</span></span><br><span class="line"><span class="hljs-comment">    */</span></span><br><span class="line">    <span class="hljs-comment">// 1</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> Node&lt;E&gt; head = <span class="hljs-keyword">new</span> Node&lt;E&gt;(<span class="hljs-keyword">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">    * A node from which the last node on list (that is, the unique</span></span><br><span class="line"><span class="hljs-comment">    * node with node.next == null) can be reached in O(1) time.</span></span><br><span class="line"><span class="hljs-comment">    * Invariants:</span></span><br><span class="line"><span class="hljs-comment">    * - the last node is always reachable from tail via succ()</span></span><br><span class="line"><span class="hljs-comment">    * - tail != null</span></span><br><span class="line"><span class="hljs-comment">    * Non-invariants:</span></span><br><span class="line"><span class="hljs-comment">    * - tail.item may or may not be null.</span></span><br><span class="line"><span class="hljs-comment">    * - it is permitted for tail to lag behind head, that is, for tail</span></span><br><span class="line"><span class="hljs-comment">    * to not be reachable from head!</span></span><br><span class="line"><span class="hljs-comment">    * - tail.next may or may not be self-pointing to tail.</span></span><br><span class="line"><span class="hljs-comment">    */</span> </span><br><span class="line">    <span class="hljs-comment">// 2</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> Node&lt;E&gt; tail = head;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Creates a &#123;<span class="hljs-doctag">@code</span> ConcurrentLinkedQueue&#125; that is initially empty.</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ConcurrentLinkedQueue</span><span class="hljs-params">()</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>标注代码分析</p>
<ol>
<li>节点head可以指向live nodes（live节点）；head != null，head.item == null||head.item != null；节点head有可能无法指向节点tail。</li>
<li>tail != null；节点tail是最后1个节点；节点head有可能无法指向节点tail；tail.next可能指向自己或者不指向自己。</li>
</ol>
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/JDK1.6-ConcurrentLinkedQueue/#more">阅读更多</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2016-05-01T04:37:22.000Z">2016-05-01</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/JDK6-源码/">JDK6 源码</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    26 分钟 读完 (大约 3879 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/JDK1.6-ConcurrentHashMap/">JDK1.6 ConcurrentHashMap</a>
            
        </h1>
        <div class="content">
            <!-- TOC -->
<ul>
<li><a href="#1-%E7%AE%80%E4%BB%8B">1 简介</a></li>
<li><a href="#2-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90">2 源码分析</a><ul>
<li><a href="#concurrentmapputifabsent">ConcurrentMap#putIfAbsent()</a></li>
<li><a href="#concurrentmapremove">ConcurrentMap#remove()</a></li>
<li><a href="#concurrentmapreplacek-key-v-oldvalue-v-newvalue">ConcurrentMap#replace(K key, V oldValue, V newValue)</a></li>
<li><a href="#concurrentmapreplacek-key-v-value">ConcurrentMap#replace(K key, V value)</a></li>
<li><a href="#concurrenthashmap%E5%B1%9E%E6%80%A7">ConcurrentHashMap属性</a></li>
<li><a href="#concurrenthashmapsegmentkv">ConcurrentHashMap#Segment&lt;K,V&gt;</a></li>
<li><a href="#concurrenthashmapsegmentkv%E5%B1%9E%E6%80%A7">ConcurrentHashMap#Segment&lt;K,V&gt;属性</a></li>
<li><a href="#concurrenthashmapsegmentkv%E6%9E%84%E9%80%A0">ConcurrentHashMap#Segment&lt;K,V&gt;构造</a></li>
<li><a href="#concurrenthashmapsegmentkvsettable">ConcurrentHashMap#Segment&lt;K,V&gt;#setTable</a></li>
<li><a href="#concurrenthashmaphashentry">ConcurrentHashMap#HashEntry</a></li>
<li><a href="#concurrenthashmapconstants">ConcurrentHashMap#Constants</a></li>
<li><a href="#concurrenthashmap%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95">ConcurrentHashMap构造方法</a></li>
<li><a href="#concurrenthashmapput">ConcurrentHashMap#put()</a></li>
<li><a href="#concurrenthashmaphash">ConcurrentHashMap#hash()</a></li>
<li><a href="#concurrenthashmapsegmentfor">ConcurrentHashMap#segmentFor()</a></li>
<li><a href="#concurrenthashmapsegmentput">ConcurrentHashMap#Segment#put()</a></li>
<li><a href="#concurrenthashmapsegmentrehash">ConcurrentHashMap#Segment#rehash()</a></li>
<li><a href="#concurrenthashmapget">ConcurrentHashMap#get()</a></li>
<li><a href="#concurrenthashmapsegmentget">ConcurrentHashMap#Segment#get()</a></li>
<li><a href="#concurrenthashmapsegmentgetfirst">ConcurrentHashMap#Segment#getFirst()</a></li>
<li><a href="#concurrenthashmapsegmentreadvalueunderlock">ConcurrentHashMap#Segment#readValueUnderLock()</a></li>
<li><a href="#concurrenthashmapsegmentremove">ConcurrentHashMap#Segment#remove()</a></li>
<li><a href="#concurrenthashmapsize">ConcurrentHashMap#size()</a></li>
</ul>
</li>
<li><a href="#3-%E6%80%BB%E7%BB%93">3 总结</a><ul>
<li><a href="#count">count</a></li>
<li><a href="#lock">lock()</a></li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h1 id="1-简介"><a href="#1-简介" class="headerlink" title="1 简介"></a>1 简介</h1><p>ConcurrentHashMap是一种线程安全的HashMap。相对于HashTable和Collections.synchronizedMap()，ConcurrentHashMap具有更好的性能和伸缩性，是由于其使用了分段锁的策略，将内部数据分为多个段，每个段单独加锁，而不是整个HashMap加锁，这样能减少很多不必要的锁争用。  </p>
<h1 id="2-源码分析"><a href="#2-源码分析" class="headerlink" title="2 源码分析"></a>2 源码分析</h1><p>类结构图<br><img src="./concirrentHashMap-1.jpg" alt></p>
<h2 id="ConcurrentMap-putIfAbsent"><a href="#ConcurrentMap-putIfAbsent" class="headerlink" title="ConcurrentMap#putIfAbsent()"></a>ConcurrentMap#putIfAbsent()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * If the specified key is not already associated</span></span><br><span class="line"><span class="hljs-comment">     * with a value, associate it with the given value.</span></span><br><span class="line"><span class="hljs-comment">     * This is equivalent to</span></span><br><span class="line"><span class="hljs-comment">     * &lt;pre&gt;</span></span><br><span class="line"><span class="hljs-comment">     *   if (!map.containsKey(key))</span></span><br><span class="line"><span class="hljs-comment">     *       return map.put(key, value);</span></span><br><span class="line"><span class="hljs-comment">     *   else</span></span><br><span class="line"><span class="hljs-comment">     *       return map.get(key);&lt;/pre&gt;</span></span><br><span class="line"><span class="hljs-comment">     * except that the action is performed atomically.</span></span><br><span class="line"><span class="hljs-comment">     * ...</span></span><br><span class="line"><span class="hljs-comment">     * ...</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function">V <span class="hljs-title">putIfAbsent</span><span class="hljs-params">(K key, V value)</span></span>;</span><br></pre></td></tr></table></figure>
<p>如果map中已经存在给定的key，返回map中key对应的value；如果不存在给定的key，插入给定的key和value。<br>这个是一个原子操作，逻辑相当于如下代码。<br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">if</span> (!map.containsKey(key))</span><br><span class="line">      <span class="hljs-keyword">return</span> map.put(key, value);</span><br><span class="line">  <span class="hljs-keyword">else</span></span><br><span class="line">      <span class="hljs-keyword">return</span> map.get(key);</span><br></pre></td></tr></table></figure></p>
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/JDK1.6-ConcurrentHashMap/#more">阅读更多</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>









    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous">
            <a class="is-flex-grow has-text-black-ter" href="/categories/JDK6-源码/">上一页</a>
        </div>
        <div class="pagination-next is-invisible is-hidden-mobile">
            <a class="is-flex-grow has-text-black-ter" href="/categories/JDK6-源码/page/3/">下一页</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link has-text-black-ter" href="/categories/JDK6-源码/">1</a></li>
            
            <li><a class="pagination-link is-current" href="/categories/JDK6-源码/page/2/">2</a></li>
            
        </ul>
    </nav>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered">
                <div>
                    
                        <img class="image is-128x128 has-mb-6" src="/images/thank-you-kobe.jpg" alt="Joe">
                    
                    
                    <p class="is-size-4 is-block">
                        Joe
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Developer &amp; Designer
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Shenzhen, China</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <p class="title has-text-weight-normal">
                        129
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        分类
                    </p>
                    <p class="title has-text-weight-normal">
                        26
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        标签
                    </p>
                    <p class="title has-text-weight-normal">
                        54
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/joeskye1701">
                关注我</a>
        </div>
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Github" href="https://github.com/joeskye1701">
                
                <i class="fab fa-github"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        

<div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            链接
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="http://wss.xxyseo.cn/" target="_blank">
                    <span class="level-left">
                        <span class="level-item">西乡大佬</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">wss.xxyseo.cn</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>


    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                分类
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/Android/">
            <span class="level-start">
                <span class="level-item">Android</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JDK6-源码/">
            <span class="level-start">
                <span class="level-item">JDK6 源码</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">18</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JDK7-源码/">
            <span class="level-start">
                <span class="level-item">JDK7 源码</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JDK8-源码/">
            <span class="level-start">
                <span class="level-item">JDK8 源码</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JMM/">
            <span class="level-start">
                <span class="level-item">JMM</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JVM/">
            <span class="level-start">
                <span class="level-item">JVM</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">10</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Java/">
            <span class="level-start">
                <span class="level-item">Java</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">20</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Linux/">
            <span class="level-start">
                <span class="level-item">Linux</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/MyBatis/">
            <span class="level-start">
                <span class="level-item">MyBatis</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/MySQL/">
            <span class="level-start">
                <span class="level-item">MySQL</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Redis/">
            <span class="level-start">
                <span class="level-item">Redis</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Spring/">
            <span class="level-start">
                <span class="level-item">Spring</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Tomcat/">
            <span class="level-start">
                <span class="level-item">Tomcat</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">7</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/书/">
            <span class="level-start">
                <span class="level-item">书</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/多线程/">
            <span class="level-start">
                <span class="level-item">多线程</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/并发/">
            <span class="level-start">
                <span class="level-item">并发</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/开源项目/">
            <span class="level-start">
                <span class="level-item">开源项目</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/数学/">
            <span class="level-start">
                <span class="level-item">数学</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/数据库/">
            <span class="level-start">
                <span class="level-item">数据库</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/数据结构/">
            <span class="level-start">
                <span class="level-item">数据结构</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">5</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/日语/">
            <span class="level-start">
                <span class="level-item">日语</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/机器学习/">
            <span class="level-start">
                <span class="level-item">机器学习</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/算法/">
            <span class="level-start">
                <span class="level-item">算法</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">23</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/计算机基础/">
            <span class="level-start">
                <span class="level-item">计算机基础</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/设计模式/">
            <span class="level-start">
                <span class="level-item">设计模式</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/面试/">
            <span class="level-start">
                <span class="level-item">面试</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            标签云
        </h3>
        <a href="/tags/Android/" style="font-size: 10px;">Android</a> <a href="/tags/Centos/" style="font-size: 11.82px;">Centos</a> <a href="/tags/Effect-Java/" style="font-size: 10.91px;">Effect Java</a> <a href="/tags/JDK6-源码/" style="font-size: 18.18px;">JDK6 源码</a> <a href="/tags/JDK7-源码/" style="font-size: 14.55px;">JDK7 源码</a> <a href="/tags/JDK8-源码/" style="font-size: 10px;">JDK8 源码</a> <a href="/tags/JMM/" style="font-size: 15.45px;">JMM</a> <a href="/tags/JVM/" style="font-size: 16.36px;">JVM</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/Linux/" style="font-size: 12.73px;">Linux</a> <a href="/tags/MongoDB/" style="font-size: 10px;">MongoDB</a> <a href="/tags/Mongodb/" style="font-size: 10px;">Mongodb</a> <a href="/tags/MyBatis/" style="font-size: 11.82px;">MyBatis</a> <a href="/tags/MySQL/" style="font-size: 10.91px;">MySQL</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/Spring/" style="font-size: 12.73px;">Spring</a> <a href="/tags/Think-In-Java/" style="font-size: 10px;">Think In Java</a> <a href="/tags/Tomcat/" style="font-size: 15.45px;">Tomcat</a> <a href="/tags/Ubuntu/" style="font-size: 10px;">Ubuntu</a> <a href="/tags/一致性哈希算法/" style="font-size: 10px;">一致性哈希算法</a> <a href="/tags/书/" style="font-size: 11.82px;">书</a> <a href="/tags/倒排索引/" style="font-size: 10px;">倒排索引</a> <a href="/tags/内存泄漏/" style="font-size: 10px;">内存泄漏</a> <a href="/tags/分支限界算法/" style="font-size: 10.91px;">分支限界算法</a> <a href="/tags/分治法/" style="font-size: 10px;">分治法</a> <a href="/tags/分治算法/" style="font-size: 10px;">分治算法</a> <a href="/tags/分词算法/" style="font-size: 10.91px;">分词算法</a> <a href="/tags/动态规划/" style="font-size: 10px;">动态规划</a> <a href="/tags/动态规划算法/" style="font-size: 10.91px;">动态规划算法</a> <a href="/tags/华为/" style="font-size: 10px;">华为</a> <a href="/tags/回溯算法/" style="font-size: 12.73px;">回溯算法</a> <a href="/tags/多线程/" style="font-size: 10.91px;">多线程</a> <a href="/tags/工具/" style="font-size: 10px;">工具</a> <a href="/tags/并发/" style="font-size: 13.64px;">并发</a> <a href="/tags/开源项目/" style="font-size: 17.27px;">开源项目</a> <a href="/tags/手机游戏/" style="font-size: 10px;">手机游戏</a> <a href="/tags/排序算法/" style="font-size: 10px;">排序算法</a> <a href="/tags/推荐/" style="font-size: 10px;">推荐</a> <a href="/tags/散列表/" style="font-size: 10px;">散列表</a> <a href="/tags/数学/" style="font-size: 10px;">数学</a> <a href="/tags/数据库/" style="font-size: 10.91px;">数据库</a> <a href="/tags/数据结构/" style="font-size: 13.64px;">数据结构</a> <a href="/tags/日语/" style="font-size: 10px;">日语</a> <a href="/tags/最优路径算法/" style="font-size: 10px;">最优路径算法</a> <a href="/tags/机器学习/" style="font-size: 10px;">机器学习</a> <a href="/tags/源码/" style="font-size: 11.82px;">源码</a> <a href="/tags/算法/" style="font-size: 19.09px;">算法</a> <a href="/tags/线程安全/" style="font-size: 10.91px;">线程安全</a> <a href="/tags/编程珠玑/" style="font-size: 11.82px;">编程珠玑</a> <a href="/tags/计算机基础/" style="font-size: 10px;">计算机基础</a> <a href="/tags/设计模式/" style="font-size: 12.73px;">设计模式</a> <a href="/tags/贪心算法/" style="font-size: 11.82px;">贪心算法</a> <a href="/tags/跳表/" style="font-size: 10px;">跳表</a> <a href="/tags/面试/" style="font-size: 10px;">面试</a>
    </div>
</div>

    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            
        
            
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            <!-- 
            <a href="/VIM-Command/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="VIM 命令">
                </p>
            </a>
             -->
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-12-10T02:31:22.000Z">2018-12-10</time></div>
                    <a href="/VIM-Command/" class="has-link-black-ter is-size-6">VIM 命令</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Linux/">Linux</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            <!-- 
            <a href="/Lock-Control/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="锁粒度的控制">
                </p>
            </a>
             -->
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-04T04:37:22.000Z">2018-11-04</time></div>
                    <a href="/Lock-Control/" class="has-link-black-ter is-size-6">锁粒度的控制</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Linux/">Linux</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            <!-- 
            <a href="/Temporary-Menory-Table/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="临时表和内存表">
                </p>
            </a>
             -->
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-04T04:37:22.000Z">2018-11-04</time></div>
                    <a href="/Temporary-Menory-Table/" class="has-link-black-ter is-size-6">临时表和内存表</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/MySQL/">MySQL</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            <!-- 
            <a href="/Python2ToPython3/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Python2切换Python3">
                </p>
            </a>
             -->
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-03T04:37:22.000Z">2018-11-03</time></div>
                    <a href="/Python2ToPython3/" class="has-link-black-ter is-size-6">Python2切换Python3</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Linux/">Linux</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            <!-- 
            <a href="/SDCard-Read-Write/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="SDCard文件读写权限">
                </p>
            </a>
             -->
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-03T04:37:22.000Z">2018-11-03</time></div>
                    <a href="/SDCard-Read-Write/" class="has-link-black-ter is-size-6">SDCard文件读写权限</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Android/">Android</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2018/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">一月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/01/">
                <span class="level-start">
                    <span class="level-item">一月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/10/">
                <span class="level-start">
                    <span class="level-item">十月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">9</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/09/">
                <span class="level-start">
                    <span class="level-item">九月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">八月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/07/">
                <span class="level-start">
                    <span class="level-item">七月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/06/">
                <span class="level-start">
                    <span class="level-item">六月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/05/">
                <span class="level-start">
                    <span class="level-item">五月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/04/">
                <span class="level-start">
                    <span class="level-item">四月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/03/">
                <span class="level-start">
                    <span class="level-item">三月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/02/">
                <span class="level-start">
                    <span class="level-item">二月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/10/">
                <span class="level-start">
                    <span class="level-item">十月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">13</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/09/">
                <span class="level-start">
                    <span class="level-item">九月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/08/">
                <span class="level-start">
                    <span class="level-item">八月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/07/">
                <span class="level-start">
                    <span class="level-item">七月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/06/">
                <span class="level-start">
                    <span class="level-item">六月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/05/">
                <span class="level-start">
                    <span class="level-item">五月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/04/">
                <span class="level-start">
                    <span class="level-item">四月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/03/">
                <span class="level-start">
                    <span class="level-item">三月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/02/">
                <span class="level-start">
                    <span class="level-item">二月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/01/">
                <span class="level-start">
                    <span class="level-item">一月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/09/">
                <span class="level-start">
                    <span class="level-item">九月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/03/">
                <span class="level-start">
                    <span class="level-item">三月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/10/">
                <span class="level-start">
                    <span class="level-item">十月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/08/">
                <span class="level-start">
                    <span class="level-item">八月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/07/">
                <span class="level-start">
                    <span class="level-item">七月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/06/">
                <span class="level-start">
                    <span class="level-item">六月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/04/">
                <span class="level-start">
                    <span class="level-item">四月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/03/">
                <span class="level-start">
                    <span class="level-item">三月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/02/">
                <span class="level-start">
                    <span class="level-item">二月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/01/">
                <span class="level-start">
                    <span class="level-item">一月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Android/">
                        <span class="tag">Android</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Centos/">
                        <span class="tag">Centos</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Effect-Java/">
                        <span class="tag">Effect Java</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JDK6-源码/">
                        <span class="tag">JDK6 源码</span>
                        <span class="tag is-grey">18</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JDK7-源码/">
                        <span class="tag">JDK7 源码</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JDK8-源码/">
                        <span class="tag">JDK8 源码</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JMM/">
                        <span class="tag">JMM</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JVM/">
                        <span class="tag">JVM</span>
                        <span class="tag is-grey">10</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Java/">
                        <span class="tag">Java</span>
                        <span class="tag is-grey">40</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Linux/">
                        <span class="tag">Linux</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MongoDB/">
                        <span class="tag">MongoDB</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Mongodb/">
                        <span class="tag">Mongodb</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MyBatis/">
                        <span class="tag">MyBatis</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MySQL/">
                        <span class="tag">MySQL</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Redis/">
                        <span class="tag">Redis</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Spring/">
                        <span class="tag">Spring</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Think-In-Java/">
                        <span class="tag">Think In Java</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Tomcat/">
                        <span class="tag">Tomcat</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Ubuntu/">
                        <span class="tag">Ubuntu</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/一致性哈希算法/">
                        <span class="tag">一致性哈希算法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/书/">
                        <span class="tag">书</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/倒排索引/">
                        <span class="tag">倒排索引</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/内存泄漏/">
                        <span class="tag">内存泄漏</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/分支限界算法/">
                        <span class="tag">分支限界算法</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/分治法/">
                        <span class="tag">分治法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/分治算法/">
                        <span class="tag">分治算法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/分词算法/">
                        <span class="tag">分词算法</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/动态规划/">
                        <span class="tag">动态规划</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/动态规划算法/">
                        <span class="tag">动态规划算法</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/华为/">
                        <span class="tag">华为</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/回溯算法/">
                        <span class="tag">回溯算法</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/多线程/">
                        <span class="tag">多线程</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/工具/">
                        <span class="tag">工具</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/并发/">
                        <span class="tag">并发</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/开源项目/">
                        <span class="tag">开源项目</span>
                        <span class="tag is-grey">17</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/手机游戏/">
                        <span class="tag">手机游戏</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/排序算法/">
                        <span class="tag">排序算法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/推荐/">
                        <span class="tag">推荐</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/散列表/">
                        <span class="tag">散列表</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数学/">
                        <span class="tag">数学</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数据库/">
                        <span class="tag">数据库</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数据结构/">
                        <span class="tag">数据结构</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/日语/">
                        <span class="tag">日语</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/最优路径算法/">
                        <span class="tag">最优路径算法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/机器学习/">
                        <span class="tag">机器学习</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/源码/">
                        <span class="tag">源码</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/算法/">
                        <span class="tag">算法</span>
                        <span class="tag is-grey">26</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/线程安全/">
                        <span class="tag">线程安全</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/编程珠玑/">
                        <span class="tag">编程珠玑</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/计算机基础/">
                        <span class="tag">计算机基础</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/设计模式/">
                        <span class="tag">设计模式</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/贪心算法/">
                        <span class="tag">贪心算法</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/跳表/">
                        <span class="tag">跳表</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/面试/">
                        <span class="tag">面试</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            <!-- 
            <a href="/VIM-Command/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="VIM 命令">
                </p>
            </a>
             -->
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-12-10T02:31:22.000Z">2018-12-10</time></div>
                    <a href="/VIM-Command/" class="has-link-black-ter is-size-6">VIM 命令</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Linux/">Linux</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            <!-- 
            <a href="/Lock-Control/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="锁粒度的控制">
                </p>
            </a>
             -->
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-04T04:37:22.000Z">2018-11-04</time></div>
                    <a href="/Lock-Control/" class="has-link-black-ter is-size-6">锁粒度的控制</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Linux/">Linux</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            <!-- 
            <a href="/Temporary-Menory-Table/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="临时表和内存表">
                </p>
            </a>
             -->
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-04T04:37:22.000Z">2018-11-04</time></div>
                    <a href="/Temporary-Menory-Table/" class="has-link-black-ter is-size-6">临时表和内存表</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/MySQL/">MySQL</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            <!-- 
            <a href="/Python2ToPython3/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Python2切换Python3">
                </p>
            </a>
             -->
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-03T04:37:22.000Z">2018-11-03</time></div>
                    <a href="/Python2ToPython3/" class="has-link-black-ter is-size-6">Python2切换Python3</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Linux/">Linux</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            <!-- 
            <a href="/SDCard-Read-Write/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="SDCard文件读写权限">
                </p>
            </a>
             -->
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-03T04:37:22.000Z">2018-11-03</time></div>
                    <a href="/SDCard-Read-Write/" class="has-link-black-ter is-size-6">SDCard文件读写权限</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Android/">Android</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2018/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">一月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/01/">
                <span class="level-start">
                    <span class="level-item">一月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/10/">
                <span class="level-start">
                    <span class="level-item">十月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">9</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/09/">
                <span class="level-start">
                    <span class="level-item">九月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">八月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/07/">
                <span class="level-start">
                    <span class="level-item">七月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/06/">
                <span class="level-start">
                    <span class="level-item">六月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/05/">
                <span class="level-start">
                    <span class="level-item">五月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/04/">
                <span class="level-start">
                    <span class="level-item">四月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/03/">
                <span class="level-start">
                    <span class="level-item">三月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/02/">
                <span class="level-start">
                    <span class="level-item">二月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/10/">
                <span class="level-start">
                    <span class="level-item">十月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">13</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/09/">
                <span class="level-start">
                    <span class="level-item">九月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/08/">
                <span class="level-start">
                    <span class="level-item">八月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/07/">
                <span class="level-start">
                    <span class="level-item">七月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/06/">
                <span class="level-start">
                    <span class="level-item">六月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/05/">
                <span class="level-start">
                    <span class="level-item">五月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/04/">
                <span class="level-start">
                    <span class="level-item">四月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/03/">
                <span class="level-start">
                    <span class="level-item">三月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/02/">
                <span class="level-start">
                    <span class="level-item">二月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/01/">
                <span class="level-start">
                    <span class="level-item">一月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/09/">
                <span class="level-start">
                    <span class="level-item">九月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/03/">
                <span class="level-start">
                    <span class="level-item">三月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/10/">
                <span class="level-start">
                    <span class="level-item">十月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/08/">
                <span class="level-start">
                    <span class="level-item">八月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/07/">
                <span class="level-start">
                    <span class="level-item">七月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/06/">
                <span class="level-start">
                    <span class="level-item">六月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/04/">
                <span class="level-start">
                    <span class="level-item">四月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/03/">
                <span class="level-start">
                    <span class="level-item">三月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/02/">
                <span class="level-start">
                    <span class="level-item">二月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/01/">
                <span class="level-start">
                    <span class="level-item">一月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Android/">
                        <span class="tag">Android</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Centos/">
                        <span class="tag">Centos</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Effect-Java/">
                        <span class="tag">Effect Java</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JDK6-源码/">
                        <span class="tag">JDK6 源码</span>
                        <span class="tag is-grey">18</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JDK7-源码/">
                        <span class="tag">JDK7 源码</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JDK8-源码/">
                        <span class="tag">JDK8 源码</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JMM/">
                        <span class="tag">JMM</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JVM/">
                        <span class="tag">JVM</span>
                        <span class="tag is-grey">10</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Java/">
                        <span class="tag">Java</span>
                        <span class="tag is-grey">40</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Linux/">
                        <span class="tag">Linux</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MongoDB/">
                        <span class="tag">MongoDB</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Mongodb/">
                        <span class="tag">Mongodb</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MyBatis/">
                        <span class="tag">MyBatis</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MySQL/">
                        <span class="tag">MySQL</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Redis/">
                        <span class="tag">Redis</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Spring/">
                        <span class="tag">Spring</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Think-In-Java/">
                        <span class="tag">Think In Java</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Tomcat/">
                        <span class="tag">Tomcat</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Ubuntu/">
                        <span class="tag">Ubuntu</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/一致性哈希算法/">
                        <span class="tag">一致性哈希算法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/书/">
                        <span class="tag">书</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/倒排索引/">
                        <span class="tag">倒排索引</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/内存泄漏/">
                        <span class="tag">内存泄漏</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/分支限界算法/">
                        <span class="tag">分支限界算法</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/分治法/">
                        <span class="tag">分治法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/分治算法/">
                        <span class="tag">分治算法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/分词算法/">
                        <span class="tag">分词算法</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/动态规划/">
                        <span class="tag">动态规划</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/动态规划算法/">
                        <span class="tag">动态规划算法</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/华为/">
                        <span class="tag">华为</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/回溯算法/">
                        <span class="tag">回溯算法</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/多线程/">
                        <span class="tag">多线程</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/工具/">
                        <span class="tag">工具</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/并发/">
                        <span class="tag">并发</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/开源项目/">
                        <span class="tag">开源项目</span>
                        <span class="tag is-grey">17</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/手机游戏/">
                        <span class="tag">手机游戏</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/排序算法/">
                        <span class="tag">排序算法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/推荐/">
                        <span class="tag">推荐</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/散列表/">
                        <span class="tag">散列表</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数学/">
                        <span class="tag">数学</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数据库/">
                        <span class="tag">数据库</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数据结构/">
                        <span class="tag">数据结构</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/日语/">
                        <span class="tag">日语</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/最优路径算法/">
                        <span class="tag">最优路径算法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/机器学习/">
                        <span class="tag">机器学习</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/源码/">
                        <span class="tag">源码</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/算法/">
                        <span class="tag">算法</span>
                        <span class="tag is-grey">26</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/线程安全/">
                        <span class="tag">线程安全</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/编程珠玑/">
                        <span class="tag">编程珠玑</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/计算机基础/">
                        <span class="tag">计算机基础</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/设计模式/">
                        <span class="tag">设计模式</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/贪心算法/">
                        <span class="tag">贪心算法</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/跳表/">
                        <span class="tag">跳表</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/面试/">
                        <span class="tag">面试</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    Joe|博客
                
                </a>
                <p class="is-size-7">
                &copy; 2019 Joe&nbsp;
                <!-- Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        href="http://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a> -->
                
                </p>
            </div>
            <div class="level-end">
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>


    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    <script src="/js/clipboard.js" defer></script>
    

    
    
    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么...">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>