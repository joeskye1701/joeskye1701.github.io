<!DOCTYPE html>
<html lang="zh">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
<title>JDK1.6 ThreadPoolExecutor - Joe|博客</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



    <meta name="description" content="1 介绍 2 源码分析 Executor ExecutorService AbstractExecutorService#newTaskFor AbstractExecutorService#submit AbstractExecutorService#doInvokeAny() AbstractExecutorService#invokeAny() AbstractExecutorServi">
<meta name="keywords" content="JDK6 源码">
<meta property="og:type" content="article">
<meta property="og:title" content="JDK1.6 ThreadPoolExecutor">
<meta property="og:url" content="https://joeskye1701.github.io/JDK1.6-ThreadPoolExecutor/index.html">
<meta property="og:site_name" content="Joe|博客">
<meta property="og:description" content="1 介绍 2 源码分析 Executor ExecutorService AbstractExecutorService#newTaskFor AbstractExecutorService#submit AbstractExecutorService#doInvokeAny() AbstractExecutorService#invokeAny() AbstractExecutorServi">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://joeskye1701.github.io/JDK1.6-ThreadPoolExecutor/ThreadPoolExecutor-1-1.jpg">
<meta property="og:image" content="https://joeskye1701.github.io/JDK1.6-ThreadPoolExecutor/ThreadPoolExecutor-1-2.jpg">
<meta property="og:updated_time" content="2019-03-06T19:32:36.784Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JDK1.6 ThreadPoolExecutor">
<meta name="twitter:description" content="1 介绍 2 源码分析 Executor ExecutorService AbstractExecutorService#newTaskFor AbstractExecutorService#submit AbstractExecutorService#doInvokeAny() AbstractExecutorService#invokeAny() AbstractExecutorServi">
<meta name="twitter:image" content="https://joeskye1701.github.io/JDK1.6-ThreadPoolExecutor/ThreadPoolExecutor-1-1.jpg">





<link rel="icon" href="/images/thank-you-kobe.jpg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/xcode.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    

    
    
<script>
var _hmt = _hmt || [];
(function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?c422b171d3bdb7dbfae47ff3f70f9d30";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
})();
</script>

    
    

    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    

    
    
    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                Joe|博客
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item" href="/">主页</a>
                
                <a class="navbar-item" href="/archives">归档</a>
                
                <a class="navbar-item" href="/categories">分类</a>
                
                <a class="navbar-item" href="/tags">标签</a>
                
                <a class="navbar-item" href="/about">关于</a>
                
            </div>
            
            <div class="navbar-end">
                
                
                <a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;">
                    <i class="fas fa-list-ul"></i>
                </a>
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main"><div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2016-09-19T04:37:22.000Z">2016-09-19</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/JDK6-源码/">JDK6 源码</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    44 分钟 读完 (大约 6548 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                JDK1.6 ThreadPoolExecutor
            
        </h1>
        <div class="content">
            <!-- TOC -->
<ul>
<li><a href="#1-%E4%BB%8B%E7%BB%8D">1 介绍</a></li>
<li><a href="#2-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90">2 源码分析</a><ul>
<li><a href="#executor">Executor</a></li>
<li><a href="#executorservice">ExecutorService</a></li>
<li><a href="#abstractexecutorservicenewtaskfor">AbstractExecutorService#newTaskFor</a></li>
<li><a href="#abstractexecutorservicesubmit">AbstractExecutorService#submit</a></li>
<li><a href="#abstractexecutorservicedoinvokeany">AbstractExecutorService#doInvokeAny()</a></li>
<li><a href="#abstractexecutorserviceinvokeany">AbstractExecutorService#invokeAny()</a></li>
<li><a href="#abstractexecutorserviceinvokeall">AbstractExecutorService#invokeAll()</a></li>
<li><a href="#threadpoolexecutor">ThreadPoolExecutor</a></li>
<li><a href="#threadpoolexecutor-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0">ThreadPoolExecutor 构造函数</a></li>
<li><a href="#executorsdefaultthreadfactory">Executors#defaultThreadFactory()</a></li>
<li><a href="#executorsdefaultthreadfactory">Executors#DefaultThreadFactory</a></li>
<li><a href="#threadpoolexecutorexecute">ThreadPoolExecutor#execute()</a></li>
<li><a href="#threadpoolexecutoraddifundercorepoolsize">ThreadPoolExecutor#addIfUnderCorePoolSize()</a></li>
<li><a href="#threadpoolexecutoraddthread">ThreadPoolExecutor#addThread()</a></li>
<li><a href="#threadpoolexecutorworker">ThreadPoolExecutor#Worker</a></li>
<li><a href="#threadpoolexecutorbeforeexecute">ThreadPoolExecutor#beforeExecute()</a></li>
<li><a href="#threadpoolexecutorafterexecute">ThreadPoolExecutor#afterExecute()</a></li>
<li><a href="#threadpoolexecutorgettask">ThreadPoolExecutor#getTask()</a></li>
<li><a href="#threadpoolexecutorworkercanexit">ThreadPoolExecutor#workerCanExit()</a></li>
<li><a href="#threadpoolexecutorinterruptidleworkers">ThreadPoolExecutor#interruptIdleWorkers()</a></li>
<li><a href="#threadpoolexecutorworkerdone">ThreadPoolExecutor#workerDone()</a></li>
<li><a href="#threadpoolexecutortryterminate">ThreadPoolExecutor#tryTerminate()</a></li>
<li><a href="#threadpoolexecutorensurequeuedtaskhandled">ThreadPoolExecutor#ensureQueuedTaskHandled()</a></li>
<li><a href="#threadpoolexecutoraddifundermaximumpoolsize">ThreadPoolExecutor#addIfUnderMaximumPoolSize()</a></li>
<li><a href="#threadpoolexecutorshutdown">ThreadPoolExecutor#shutdown()</a></li>
<li><a href="#threadpoolexecutorshutdownnow">ThreadPoolExecutor#shutdownNow()</a></li>
<li><a href="#threadpoolexecutordrainqueue">ThreadPoolExecutor#drainQueue()</a></li>
<li><a href="#threadpoolexecutorawaittermination">ThreadPoolExecutor#awaitTermination()</a></li>
<li><a href="#threadpoolexecutorfinalize">ThreadPoolExecutor#finalize()</a></li>
<li><a href="#threadpoolexecutorprestartcorethread">ThreadPoolExecutor#prestartCoreThread()</a></li>
<li><a href="#threadpoolexecutorprestartallcorethreads">ThreadPoolExecutor#prestartAllCoreThreads()</a></li>
<li><a href="#threadpoolexecutorsetcorepoolsize">ThreadPoolExecutor#setCorePoolSize()</a></li>
<li><a href="#threadpoolexecutorsetmaximumpoolsize">ThreadPoolExecutor#setMaximumPoolSize()</a></li>
<li><a href="#%E5%AE%9E%E7%8E%B0rejectedexecutionhandler%E6%8E%A5%E5%8F%A3">实现RejectedExecutionHandler接口</a><ul>
<li><a href="#threadpoolexecutorabortpolicy">ThreadPoolExecutor#AbortPolicy</a></li>
<li><a href="#threadpoolexecutorcallerrunspolicy">ThreadPoolExecutor#CallerRunsPolicy</a></li>
<li><a href="#threadpoolexecutordiscardpolicy">ThreadPoolExecutor#DiscardPolicy</a></li>
<li><a href="#threadpoolexecutordiscardoldestpolicy">ThreadPoolExecutor#DiscardOldestPolicy</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#3-%E6%80%BB%E7%BB%93">3 总结</a></li>
</ul>
<!-- /TOC -->
<h1 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1 介绍"></a>1 介绍</h1><p>ThreadPoolExecutor是JUC包中提供的线程池，使用ThreadPoolExecutor的好处一方面是能重用线程资源，避免重复创建线程带来的开销；另一方面是ThreadPoolExecutor提供了内部资源(线程、任务)的管理功能，方便我们监控线程池工作状态。</p>
<h1 id="2-源码分析"><a href="#2-源码分析" class="headerlink" title="2 源码分析"></a>2 源码分析</h1><p>ThreadPoolExecutor类结构图<br><img src="./ThreadPoolExecutor-1-1.jpg" alt></p>
<h2 id="Executor"><a href="#Executor" class="headerlink" title="Executor"></a>Executor</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Executor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Executes the given command at some time in the future.  The command</span></span><br><span class="line"><span class="hljs-comment">     * may execute in a new thread, in a pooled thread, or in the calling</span></span><br><span class="line"><span class="hljs-comment">     * thread, at the discretion of the &lt;tt&gt;Executor&lt;/tt&gt; implementation.</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> command the runnable task</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> RejectedExecutionException if this task cannot be</span></span><br><span class="line"><span class="hljs-comment">     * accepted for execution.</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> NullPointerException if command is null</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-comment">// 1</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">(Runnable command)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>标注代码分析</p>
<ol>
<li>根据注释很好理解。command可以在新线程里执行，可以在线程池里执行，可以被调用线程执行等等。</li>
</ol>
<a id="more"></a>
<h2 id="ExecutorService"><a href="#ExecutorService" class="headerlink" title="ExecutorService"></a>ExecutorService</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 1 </span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">shutdown</span><span class="hljs-params">()</span></span>;</span><br><span class="line"><span class="hljs-comment">// 2</span></span><br><span class="line"><span class="hljs-function">List&lt;Runnable&gt; <span class="hljs-title">shutdownNow</span><span class="hljs-params">()</span></span>;</span><br><span class="line"><span class="hljs-comment">// 3</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isShutdown</span><span class="hljs-params">()</span></span>;</span><br><span class="line"><span class="hljs-comment">// 4</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isTerminated</span><span class="hljs-params">()</span></span>;</span><br><span class="line"><span class="hljs-comment">// 5</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">awaitTermination</span><span class="hljs-params">(<span class="hljs-keyword">long</span> timeout, TimeUnit unit)</span></span></span><br><span class="line"><span class="hljs-function">    <span class="hljs-keyword">throws</span> InterruptedException</span>;</span><br><span class="line"><span class="hljs-comment">// 6</span></span><br><span class="line">&lt;T&gt; <span class="hljs-function">Future&lt;T&gt; <span class="hljs-title">submit</span><span class="hljs-params">(Callable&lt;T&gt; task)</span></span>;</span><br><span class="line"></span><br><span class="line">&lt;T&gt; <span class="hljs-function">Future&lt;T&gt; <span class="hljs-title">submit</span><span class="hljs-params">(Runnable task, T result)</span></span>;</span><br><span class="line"></span><br><span class="line">Future&lt;?&gt; submit(Runnable task);</span><br><span class="line"><span class="hljs-comment">// 7</span></span><br><span class="line">&lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span><br><span class="line">    <span class="hljs-keyword">throws</span> InterruptedException;</span><br><span class="line"></span><br><span class="line">&lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,</span><br><span class="line">                              <span class="hljs-keyword">long</span> timeout, TimeUnit unit)</span><br><span class="line">    <span class="hljs-keyword">throws</span> InterruptedException;</span><br><span class="line"><span class="hljs-comment">// 8</span></span><br><span class="line">&lt;T&gt; <span class="hljs-function">T <span class="hljs-title">invokeAny</span><span class="hljs-params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span></span></span><br><span class="line"><span class="hljs-function">    <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException</span>;</span><br><span class="line"></span><br><span class="line">&lt;T&gt; <span class="hljs-function">T <span class="hljs-title">invokeAny</span><span class="hljs-params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                <span class="hljs-keyword">long</span> timeout, TimeUnit unit)</span></span></span><br><span class="line"><span class="hljs-function">    <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException, TimeoutException</span>;</span><br></pre></td></tr></table></figure>
<p>标注代码分析</p>
<ol>
<li>关闭之前，已经提交的任务会被执行。新任务被拒绝。服务被关闭，则调用这个方法没有影响。</li>
<li>尝试停止所有正在执行的任务，停止处理正在等待的任务，并返回等待执行任务列表。并不能确保一定可以停止正在执行的任务。比如，通常的实现方式是中断执行任务的线程，但如果任务执行过程中并不响应中断，那就无法停止这个任务。</li>
<li>是否已经关闭。</li>
<li>关闭后，是否所有的任务都执行完毕。</li>
<li>在关闭、超时、任务中断后，任务执行完毕前，都阻塞。</li>
<li>提交任务。</li>
<li>执行任务集合。</li>
<li>执行一批任务，如果其中有一个任务完成，就返回结果。其他没有完成的任务会被取消。</li>
</ol>
<h2 id="AbstractExecutorService-newTaskFor"><a href="#AbstractExecutorService-newTaskFor" class="headerlink" title="AbstractExecutorService#newTaskFor"></a>AbstractExecutorService#newTaskFor</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Returns a &lt;tt&gt;RunnableFuture&lt;/tt&gt; for the given runnable and default</span></span><br><span class="line"><span class="hljs-comment">     * value.</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> runnable the runnable task being wrapped</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value the default value for the returned future</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> a &lt;tt&gt;RunnableFuture&lt;/tt&gt; which when run will run the</span></span><br><span class="line"><span class="hljs-comment">     * underlying runnable and which, as a &lt;tt&gt;Future&lt;/tt&gt;, will yield</span></span><br><span class="line"><span class="hljs-comment">     * the given value as its result and provide for cancellation of</span></span><br><span class="line"><span class="hljs-comment">     * the underlying task.</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@since</span> 1.6</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">protected</span> &lt;T&gt; <span class="hljs-function">RunnableFuture&lt;T&gt; <span class="hljs-title">newTaskFor</span><span class="hljs-params">(Runnable runnable, T value)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FutureTask&lt;T&gt;(runnable, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Returns a &lt;tt&gt;RunnableFuture&lt;/tt&gt; for the given callable task.</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> callable the callable task being wrapped</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> a &lt;tt&gt;RunnableFuture&lt;/tt&gt; which when run will call the</span></span><br><span class="line"><span class="hljs-comment">     * underlying callable and which, as a &lt;tt&gt;Future&lt;/tt&gt;, will yield</span></span><br><span class="line"><span class="hljs-comment">     * the callable's result as its result and provide for</span></span><br><span class="line"><span class="hljs-comment">     * cancellation of the underlying task.</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@since</span> 1.6</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">protected</span> &lt;T&gt; <span class="hljs-function">RunnableFuture&lt;T&gt; <span class="hljs-title">newTaskFor</span><span class="hljs-params">(Callable&lt;T&gt; callable)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FutureTask&lt;T&gt;(callable);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>将runnable、callable转换成FutureTask。</p>
<h2 id="AbstractExecutorService-submit"><a href="#AbstractExecutorService-submit" class="headerlink" title="AbstractExecutorService#submit"></a>AbstractExecutorService#submit</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> Future&lt;?&gt; submit(Runnable task) &#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (task == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();</span><br><span class="line">    RunnableFuture&lt;Object&gt; ftask = newTaskFor(task, <span class="hljs-keyword">null</span>);</span><br><span class="line">    execute(ftask);</span><br><span class="line">    <span class="hljs-keyword">return</span> ftask;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">Future&lt;T&gt; <span class="hljs-title">submit</span><span class="hljs-params">(Runnable task, T result)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (task == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();</span><br><span class="line">    RunnableFuture&lt;T&gt; ftask = newTaskFor(task, result);</span><br><span class="line">    execute(ftask);</span><br><span class="line">    <span class="hljs-keyword">return</span> ftask;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">Future&lt;T&gt; <span class="hljs-title">submit</span><span class="hljs-params">(Callable&lt;T&gt; task)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (task == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();</span><br><span class="line">    RunnableFuture&lt;T&gt; ftask = newTaskFor(task);</span><br><span class="line">    execute(ftask);</span><br><span class="line">    <span class="hljs-keyword">return</span> ftask;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>先转成RunnableFuture，然后提交到Executor，然后返回RunnableFuture(异步任务)。 </p>
<h2 id="AbstractExecutorService-doInvokeAny"><a href="#AbstractExecutorService-doInvokeAny" class="headerlink" title="AbstractExecutorService#doInvokeAny()"></a>AbstractExecutorService#doInvokeAny()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * the main mechanics of invokeAny.</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">private</span> &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">doInvokeAny</span><span class="hljs-params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                            <span class="hljs-keyword">boolean</span> timed, <span class="hljs-keyword">long</span> nanos)</span></span></span><br><span class="line"><span class="hljs-function">        <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException, TimeoutException </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (tasks == <span class="hljs-keyword">null</span>)</span><br><span class="line">            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();</span><br><span class="line">        <span class="hljs-keyword">int</span> ntasks = tasks.size();</span><br><span class="line">        <span class="hljs-keyword">if</span> (ntasks == <span class="hljs-number">0</span>)</span><br><span class="line">            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException();</span><br><span class="line">        List&lt;Future&lt;T&gt;&gt; futures= <span class="hljs-keyword">new</span> ArrayList&lt;Future&lt;T&gt;&gt;(ntasks);</span><br><span class="line">        ExecutorCompletionService&lt;T&gt; ecs =</span><br><span class="line">            <span class="hljs-keyword">new</span> ExecutorCompletionService&lt;T&gt;(<span class="hljs-keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">// For efficiency, especially in executors with limited</span></span><br><span class="line">        <span class="hljs-comment">// parallelism, check to see if previously submitted tasks are</span></span><br><span class="line">        <span class="hljs-comment">// done before submitting more of them. This interleaving</span></span><br><span class="line">        <span class="hljs-comment">// plus the exception mechanics account for messiness of main</span></span><br><span class="line">        <span class="hljs-comment">// loop.</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">            <span class="hljs-comment">// Record exceptions so that if we fail to obtain any</span></span><br><span class="line">            <span class="hljs-comment">// result, we can throw the last exception we got.</span></span><br><span class="line">            ExecutionException ee = <span class="hljs-keyword">null</span>;</span><br><span class="line">            <span class="hljs-keyword">long</span> lastTime = (timed)? System.nanoTime() : <span class="hljs-number">0</span>;</span><br><span class="line">            Iterator&lt;? extends Callable&lt;T&gt;&gt; it = tasks.iterator();</span><br><span class="line"></span><br><span class="line">            <span class="hljs-comment">// Start one task for sure; the rest incrementally</span></span><br><span class="line">            <span class="hljs-comment">// 1</span></span><br><span class="line">            futures.add(ecs.submit(it.next()));</span><br><span class="line">            --ntasks;</span><br><span class="line">            <span class="hljs-keyword">int</span> active = <span class="hljs-number">1</span>;</span><br><span class="line">            <span class="hljs-comment">// 2</span></span><br><span class="line">            <span class="hljs-keyword">for</span> (;;) &#123;</span><br><span class="line">                <span class="hljs-comment">// 3</span></span><br><span class="line">                Future&lt;T&gt; f = ecs.poll();</span><br><span class="line">                <span class="hljs-keyword">if</span> (f == <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">                    <span class="hljs-comment">// 4</span></span><br><span class="line">                    <span class="hljs-keyword">if</span> (ntasks &gt; <span class="hljs-number">0</span>) &#123;</span><br><span class="line">                        --ntasks;</span><br><span class="line">                        futures.add(ecs.submit(it.next()));</span><br><span class="line">                        ++active;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="hljs-comment">// 5</span></span><br><span class="line">                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (active == <span class="hljs-number">0</span>)</span><br><span class="line">                        <span class="hljs-keyword">break</span>;</span><br><span class="line">                        <span class="hljs-comment">// 6</span></span><br><span class="line">                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (timed) &#123;</span><br><span class="line">                        f = ecs.poll(nanos, TimeUnit.NANOSECONDS);</span><br><span class="line">                        <span class="hljs-keyword">if</span> (f == <span class="hljs-keyword">null</span>)</span><br><span class="line">                            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> TimeoutException();</span><br><span class="line">                        <span class="hljs-keyword">long</span> now = System.nanoTime();</span><br><span class="line">                        nanos -= now - lastTime;</span><br><span class="line">                        lastTime = now;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="hljs-keyword">else</span> <span class="hljs-comment">// 7</span></span><br><span class="line">                        f = ecs.take();</span><br><span class="line">                &#125;<span class="hljs-comment">// 8</span></span><br><span class="line">                <span class="hljs-keyword">if</span> (f != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">                    --active;</span><br><span class="line">                    <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">                        <span class="hljs-keyword">return</span> f.get();</span><br><span class="line">                    &#125; <span class="hljs-keyword">catch</span> (InterruptedException ie) &#123;</span><br><span class="line">                        <span class="hljs-keyword">throw</span> ie;</span><br><span class="line">                    &#125; <span class="hljs-keyword">catch</span> (ExecutionException eex) &#123;</span><br><span class="line">                        ee = eex;</span><br><span class="line">                    &#125; <span class="hljs-keyword">catch</span> (RuntimeException rex) &#123;</span><br><span class="line">                        ee = <span class="hljs-keyword">new</span> ExecutionException(rex);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">if</span> (ee == <span class="hljs-keyword">null</span>)</span><br><span class="line">                ee = <span class="hljs-keyword">new</span> ExecutionException();</span><br><span class="line">            <span class="hljs-keyword">throw</span> ee;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="hljs-keyword">finally</span> &#123;</span><br><span class="line">            <span class="hljs-comment">// 9</span></span><br><span class="line">            <span class="hljs-keyword">for</span> (Future&lt;T&gt; f : futures)</span><br><span class="line">                f.cancel(<span class="hljs-keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>标注代码分析</p>
<ol>
<li>首先提交1个任务，任务数量-1。</li>
<li>轮询。</li>
<li>ExecutorCompletionService中获取任务。</li>
<li>如果Future f=null，还有剩余任务(ntasks &gt; 0),提交任务到ExecutorCompletionService里，active+1。</li>
<li>没有在提交的任务，执行任务数量。(active = 0)</li>
<li>超时处理。</li>
<li>可能ExecutorCompletionService中的任务执行完毕，赋值给Future f。</li>
<li>f!=null，说明任务执行完成，active-1，返回Future#f#get()</li>
<li>没执行完的任务取消掉。</li>
</ol>
<h2 id="AbstractExecutorService-invokeAny"><a href="#AbstractExecutorService-invokeAny" class="headerlink" title="AbstractExecutorService#invokeAny()"></a>AbstractExecutorService#invokeAny()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">invokeAny</span><span class="hljs-params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span></span></span><br><span class="line"><span class="hljs-function">        <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> doInvokeAny(tasks, <span class="hljs-keyword">false</span>, <span class="hljs-number">0</span>);</span><br><span class="line">        &#125; <span class="hljs-keyword">catch</span> (TimeoutException cannotHappen) &#123;</span><br><span class="line">            <span class="hljs-keyword">assert</span> <span class="hljs-keyword">false</span>;</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">invokeAny</span><span class="hljs-params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                           <span class="hljs-keyword">long</span> timeout, TimeUnit unit)</span></span></span><br><span class="line"><span class="hljs-function">        <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException, TimeoutException </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> doInvokeAny(tasks, <span class="hljs-keyword">true</span>, unit.toNanos(timeout));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="AbstractExecutorService-invokeAll"><a href="#AbstractExecutorService-invokeAll" class="headerlink" title="AbstractExecutorService#invokeAll()"></a>AbstractExecutorService#invokeAll()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span><br><span class="line">        <span class="hljs-keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (tasks == <span class="hljs-keyword">null</span>)</span><br><span class="line">            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();</span><br><span class="line">        List&lt;Future&lt;T&gt;&gt; futures = <span class="hljs-keyword">new</span> ArrayList&lt;Future&lt;T&gt;&gt;(tasks.size());</span><br><span class="line">        <span class="hljs-keyword">boolean</span> done = <span class="hljs-keyword">false</span>;</span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">            <span class="hljs-comment">// 1</span></span><br><span class="line">            <span class="hljs-keyword">for</span> (Callable&lt;T&gt; t : tasks) &#123;</span><br><span class="line">                RunnableFuture&lt;T&gt; f = newTaskFor(t);</span><br><span class="line">                futures.add(f);</span><br><span class="line">                execute(f);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-comment">// 2</span></span><br><span class="line">            <span class="hljs-keyword">for</span> (Future&lt;T&gt; f : futures) &#123;</span><br><span class="line">                <span class="hljs-keyword">if</span> (!f.isDone()) &#123;</span><br><span class="line">                    <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">                        f.get();</span><br><span class="line">                    &#125; <span class="hljs-keyword">catch</span> (CancellationException ignore) &#123;</span><br><span class="line">                    &#125; <span class="hljs-keyword">catch</span> (ExecutionException ignore) &#123;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-comment">// 3</span></span><br><span class="line">            done = <span class="hljs-keyword">true</span>;</span><br><span class="line">            <span class="hljs-keyword">return</span> futures;</span><br><span class="line">        &#125; <span class="hljs-keyword">finally</span> &#123;</span><br><span class="line">            <span class="hljs-comment">// 4</span></span><br><span class="line">            <span class="hljs-keyword">if</span> (!done)</span><br><span class="line">                <span class="hljs-keyword">for</span> (Future&lt;T&gt; f : futures)</span><br><span class="line">                    f.cancel(<span class="hljs-keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>标注代码分析</p>
<ol>
<li>添加任务，执行任务</li>
<li>等待所有的任务都执行完成。</li>
<li>done判断任务执行完成。</li>
<li>done=false，所有任务并没有执行完成，取消没有完成的任务。</li>
</ol>
<h2 id="ThreadPoolExecutor"><a href="#ThreadPoolExecutor" class="headerlink" title="ThreadPoolExecutor"></a>ThreadPoolExecutor</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThreadPoolExecutor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractExecutorService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Permission for checking shutdown</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> RuntimePermission shutdownPerm =</span><br><span class="line">        <span class="hljs-keyword">new</span> RuntimePermission(<span class="hljs-string">"modifyThread"</span>);</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * runState provides the main lifecyle control, taking on values:</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     *   RUNNING:  Accept new tasks and process queued tasks</span></span><br><span class="line"><span class="hljs-comment">     *   SHUTDOWN: Don't accept new tasks, but process queued tasks</span></span><br><span class="line"><span class="hljs-comment">     *   STOP:     Don't accept new tasks, don't process queued tasks,</span></span><br><span class="line"><span class="hljs-comment">     *             and interrupt in-progress tasks</span></span><br><span class="line"><span class="hljs-comment">     *   TERMINATED: Same as STOP, plus all threads have terminated</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * RUNNING -&gt; SHUTDOWN</span></span><br><span class="line"><span class="hljs-comment">     *    On invocation of shutdown(), perhaps implicitly in finalize()</span></span><br><span class="line"><span class="hljs-comment">     * (RUNNING or SHUTDOWN) -&gt; STOP</span></span><br><span class="line"><span class="hljs-comment">     *    On invocation of shutdownNow()</span></span><br><span class="line"><span class="hljs-comment">     * SHUTDOWN -&gt; TERMINATED</span></span><br><span class="line"><span class="hljs-comment">     *    When both queue and pool are empty</span></span><br><span class="line"><span class="hljs-comment">     * STOP -&gt; TERMINATED</span></span><br><span class="line"><span class="hljs-comment">     *    When pool is empty</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-comment">// 1</span></span><br><span class="line">    <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">int</span> runState;</span><br><span class="line">    <span class="hljs-comment">// 2</span></span><br><span class="line">    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> RUNNING    = <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-comment">// 3</span></span><br><span class="line">    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> SHUTDOWN   = <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-comment">// 4</span></span><br><span class="line">    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> STOP       = <span class="hljs-number">2</span>;</span><br><span class="line">    <span class="hljs-comment">// 5</span></span><br><span class="line">    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> TERMINATED = <span class="hljs-number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * The queue used for holding tasks and handing off to worker</span></span><br><span class="line"><span class="hljs-comment">     * threads.  Note that when using this queue, we do not require</span></span><br><span class="line"><span class="hljs-comment">     * that workQueue.poll() returning null necessarily means that</span></span><br><span class="line"><span class="hljs-comment">     * workQueue.isEmpty(), so must sometimes check both. This</span></span><br><span class="line"><span class="hljs-comment">     * accommodates special-purpose queues such as DelayQueues for</span></span><br><span class="line"><span class="hljs-comment">     * which poll() is allowed to return null even if it may later</span></span><br><span class="line"><span class="hljs-comment">     * return non-null when delays expire.</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">     <span class="hljs-comment">// 6</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> BlockingQueue&lt;Runnable&gt; workQueue;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Lock held on updates to poolSize, corePoolSize,</span></span><br><span class="line"><span class="hljs-comment">     * maximumPoolSize, runState, and workers set.</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">     <span class="hljs-comment">// 7</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ReentrantLock mainLock = <span class="hljs-keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Wait condition to support awaitTermination</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">     <span class="hljs-comment">// 8</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Condition termination = mainLock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Set containing all worker threads in pool. Accessed only when</span></span><br><span class="line"><span class="hljs-comment">     * holding mainLock.</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">     <span class="hljs-comment">// 9</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> HashSet&lt;Worker&gt; workers = <span class="hljs-keyword">new</span> HashSet&lt;Worker&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Timeout in nanoseconds for idle threads waiting for work.</span></span><br><span class="line"><span class="hljs-comment">     * Threads use this timeout when there are more than corePoolSize</span></span><br><span class="line"><span class="hljs-comment">     * present or if allowCoreThreadTimeOut. Otherwise they wait</span></span><br><span class="line"><span class="hljs-comment">     * forever for new work.</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-comment">// 10</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">long</span>  keepAliveTime;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * If false (default) core threads stay alive even when idle.  If</span></span><br><span class="line"><span class="hljs-comment">     * true, core threads use keepAliveTime to time out waiting for</span></span><br><span class="line"><span class="hljs-comment">     * work.</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">     <span class="hljs-comment">// 11</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">boolean</span> allowCoreThreadTimeOut;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Core pool size, updated only while holding mainLock, but</span></span><br><span class="line"><span class="hljs-comment">     * volatile to allow concurrent readability even during updates.</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">     <span class="hljs-comment">// 12</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">int</span>   corePoolSize;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Maximum pool size, updated only while holding mainLock but</span></span><br><span class="line"><span class="hljs-comment">     * volatile to allow concurrent readability even during updates.</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">     <span class="hljs-comment">// 13</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">int</span>   maximumPoolSize;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Current pool size, updated only while holding mainLock but</span></span><br><span class="line"><span class="hljs-comment">     * volatile to allow concurrent readability even during updates.</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">     <span class="hljs-comment">// 14</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">int</span>   poolSize;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Handler called when saturated or shutdown in execute.</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">     <span class="hljs-comment">// 15</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> RejectedExecutionHandler handler;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Factory for new threads. All threads are created using this</span></span><br><span class="line"><span class="hljs-comment">     * factory (via method addThread).  All callers must be prepared</span></span><br><span class="line"><span class="hljs-comment">     * for addThread to fail by returning null, which may reflect a</span></span><br><span class="line"><span class="hljs-comment">     * system or user's policy limiting the number of threads.  Even</span></span><br><span class="line"><span class="hljs-comment">     * though it is not treated as an error, failure to create threads</span></span><br><span class="line"><span class="hljs-comment">     * may result in new tasks being rejected or existing ones</span></span><br><span class="line"><span class="hljs-comment">     * remaining stuck in the queue. On the other hand, no special</span></span><br><span class="line"><span class="hljs-comment">     * precautions exist to handle OutOfMemoryErrors that might be</span></span><br><span class="line"><span class="hljs-comment">     * thrown while trying to create threads, since there is generally</span></span><br><span class="line"><span class="hljs-comment">     * no recourse from within this class.</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-comment">// 16</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> ThreadFactory threadFactory;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Tracks largest attained pool size.</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-comment">// 17</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> largestPoolSize;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Counter for completed tasks. Updated only on termination of</span></span><br><span class="line"><span class="hljs-comment">     * worker threads.</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-comment">// 18</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> completedTaskCount;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * The default rejected execution handler</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-comment">// 19</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> RejectedExecutionHandler defaultHandler =</span><br><span class="line">        <span class="hljs-keyword">new</span> AbortPolicy();</span><br></pre></td></tr></table></figure>
<p>标注代码分析</p>
<ol>
<li>线程池运行状态。</li>
<li>正在运行。会接受新任务，并会处理任务队列中的任务。</li>
<li>已经关闭。不接受新任务，但仍然会处理任务队列中的任务。</li>
<li>已经停止。不接受新任务，不处理任务队列中的任务，会中断正在执行的任务。</li>
<li>STOP的基础上，在加上所有的任务都已经结束。  </li>
<li>任务队列，将任务交给工作线程处理。 </li>
<li>在更新内部数据(如：线程数量，运行状态，工作线程集等)时要使用的锁。</li>
<li>用于支持awaitTermination的等待条件。</li>
<li>包含所有工作类的集合。只能在持有mainLock的情况下使用。 </li>
<li>空闲工作线程等待任务的超时时间，单位：纳秒。当前线程数大于核心线程数时，超出的线程会使用这个超时时间。如果设置了allowCoreThreadTimeOut，核心线程数也会使用这个超时时间。否则，线程会一直等待新任务，不会超时。 </li>
<li>如果为false(默认情况下)，核心线程就算空闲也会一直存活。如果为true，等待任务的核心线程会使用keepAliveTime作为超时时间，如果超时，线程被回收。</li>
<li>核心线程数量，只能在持有mainLock的情况下修改。volatile可以保证可见性。</li>
<li>最大线程数量，只能在持有mainLock的情况下修改。</li>
<li>当前线程数量，只能在持有mainLock的情况下修改。 </li>
<li>当线程池饱和或者关闭时，负责处理新来任务的处理，称为拒绝任务处理器。</li>
<li>线程工厂。用于创建新线程。</li>
<li>最大的线程数量记录。</li>
<li>统计任务完成数量的计数器。在工作线程终止(termination)的时候才会更新。</li>
<li>默认的拒绝任务处理。</li>
</ol>
<h2 id="ThreadPoolExecutor-构造函数"><a href="#ThreadPoolExecutor-构造函数" class="headerlink" title="ThreadPoolExecutor 构造函数"></a>ThreadPoolExecutor 构造函数</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                          <span class="hljs-keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                          <span class="hljs-keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                          TimeUnit unit,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                          BlockingQueue&lt;Runnable&gt; workQueue)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">this</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,</span><br><span class="line">         Executors.defaultThreadFactory(), defaultHandler);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                          <span class="hljs-keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                          <span class="hljs-keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                          TimeUnit unit,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                          BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                          ThreadFactory threadFactory)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">this</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,</span><br><span class="line">         threadFactory, defaultHandler);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                          <span class="hljs-keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                          <span class="hljs-keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                          TimeUnit unit,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                          BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                          RejectedExecutionHandler handler)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">this</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,</span><br><span class="line">         Executors.defaultThreadFactory(), handler);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                          <span class="hljs-keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                          <span class="hljs-keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                          TimeUnit unit,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                          BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                          ThreadFactory threadFactory,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                          RejectedExecutionHandler handler)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (corePoolSize &lt; <span class="hljs-number">0</span> ||</span><br><span class="line">        maximumPoolSize &lt;= <span class="hljs-number">0</span> ||</span><br><span class="line">        maximumPoolSize &lt; corePoolSize ||</span><br><span class="line">        keepAliveTime &lt; <span class="hljs-number">0</span>)</span><br><span class="line">        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException();</span><br><span class="line">    <span class="hljs-keyword">if</span> (workQueue == <span class="hljs-keyword">null</span> || threadFactory == <span class="hljs-keyword">null</span> || handler == <span class="hljs-keyword">null</span>)</span><br><span class="line">        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="hljs-keyword">this</span>.corePoolSize = corePoolSize;</span><br><span class="line">    <span class="hljs-keyword">this</span>.maximumPoolSize = maximumPoolSize;</span><br><span class="line">    <span class="hljs-keyword">this</span>.workQueue = workQueue;</span><br><span class="line">    <span class="hljs-keyword">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);</span><br><span class="line">    <span class="hljs-keyword">this</span>.threadFactory = threadFactory;</span><br><span class="line">    <span class="hljs-keyword">this</span>.handler = handler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>内部的keepAliveTime都使用纳秒，所以构造方法中会有1个时间转换。</li>
<li>不指定线程工厂，会使用Executors.defaultThreadFactory()。</li>
</ul>
<h2 id="Executors-defaultThreadFactory"><a href="#Executors-defaultThreadFactory" class="headerlink" title="Executors#defaultThreadFactory()"></a>Executors#defaultThreadFactory()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ThreadFactory <span class="hljs-title">defaultThreadFactory</span><span class="hljs-params">()</span></span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DefaultThreadFactory();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Executors-DefaultThreadFactory"><a href="#Executors-DefaultThreadFactory" class="headerlink" title="Executors#DefaultThreadFactory"></a>Executors#DefaultThreadFactory</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * The default thread factory</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DefaultThreadFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ThreadFactory</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> AtomicInteger poolNumber = <span class="hljs-keyword">new</span> AtomicInteger(<span class="hljs-number">1</span>);</span><br><span class="line">        <span class="hljs-keyword">final</span> ThreadGroup group;</span><br><span class="line">        <span class="hljs-keyword">final</span> AtomicInteger threadNumber = <span class="hljs-keyword">new</span> AtomicInteger(<span class="hljs-number">1</span>);</span><br><span class="line">        <span class="hljs-keyword">final</span> String namePrefix;</span><br><span class="line"></span><br><span class="line">        DefaultThreadFactory() &#123;</span><br><span class="line">            SecurityManager s = System.getSecurityManager();</span><br><span class="line">            group = (s != <span class="hljs-keyword">null</span>)? s.getThreadGroup() :</span><br><span class="line">                                 Thread.currentThread().getThreadGroup();</span><br><span class="line">            namePrefix = <span class="hljs-string">"pool-"</span> +</span><br><span class="line">                          poolNumber.getAndIncrement() +</span><br><span class="line">                         <span class="hljs-string">"-thread-"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> Thread <span class="hljs-title">newThread</span><span class="hljs-params">(Runnable r)</span> </span>&#123;</span><br><span class="line">            Thread t = <span class="hljs-keyword">new</span> Thread(group, r,</span><br><span class="line">                                  namePrefix + threadNumber.getAndIncrement(),</span><br><span class="line">                                  <span class="hljs-number">0</span>);</span><br><span class="line">            <span class="hljs-keyword">if</span> (t.isDaemon())</span><br><span class="line">                t.setDaemon(<span class="hljs-keyword">false</span>);</span><br><span class="line">            <span class="hljs-keyword">if</span> (t.getPriority() != Thread.NORM_PRIORITY)</span><br><span class="line">                t.setPriority(Thread.NORM_PRIORITY);</span><br><span class="line">            <span class="hljs-keyword">return</span> t;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>通过DefaultThreadFactory创建Thread Name，Thread Group的Thread，由poolNumber.getAndIncrement() 知道线程序号是递增的。</p>
<h2 id="ThreadPoolExecutor-execute"><a href="#ThreadPoolExecutor-execute" class="headerlink" title="ThreadPoolExecutor#execute()"></a>ThreadPoolExecutor#execute()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Executes the given task sometime in the future.  The task</span></span><br><span class="line"><span class="hljs-comment"> * may execute in a new thread or in an existing pooled thread.</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * If the task cannot be submitted for execution, either because this</span></span><br><span class="line"><span class="hljs-comment"> * executor has been shutdown or because its capacity has been reached,</span></span><br><span class="line"><span class="hljs-comment"> * the task is handled by the current &lt;tt&gt;RejectedExecutionHandler&lt;/tt&gt;.</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> command the task to execute</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> RejectedExecutionException at discretion of</span></span><br><span class="line"><span class="hljs-comment"> * &lt;tt&gt;RejectedExecutionHandler&lt;/tt&gt;, if task cannot be accepted</span></span><br><span class="line"><span class="hljs-comment"> * for execution</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> NullPointerException if command is null</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">(Runnable command)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (command == <span class="hljs-keyword">null</span>)</span><br><span class="line">        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="hljs-comment">// 1</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (poolSize &gt;= corePoolSize || !addIfUnderCorePoolSize(command)) &#123;</span><br><span class="line">        <span class="hljs-comment">// 2</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (runState == RUNNING &amp;&amp; workQueue.offer(command)) &#123;</span><br><span class="line">            <span class="hljs-comment">// 3</span></span><br><span class="line">            <span class="hljs-keyword">if</span> (runState != RUNNING || poolSize == <span class="hljs-number">0</span>)</span><br><span class="line">                <span class="hljs-comment">// 4</span></span><br><span class="line">                ensureQueuedTaskHandled(command);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-comment">// 5</span></span><br><span class="line">        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!addIfUnderMaximumPoolSize(command))</span><br><span class="line">            <span class="hljs-comment">// 6</span></span><br><span class="line">            reject(command); <span class="hljs-comment">// is shutdown or saturated</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>标注代码分析</p>
<ol>
<li>如果当前线程数量大于等于核心线程数量(poolSize &gt;= corePoolSize)，执行#2。如果当前线程数量小于核心线程数量(poolSize &lt; corePoolSize)，那么尝试添加1个工作线程(addIfUnderCorePoolSize)，同时让这个工作线程处理当前提交的任务，提交任务流程结束；如果添加工作线程失败，那么进入#2。</li>
<li>首先判断当前线程池状态是否为正在运行，如果正在运行，就将当前任务放入任务队列中。</li>
<li>如果当前线程池状态不是正在运行，或者workQueue.offer(command)操作失败，所以任务队列 == 0。</li>
<li>x</li>
<li>添加一个工作线程，同时让这个工作线程处理当前提交的任务，但不能超时最大工作线程数。</li>
<li>addIfUnderMaximumPoolSize(command)如果添加成功，提交任务流程结束；如果添加失败，使用拒绝任务处理器来处理任务。</li>
</ol>
<h2 id="ThreadPoolExecutor-addIfUnderCorePoolSize"><a href="#ThreadPoolExecutor-addIfUnderCorePoolSize" class="headerlink" title="ThreadPoolExecutor#addIfUnderCorePoolSize()"></a>ThreadPoolExecutor#addIfUnderCorePoolSize()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Creates and starts a new thread running firstTask as its first</span></span><br><span class="line"><span class="hljs-comment"> * task, only if fewer than corePoolSize threads are running</span></span><br><span class="line"><span class="hljs-comment"> * and the pool is not shut down.</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> firstTask the task the new thread should run first (or</span></span><br><span class="line"><span class="hljs-comment"> * null if none)</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> true if successful</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">addIfUnderCorePoolSize</span><span class="hljs-params">(Runnable firstTask)</span> </span>&#123;</span><br><span class="line">    Thread t = <span class="hljs-keyword">null</span>;</span><br><span class="line">    <span class="hljs-keyword">final</span> ReentrantLock mainLock = <span class="hljs-keyword">this</span>.mainLock;</span><br><span class="line">    <span class="hljs-comment">// 1</span></span><br><span class="line">    mainLock.lock();</span><br><span class="line">    <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">        <span class="hljs-comment">// 2</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (poolSize &lt; corePoolSize &amp;&amp; runState == RUNNING)</span><br><span class="line">            t = addThread(firstTask);</span><br><span class="line">    &#125; <span class="hljs-keyword">finally</span> &#123;</span><br><span class="line">        mainLock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">if</span> (t == <span class="hljs-keyword">null</span>)</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;</span><br><span class="line">    <span class="hljs-comment">// 3</span></span><br><span class="line">    t.start();</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>标注代码分析</p>
<ol>
<li>新增线程需要加锁。</li>
<li>当前线程数量小于核心线程数量，当前线程池处于运行状态，那么添加1个工作线程。</li>
<li>任务执行。</li>
</ol>
<h2 id="ThreadPoolExecutor-addThread"><a href="#ThreadPoolExecutor-addThread" class="headerlink" title="ThreadPoolExecutor#addThread()"></a>ThreadPoolExecutor#addThread()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Creates and returns a new thread running firstTask as its first</span></span><br><span class="line"><span class="hljs-comment"> * task. Call only while holding mainLock.</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> firstTask the task the new thread should run first (or</span></span><br><span class="line"><span class="hljs-comment"> * null if none)</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> the new thread, or null if threadFactory fails to create thread</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> Thread <span class="hljs-title">addThread</span><span class="hljs-params">(Runnable firstTask)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-comment">// 1</span></span><br><span class="line">    Worker w = <span class="hljs-keyword">new</span> Worker(firstTask);</span><br><span class="line">    <span class="hljs-comment">// 2</span></span><br><span class="line">    Thread t = threadFactory.newThread(w);</span><br><span class="line">    <span class="hljs-keyword">if</span> (t != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">        <span class="hljs-comment">// 3</span></span><br><span class="line">        w.thread = t;</span><br><span class="line">        <span class="hljs-comment">// 4</span></span><br><span class="line">        workers.add(w);</span><br><span class="line">        <span class="hljs-comment">// 5</span></span><br><span class="line">        <span class="hljs-keyword">int</span> nt = ++poolSize;</span><br><span class="line">        <span class="hljs-comment">// 6</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (nt &gt; largestPoolSize)</span><br><span class="line">            largestPoolSize = nt;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> t;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>标注代码分析</p>
<ol>
<li>创建1个worker任务。</li>
<li>根据threadFactory创建1个Thread。</li>
<li>新建的Thread赋值给worker#thread。</li>
<li>worker集合添加worker对象。</li>
<li>线程池中线程数量+1。</li>
<li>线程池最大值重设值为nt。</li>
</ol>
<h2 id="ThreadPoolExecutor-Worker"><a href="#ThreadPoolExecutor-Worker" class="headerlink" title="ThreadPoolExecutor#Worker"></a>ThreadPoolExecutor#Worker</h2><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">When starting to run a task, unless the pool is stopped, each</span><br><span class="line">worker thread ensures that it is not interrupted, and uses</span><br><span class="line">runLock to prevent the pool from interrupting it in the midst</span><br><span class="line">of execution. </span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>根据注释可以知道，Worker是Runnable，Worker用到ReentrantLock防止pool在运行中中断，worker thread确保不会被中断，除非pool停止。<br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Worker</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;</span><br><span class="line">        <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">         * The runLock is acquired and released surrounding each task</span></span><br><span class="line"><span class="hljs-comment">         * execution. It mainly protects against interrupts that are</span></span><br><span class="line"><span class="hljs-comment">         * intended to cancel the worker thread from instead</span></span><br><span class="line"><span class="hljs-comment">         * interrupting the task being run.</span></span><br><span class="line"><span class="hljs-comment">         */</span></span><br><span class="line">        <span class="hljs-comment">// 1</span></span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ReentrantLock runLock = <span class="hljs-keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">         * Initial task to run before entering run loop. Possibly null.</span></span><br><span class="line"><span class="hljs-comment">         */</span></span><br><span class="line">        <span class="hljs-comment">// 2</span></span><br><span class="line">        <span class="hljs-keyword">private</span> Runnable firstTask;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">         * Per thread completed task counter; accumulated</span></span><br><span class="line"><span class="hljs-comment">         * into completedTaskCount upon termination.</span></span><br><span class="line"><span class="hljs-comment">         */</span></span><br><span class="line">        <span class="hljs-comment">// 3</span></span><br><span class="line">        <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">long</span> completedTasks;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">         * Thread this worker is running in.  Acts as a final field,</span></span><br><span class="line"><span class="hljs-comment">         * but cannot be set until thread is created.</span></span><br><span class="line"><span class="hljs-comment">         */</span></span><br><span class="line">        <span class="hljs-comment">// 4</span></span><br><span class="line">        Thread thread;</span><br><span class="line"></span><br><span class="line">        Worker(Runnable firstTask) &#123;</span><br><span class="line">            <span class="hljs-keyword">this</span>.firstTask = firstTask;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-comment">// 5</span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isActive</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> runLock.isLocked();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">         * Interrupts thread if not running a task.</span></span><br><span class="line"><span class="hljs-comment">         */</span></span><br><span class="line">        <span class="hljs-comment">// 6</span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">interruptIfIdle</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">            <span class="hljs-keyword">final</span> ReentrantLock runLock = <span class="hljs-keyword">this</span>.runLock;</span><br><span class="line">            <span class="hljs-keyword">if</span> (runLock.tryLock()) &#123;</span><br><span class="line">                <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">		    <span class="hljs-keyword">if</span> (thread != Thread.currentThread())</span><br><span class="line">			thread.interrupt();</span><br><span class="line">                &#125; <span class="hljs-keyword">finally</span> &#123;</span><br><span class="line">                    runLock.unlock();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">         * Interrupts thread even if running a task.</span></span><br><span class="line"><span class="hljs-comment">         */</span></span><br><span class="line">        <span class="hljs-comment">// 7</span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">interruptNow</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">            thread.interrupt();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">         * Runs a single task between before/after methods.</span></span><br><span class="line"><span class="hljs-comment">         */</span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">runTask</span><span class="hljs-params">(Runnable task)</span> </span>&#123;</span><br><span class="line">            <span class="hljs-keyword">final</span> ReentrantLock runLock = <span class="hljs-keyword">this</span>.runLock;</span><br><span class="line">            runLock.lock();</span><br><span class="line">            <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">                <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">                 * Ensure that unless pool is stopping, this thread</span></span><br><span class="line"><span class="hljs-comment">                 * does not have its interrupt set. This requires a</span></span><br><span class="line"><span class="hljs-comment">                 * double-check of state in case the interrupt was</span></span><br><span class="line"><span class="hljs-comment">                 * cleared concurrently with a shutdownNow -- if so,</span></span><br><span class="line"><span class="hljs-comment">                 * the interrupt is re-enabled.</span></span><br><span class="line"><span class="hljs-comment">                 */</span></span><br><span class="line">                <span class="hljs-comment">// 8</span></span><br><span class="line">                <span class="hljs-keyword">if</span> (runState &lt; STOP &amp;&amp;</span><br><span class="line">                    Thread.interrupted() &amp;&amp;</span><br><span class="line">                    runState &gt;= STOP)</span><br><span class="line">                    thread.interrupt();</span><br><span class="line">                <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">                 * Track execution state to ensure that afterExecute</span></span><br><span class="line"><span class="hljs-comment">                 * is called only if task completed or threw</span></span><br><span class="line"><span class="hljs-comment">                 * exception. Otherwise, the caught runtime exception</span></span><br><span class="line"><span class="hljs-comment">                 * will have been thrown by afterExecute itself, in</span></span><br><span class="line"><span class="hljs-comment">                 * which case we don't want to call it again.</span></span><br><span class="line"><span class="hljs-comment">                 */</span></span><br><span class="line">                <span class="hljs-comment">// 9</span></span><br><span class="line">                <span class="hljs-keyword">boolean</span> ran = <span class="hljs-keyword">false</span>;</span><br><span class="line">                beforeExecute(thread, task);</span><br><span class="line">                <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">                    task.run();</span><br><span class="line">                    ran = <span class="hljs-keyword">true</span>;</span><br><span class="line">                    afterExecute(task, <span class="hljs-keyword">null</span>);</span><br><span class="line">                    ++completedTasks;</span><br><span class="line">                &#125; <span class="hljs-keyword">catch</span> (RuntimeException ex) &#123;</span><br><span class="line">                    <span class="hljs-keyword">if</span> (!ran)</span><br><span class="line">                        afterExecute(task, ex);</span><br><span class="line">                    <span class="hljs-keyword">throw</span> ex;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="hljs-keyword">finally</span> &#123;</span><br><span class="line">                runLock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">         * Main run loop</span></span><br><span class="line"><span class="hljs-comment">         */</span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">            <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">                Runnable task = firstTask;</span><br><span class="line">                firstTask = <span class="hljs-keyword">null</span>;</span><br><span class="line">                <span class="hljs-comment">// 10</span></span><br><span class="line">                <span class="hljs-keyword">while</span> (task != <span class="hljs-keyword">null</span> || (task = getTask()) != <span class="hljs-keyword">null</span>) &#123;</span><br><span class="line">                    runTask(task);</span><br><span class="line">                    task = <span class="hljs-keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="hljs-keyword">finally</span> &#123;</span><br><span class="line">                workerDone(<span class="hljs-keyword">this</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>标注代码分析</p>
<ol>
<li>防止中断线程，取消worker线程</li>
<li>初始任务，可能是null</li>
<li>线程完成任务数量</li>
<li>worker运行在这Thread上</li>
<li>调用ReentrantLock#isLocked()，作为监控Thread状态，非sync操作。Thread hold this lock，true表示当前线程持有这锁，Thread活跃状态。</li>
<li>如果worker是闲置，中断当前worker#thread</li>
<li>任务运行中，中断thread</li>
<li>当pool是停止，中断当前thread。</li>
<li>ran=false，执行task#run()后出现异常，则会调用afterExecute(task, ex),如果task#run()出现异常，则不会调用afterExecute(task, ex)。ThreadPoolExecutor#beforeExecute()和ThreadPoolExecutor#afterExecute()作为子类实现。</li>
<li>检查firstTask不为空，ThreadPoolExecutor#getTask()赋值task，运行task。</li>
</ol>
<h2 id="ThreadPoolExecutor-beforeExecute"><a href="#ThreadPoolExecutor-beforeExecute" class="headerlink" title="ThreadPoolExecutor#beforeExecute()"></a>ThreadPoolExecutor#beforeExecute()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Method invoked prior to executing the given Runnable in the</span></span><br><span class="line"><span class="hljs-comment"> * given thread.  This method is invoked by thread &lt;tt&gt;t&lt;/tt&gt; that</span></span><br><span class="line"><span class="hljs-comment"> * will execute task &lt;tt&gt;r&lt;/tt&gt;, and may be used to re-initialize</span></span><br><span class="line"><span class="hljs-comment"> * ThreadLocals, or to perform logging.</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * &lt;p&gt;This implementation does nothing, but may be customized in</span></span><br><span class="line"><span class="hljs-comment"> * subclasses. Note: To properly nest multiple overridings, subclasses</span></span><br><span class="line"><span class="hljs-comment"> * should generally invoke &lt;tt&gt;super.beforeExecute&lt;/tt&gt; at the end of</span></span><br><span class="line"><span class="hljs-comment"> * this method.</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> t the thread that will run task r.</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> r the task that will be executed.</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">beforeExecute</span><span class="hljs-params">(Thread t, Runnable r)</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure>
<h2 id="ThreadPoolExecutor-afterExecute"><a href="#ThreadPoolExecutor-afterExecute" class="headerlink" title="ThreadPoolExecutor#afterExecute()"></a>ThreadPoolExecutor#afterExecute()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Method invoked upon completion of execution of the given Runnable.</span></span><br><span class="line"><span class="hljs-comment"> * This method is invoked by the thread that executed the task. If</span></span><br><span class="line"><span class="hljs-comment"> * non-null, the Throwable is the uncaught &lt;tt&gt;RuntimeException&lt;/tt&gt;</span></span><br><span class="line"><span class="hljs-comment"> * or &lt;tt&gt;Error&lt;/tt&gt; that caused execution to terminate abruptly.</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * &lt;p&gt;&lt;b&gt;Note:&lt;/b&gt; When actions are enclosed in tasks (such as</span></span><br><span class="line"><span class="hljs-comment"> * &#123;<span class="hljs-doctag">@link</span> FutureTask&#125;) either explicitly or via methods such as</span></span><br><span class="line"><span class="hljs-comment"> * &lt;tt&gt;submit&lt;/tt&gt;, these task objects catch and maintain</span></span><br><span class="line"><span class="hljs-comment"> * computational exceptions, and so they do not cause abrupt</span></span><br><span class="line"><span class="hljs-comment"> * termination, and the internal exceptions are &lt;em&gt;not&lt;/em&gt;</span></span><br><span class="line"><span class="hljs-comment"> * passed to this method.</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * &lt;p&gt;This implementation does nothing, but may be customized in</span></span><br><span class="line"><span class="hljs-comment"> * subclasses. Note: To properly nest multiple overridings, subclasses</span></span><br><span class="line"><span class="hljs-comment"> * should generally invoke &lt;tt&gt;super.afterExecute&lt;/tt&gt; at the</span></span><br><span class="line"><span class="hljs-comment"> * beginning of this method.</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> r the runnable that has completed.</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> t the exception that caused termination, or null if</span></span><br><span class="line"><span class="hljs-comment"> * execution completed normally.</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">afterExecute</span><span class="hljs-params">(Runnable r, Throwable t)</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure>
<h2 id="ThreadPoolExecutor-getTask"><a href="#ThreadPoolExecutor-getTask" class="headerlink" title="ThreadPoolExecutor#getTask()"></a>ThreadPoolExecutor#getTask()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Gets the next task for a worker thread to run.  The general</span></span><br><span class="line"><span class="hljs-comment"> * approach is similar to execute() in that worker threads trying</span></span><br><span class="line"><span class="hljs-comment"> * to get a task to run do so on the basis of prevailing state</span></span><br><span class="line"><span class="hljs-comment"> * accessed outside of locks.  This may cause them to choose the</span></span><br><span class="line"><span class="hljs-comment"> * "wrong" action, such as trying to exit because no tasks</span></span><br><span class="line"><span class="hljs-comment"> * appear to be available, or entering a take when the pool is in</span></span><br><span class="line"><span class="hljs-comment"> * the process of being shut down.  These potential problems are</span></span><br><span class="line"><span class="hljs-comment"> * countered by (1) rechecking pool state (in workerCanExit)</span></span><br><span class="line"><span class="hljs-comment"> * before giving up, and (2) interrupting other workers upon</span></span><br><span class="line"><span class="hljs-comment"> * shutdown, so they can recheck state. All other user-based state</span></span><br><span class="line"><span class="hljs-comment"> * changes (to allowCoreThreadTimeOut etc) are OK even when</span></span><br><span class="line"><span class="hljs-comment"> * performed asynchronously wrt getTask.</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> the task</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-function">Runnable <span class="hljs-title">getTask</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">            <span class="hljs-keyword">int</span> state = runState;</span><br><span class="line">            <span class="hljs-comment">// 1</span></span><br><span class="line">            <span class="hljs-keyword">if</span> (state &gt; SHUTDOWN)</span><br><span class="line">                <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;</span><br><span class="line">            Runnable r;</span><br><span class="line">            <span class="hljs-comment">// 2</span></span><br><span class="line">            <span class="hljs-keyword">if</span> (state == SHUTDOWN)  <span class="hljs-comment">// Help drain queue</span></span><br><span class="line">                r = workQueue.poll();</span><br><span class="line">            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (poolSize &gt; corePoolSize || allowCoreThreadTimeOut)<span class="hljs-comment">// 3</span></span><br><span class="line">                r = workQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS);</span><br><span class="line">            <span class="hljs-keyword">else</span> <span class="hljs-comment">// 4</span></span><br><span class="line">                r = workQueue.take();</span><br><span class="line">            <span class="hljs-keyword">if</span> (r != <span class="hljs-keyword">null</span>)</span><br><span class="line">                <span class="hljs-keyword">return</span> r;</span><br><span class="line">            <span class="hljs-comment">// 5</span></span><br><span class="line">            <span class="hljs-keyword">if</span> (workerCanExit()) &#123;</span><br><span class="line">                <span class="hljs-comment">// 6</span></span><br><span class="line">                <span class="hljs-keyword">if</span> (runState &gt;= SHUTDOWN) <span class="hljs-comment">// Wake up others</span></span><br><span class="line">                    interruptIdleWorkers();</span><br><span class="line">                <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-comment">// Else retry</span></span><br><span class="line">        &#125; <span class="hljs-keyword">catch</span> (InterruptedException ie) &#123;</span><br><span class="line">            <span class="hljs-comment">// On interruption, re-check runState</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>标注代码分析</p>
<ol>
<li>线程池停止、终端，则返回null。</li>
<li>线程池关闭，获取队列里的任务。</li>
<li>如果设置超时获取队列中的任务，通过超时poll(long)获取。</li>
<li>阻塞等待获取任务。</li>
<li>检测是否可以退出这for循环。ThreadPoolExecutor#workerCanExit()代码，可以知道线程池中断、workQueue是空、设置超时时间都可以作为退出条件。</li>
<li>如果线程池中断、关闭，workers集合中可能还有空闲Thread，中断workers集合中的任务。</li>
</ol>
<h2 id="ThreadPoolExecutor-workerCanExit"><a href="#ThreadPoolExecutor-workerCanExit" class="headerlink" title="ThreadPoolExecutor#workerCanExit()"></a>ThreadPoolExecutor#workerCanExit()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">    * Check whether a worker thread that fails to get a task can</span></span><br><span class="line"><span class="hljs-comment">    * exit.  We allow a worker thread to die if the pool is stopping,</span></span><br><span class="line"><span class="hljs-comment">    * or the queue is empty, or there is at least one thread to</span></span><br><span class="line"><span class="hljs-comment">    * handle possibly non-empty queue, even if core timeouts are</span></span><br><span class="line"><span class="hljs-comment">    * allowed.</span></span><br><span class="line"><span class="hljs-comment">    */</span></span><br><span class="line">   <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">workerCanExit</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">       <span class="hljs-keyword">final</span> ReentrantLock mainLock = <span class="hljs-keyword">this</span>.mainLock;</span><br><span class="line">       mainLock.lock();</span><br><span class="line">       <span class="hljs-keyword">boolean</span> canExit;</span><br><span class="line">       <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">           canExit = runState &gt;= STOP ||</span><br><span class="line">               workQueue.isEmpty() ||</span><br><span class="line">               (allowCoreThreadTimeOut &amp;&amp;</span><br><span class="line">                poolSize &gt; Math.max(<span class="hljs-number">1</span>, corePoolSize));</span><br><span class="line">       &#125; <span class="hljs-keyword">finally</span> &#123;</span><br><span class="line">           mainLock.unlock();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="hljs-keyword">return</span> canExit;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h2 id="ThreadPoolExecutor-interruptIdleWorkers"><a href="#ThreadPoolExecutor-interruptIdleWorkers" class="headerlink" title="ThreadPoolExecutor#interruptIdleWorkers()"></a>ThreadPoolExecutor#interruptIdleWorkers()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Wakes up all threads that might be waiting for tasks so they</span></span><br><span class="line"><span class="hljs-comment"> * can check for termination. Note: this method is also called by</span></span><br><span class="line"><span class="hljs-comment"> * ScheduledThreadPoolExecutor.</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">interruptIdleWorkers</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">final</span> ReentrantLock mainLock = <span class="hljs-keyword">this</span>.mainLock;</span><br><span class="line">    mainLock.lock();</span><br><span class="line">    <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">        <span class="hljs-keyword">for</span> (Worker w : workers)</span><br><span class="line">            w.interruptIfIdle();</span><br><span class="line">    &#125; <span class="hljs-keyword">finally</span> &#123;</span><br><span class="line">        mainLock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ThreadPoolExecutor-workerDone"><a href="#ThreadPoolExecutor-workerDone" class="headerlink" title="ThreadPoolExecutor#workerDone()"></a>ThreadPoolExecutor#workerDone()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Performs bookkeeping for an exiting worker thread.</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> w the worker</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">workerDone</span><span class="hljs-params">(Worker w)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">final</span> ReentrantLock mainLock = <span class="hljs-keyword">this</span>.mainLock;</span><br><span class="line">    <span class="hljs-comment">// 1</span></span><br><span class="line">    mainLock.lock();</span><br><span class="line">    <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">        completedTaskCount += w.completedTasks;</span><br><span class="line">        workers.remove(w);</span><br><span class="line">        <span class="hljs-comment">// 2</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (--poolSize == <span class="hljs-number">0</span>)</span><br><span class="line">            tryTerminate();</span><br><span class="line">    &#125; <span class="hljs-keyword">finally</span> &#123;</span><br><span class="line">        mainLock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>标注代码分析</p>
<ol>
<li>加锁，线程任务完成记录+1，从worker集合中移除当前work。</li>
<li>如果线程池当前数量=0；如果线程状态是停止、关闭，中断线程池。如果线程状态是运行且workQueue阻塞队列有任务，则至少1个活线程。</li>
</ol>
<h2 id="ThreadPoolExecutor-tryTerminate"><a href="#ThreadPoolExecutor-tryTerminate" class="headerlink" title="ThreadPoolExecutor#tryTerminate()"></a>ThreadPoolExecutor#tryTerminate()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Transitions to TERMINATED state if either (SHUTDOWN and pool</span></span><br><span class="line"><span class="hljs-comment"> * and queue empty) or (STOP and pool empty), otherwise unless</span></span><br><span class="line"><span class="hljs-comment"> * stopped, ensuring that there is at least one live thread to</span></span><br><span class="line"><span class="hljs-comment"> * handle queued tasks.</span></span><br><span class="line"><span class="hljs-comment"> *</span></span><br><span class="line"><span class="hljs-comment"> * This method is called from the three places in which</span></span><br><span class="line"><span class="hljs-comment"> * termination can occur: in workerDone on exit of the last thread</span></span><br><span class="line"><span class="hljs-comment"> * after pool has been shut down, or directly within calls to</span></span><br><span class="line"><span class="hljs-comment"> * shutdown or shutdownNow, if there are no live threads.</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">tryTerminate</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-comment">// 1</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (poolSize == <span class="hljs-number">0</span>) &#123;</span><br><span class="line">        <span class="hljs-comment">// 2</span></span><br><span class="line">        <span class="hljs-keyword">int</span> state = runState;</span><br><span class="line">        <span class="hljs-comment">// 3</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (state &lt; STOP &amp;&amp; !workQueue.isEmpty()) &#123;</span><br><span class="line">            state = RUNNING; <span class="hljs-comment">// disable termination check below</span></span><br><span class="line">            Thread t = addThread(<span class="hljs-keyword">null</span>);</span><br><span class="line">            <span class="hljs-keyword">if</span> (t != <span class="hljs-keyword">null</span>)</span><br><span class="line">                t.start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-comment">// 4</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (state == STOP || state == SHUTDOWN) &#123;</span><br><span class="line">            runState = TERMINATED;</span><br><span class="line">            termination.signalAll();</span><br><span class="line">            terminated();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>标注代码分析</p>
<ol>
<li>线程池数量为0。</li>
<li>当前线程池状态赋值为局部变量state。</li>
<li>当线程池是RUNNING或者SHUTDOWN状态，且workQueue不为空。新建1个null的线程，修改线程池状态为RUNNING。</li>
<li>线程池是STOP，设置当前线程池状态是TERMINATED。同时唤醒1条等待线程。</li>
</ol>
<h2 id="ThreadPoolExecutor-ensureQueuedTaskHandled"><a href="#ThreadPoolExecutor-ensureQueuedTaskHandled" class="headerlink" title="ThreadPoolExecutor#ensureQueuedTaskHandled()"></a>ThreadPoolExecutor#ensureQueuedTaskHandled()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">    * Rechecks state after queuing a task. Called from execute when</span></span><br><span class="line"><span class="hljs-comment">    * pool state has been observed to change after queuing a task. If</span></span><br><span class="line"><span class="hljs-comment">    * the task was queued concurrently with a call to shutdownNow,</span></span><br><span class="line"><span class="hljs-comment">    * and is still present in the queue, this task must be removed</span></span><br><span class="line"><span class="hljs-comment">    * and rejected to preserve shutdownNow guarantees.  Otherwise,</span></span><br><span class="line"><span class="hljs-comment">    * this method ensures (unless addThread fails) that there is at</span></span><br><span class="line"><span class="hljs-comment">    * least one live thread to handle this task</span></span><br><span class="line"><span class="hljs-comment">    * <span class="hljs-doctag">@param</span> command the task</span></span><br><span class="line"><span class="hljs-comment">    */</span></span><br><span class="line">   <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ensureQueuedTaskHandled</span><span class="hljs-params">(Runnable command)</span> </span>&#123;</span><br><span class="line">       <span class="hljs-keyword">final</span> ReentrantLock mainLock = <span class="hljs-keyword">this</span>.mainLock;</span><br><span class="line">       mainLock.lock();</span><br><span class="line">       <span class="hljs-comment">// 1</span></span><br><span class="line">       <span class="hljs-keyword">boolean</span> reject = <span class="hljs-keyword">false</span>;</span><br><span class="line">       Thread t = <span class="hljs-keyword">null</span>;</span><br><span class="line">       <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">           <span class="hljs-keyword">int</span> state = runState;</span><br><span class="line">           <span class="hljs-comment">// 2</span></span><br><span class="line">           <span class="hljs-keyword">if</span> (state != RUNNING &amp;&amp; workQueue.remove(command))</span><br><span class="line">               reject = <span class="hljs-keyword">true</span>;</span><br><span class="line">           <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (state &lt; STOP &amp;&amp;</span><br><span class="line">                    poolSize &lt; Math.max(corePoolSize, <span class="hljs-number">1</span>) &amp;&amp;</span><br><span class="line">                    !workQueue.isEmpty())<span class="hljs-comment">// 3</span></span><br><span class="line">               t = addThread(<span class="hljs-keyword">null</span>);</span><br><span class="line">       &#125; <span class="hljs-keyword">finally</span> &#123;</span><br><span class="line">           mainLock.unlock();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="hljs-comment">// 4</span></span><br><span class="line">       <span class="hljs-keyword">if</span> (reject)</span><br><span class="line">           reject(command);</span><br><span class="line">       <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (t != <span class="hljs-keyword">null</span>)</span><br><span class="line">           t.start();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>标注代码分析</p>
<ol>
<li>拒绝标志符变量。</li>
<li>线程池不是RUNNING，则从阻塞队列workQueue删除当前任务。设置拒绝标识符。</li>
<li>线程池状态不是STOP，workQueue非空，ThreadPoolExecutor#execute()中的runState != RUNNING ，可以知道线程池状态是SHUTDOWN。和ensureQueuedTaskHandled#tryTerminate()一样，必需有1个活线程执行任务。</li>
<li>执行拒绝方法RejectedExecutionHandler#rejectedExecution，或者运行null runnable。</li>
</ol>
<h2 id="ThreadPoolExecutor-addIfUnderMaximumPoolSize"><a href="#ThreadPoolExecutor-addIfUnderMaximumPoolSize" class="headerlink" title="ThreadPoolExecutor#addIfUnderMaximumPoolSize()"></a>ThreadPoolExecutor#addIfUnderMaximumPoolSize()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Creates and starts a new thread running firstTask as its first</span></span><br><span class="line"><span class="hljs-comment">     * task, only if fewer than maximumPoolSize threads are running</span></span><br><span class="line"><span class="hljs-comment">     * and pool is not shut down.</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> firstTask the task the new thread should run first (or</span></span><br><span class="line"><span class="hljs-comment">     * null if none)</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true if successful</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">addIfUnderMaximumPoolSize</span><span class="hljs-params">(Runnable firstTask)</span> </span>&#123;</span><br><span class="line">        Thread t = <span class="hljs-keyword">null</span>;</span><br><span class="line">        <span class="hljs-keyword">final</span> ReentrantLock mainLock = <span class="hljs-keyword">this</span>.mainLock;</span><br><span class="line">        mainLock.lock();</span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">            <span class="hljs-comment">//</span></span><br><span class="line">            <span class="hljs-keyword">if</span> (poolSize &lt; maximumPoolSize &amp;&amp; runState == RUNNING)</span><br><span class="line">                t = addThread(firstTask);</span><br><span class="line">        &#125; <span class="hljs-keyword">finally</span> &#123;</span><br><span class="line">            mainLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">if</span> (t == <span class="hljs-keyword">null</span>)</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;</span><br><span class="line">        t.start();</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>标注代码分析</p>
<ol>
<li>线程池中线程数量&lt;最大线程池线程数量，线程池状态RUNNING，添加1个worker任务。创建thread，赋值给worker#thread。</li>
</ol>
<h2 id="ThreadPoolExecutor-shutdown"><a href="#ThreadPoolExecutor-shutdown" class="headerlink" title="ThreadPoolExecutor#shutdown()"></a>ThreadPoolExecutor#shutdown()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">shutdown</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">   <span class="hljs-comment">// 1</span></span><br><span class="line">SecurityManager security = System.getSecurityManager();</span><br><span class="line"><span class="hljs-keyword">if</span> (security != <span class="hljs-keyword">null</span>)</span><br><span class="line">           security.checkPermission(shutdownPerm);</span><br><span class="line"></span><br><span class="line">       <span class="hljs-keyword">final</span> ReentrantLock mainLock = <span class="hljs-keyword">this</span>.mainLock;</span><br><span class="line">       mainLock.lock();</span><br><span class="line">       <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">           <span class="hljs-comment">// 2</span></span><br><span class="line">           <span class="hljs-keyword">if</span> (security != <span class="hljs-keyword">null</span>) &#123; <span class="hljs-comment">// Check if caller can modify our threads</span></span><br><span class="line">               <span class="hljs-comment">// 3</span></span><br><span class="line">               <span class="hljs-keyword">for</span> (Worker w : workers)</span><br><span class="line">                   security.checkAccess(w.thread);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="hljs-comment">// 4</span></span><br><span class="line">           <span class="hljs-keyword">int</span> state = runState;</span><br><span class="line">           <span class="hljs-keyword">if</span> (state &lt; SHUTDOWN)</span><br><span class="line">               runState = SHUTDOWN;</span><br><span class="line"></span><br><span class="line">           <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">               <span class="hljs-comment">// 5</span></span><br><span class="line">               <span class="hljs-keyword">for</span> (Worker w : workers) &#123;</span><br><span class="line">                   w.interruptIfIdle();</span><br><span class="line">               &#125;</span><br><span class="line">           &#125; <span class="hljs-keyword">catch</span> (SecurityException se) &#123; <span class="hljs-comment">// Try to back out</span></span><br><span class="line">               runState = state;</span><br><span class="line">               <span class="hljs-comment">// tryTerminate() here would be a no-op</span></span><br><span class="line">               <span class="hljs-keyword">throw</span> se;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="hljs-comment">// 6</span></span><br><span class="line">           tryTerminate(); <span class="hljs-comment">// Terminate now if pool and queue empty</span></span><br><span class="line">       &#125; <span class="hljs-keyword">finally</span> &#123;</span><br><span class="line">           mainLock.unlock();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>标注代码分析</p>
<ol>
<li>检测是否允许关闭。</li>
<li>是否有些线程允许被修改。</li>
<li>设置线程运行被修改。</li>
<li>设置线程池状态SHUTDOWN。</li>
<li>worker阻塞队列终端线程。</li>
<li>根据注释<code>Some workers may have been killed but we remain in non-shutdown state (which may entail tryTerminate from workerDone starting a new worker to maintain liveness.</code>知道保留1个null的thread。</li>
</ol>
<h2 id="ThreadPoolExecutor-shutdownNow"><a href="#ThreadPoolExecutor-shutdownNow" class="headerlink" title="ThreadPoolExecutor#shutdownNow()"></a>ThreadPoolExecutor#shutdownNow()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Runnable&gt; <span class="hljs-title">shutdownNow</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">         * shutdownNow differs from shutdown only in that</span></span><br><span class="line"><span class="hljs-comment">         * 1. runState is set to STOP,</span></span><br><span class="line"><span class="hljs-comment">         * 2. all worker threads are interrupted, not just the idle ones, and</span></span><br><span class="line"><span class="hljs-comment">         * 3. the queue is drained and returned.</span></span><br><span class="line"><span class="hljs-comment">         */</span></span><br><span class="line">	SecurityManager security = System.getSecurityManager();</span><br><span class="line">	<span class="hljs-keyword">if</span> (security != <span class="hljs-keyword">null</span>)</span><br><span class="line">            security.checkPermission(shutdownPerm);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">final</span> ReentrantLock mainLock = <span class="hljs-keyword">this</span>.mainLock;</span><br><span class="line">        mainLock.lock();</span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (security != <span class="hljs-keyword">null</span>) &#123; <span class="hljs-comment">// Check if caller can modify our threads</span></span><br><span class="line">                <span class="hljs-keyword">for</span> (Worker w : workers)</span><br><span class="line">                    security.checkAccess(w.thread);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">int</span> state = runState;</span><br><span class="line">            <span class="hljs-keyword">if</span> (state &lt; STOP)</span><br><span class="line">                runState = STOP;</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">                <span class="hljs-keyword">for</span> (Worker w : workers) &#123;</span><br><span class="line">                    w.interruptNow();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="hljs-keyword">catch</span> (SecurityException se) &#123; <span class="hljs-comment">// Try to back out</span></span><br><span class="line">                runState = state;</span><br><span class="line">                <span class="hljs-comment">// tryTerminate() here would be a no-op</span></span><br><span class="line">                <span class="hljs-keyword">throw</span> se;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-comment">// 1</span></span><br><span class="line">            List&lt;Runnable&gt; tasks = drainQueue();</span><br><span class="line">            tryTerminate(); <span class="hljs-comment">// Terminate now if pool and queue empty</span></span><br><span class="line">            <span class="hljs-keyword">return</span> tasks;</span><br><span class="line">        &#125; <span class="hljs-keyword">finally</span> &#123;</span><br><span class="line">            mainLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>标注代码分析</p>
<ol>
<li>情况worker阻塞队列，返回阻塞队列任务集合。</li>
</ol>
<p>shutdownNow()相对shutdown()多1个drainQueue()。</p>
<h2 id="ThreadPoolExecutor-drainQueue"><a href="#ThreadPoolExecutor-drainQueue" class="headerlink" title="ThreadPoolExecutor#drainQueue()"></a>ThreadPoolExecutor#drainQueue()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * Drains the task queue into a new list. Used by shutdownNow.</span></span><br><span class="line"><span class="hljs-comment">     * Call only while holding main lock.</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">private</span> List&lt;Runnable&gt; <span class="hljs-title">drainQueue</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        List&lt;Runnable&gt; taskList = <span class="hljs-keyword">new</span> ArrayList&lt;Runnable&gt;();</span><br><span class="line">        <span class="hljs-comment">// 1</span></span><br><span class="line">        workQueue.drainTo(taskList);</span><br><span class="line">        <span class="hljs-comment">// 2</span></span><br><span class="line">        <span class="hljs-keyword">while</span> (!workQueue.isEmpty()) &#123;</span><br><span class="line">            <span class="hljs-comment">// 3</span></span><br><span class="line">            Iterator&lt;Runnable&gt; it = workQueue.iterator();</span><br><span class="line">            <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">                <span class="hljs-keyword">if</span> (it.hasNext()) &#123;</span><br><span class="line">                    Runnable r = it.next();</span><br><span class="line">                    <span class="hljs-keyword">if</span> (workQueue.remove(r))</span><br><span class="line">                        taskList.add(r);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="hljs-keyword">catch</span> (ConcurrentModificationException ignore) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">return</span> taskList;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>标注代码分析</p>
<ol>
<li>清空workQueue阻塞队列，并把workQueue阻塞队列数据放到新建list集合。</li>
<li>根据注释<code>If the queue is a DelayQueue or any other kind of queue for which poll or drainTo may fail to remove some elements</code>drainTo()可能会失败，所以需要遍历workQueue阻塞队列，再次清除1遍。</li>
<li>根据注释<code>guarantee atomicity wrt other threads using this queue, we need to create a new iterator for each element removed.</code>保证原子性。每次循环都创建新的iterator对象。</li>
</ol>
<h2 id="ThreadPoolExecutor-awaitTermination"><a href="#ThreadPoolExecutor-awaitTermination" class="headerlink" title="ThreadPoolExecutor#awaitTermination()"></a>ThreadPoolExecutor#awaitTermination()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">awaitTermination</span><span class="hljs-params">(<span class="hljs-keyword">long</span> timeout, TimeUnit unit)</span></span></span><br><span class="line"><span class="hljs-function">        <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">long</span> nanos = unit.toNanos(timeout);</span><br><span class="line">        <span class="hljs-keyword">final</span> ReentrantLock mainLock = <span class="hljs-keyword">this</span>.mainLock;</span><br><span class="line">        mainLock.lock();</span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">            <span class="hljs-keyword">for</span> (;;) &#123;</span><br><span class="line">                <span class="hljs-comment">// 1</span></span><br><span class="line">                <span class="hljs-keyword">if</span> (runState == TERMINATED)</span><br><span class="line">                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</span><br><span class="line">                <span class="hljs-keyword">if</span> (nanos &lt;= <span class="hljs-number">0</span>)</span><br><span class="line">                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;</span><br><span class="line">                nanos = termination.awaitNanos(nanos);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="hljs-keyword">finally</span> &#123;</span><br><span class="line">            mainLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>标注代码分析</p>
<ol>
<li>线程状态TERMINATED，直接返回true。</li>
<li>时间负数，线程中断失败。</li>
<li>等待(或等待超时)，等待线程被唤醒或者中断。</li>
</ol>
<h2 id="ThreadPoolExecutor-finalize"><a href="#ThreadPoolExecutor-finalize" class="headerlink" title="ThreadPoolExecutor#finalize()"></a>ThreadPoolExecutor#finalize()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Invokes &lt;tt&gt;shutdown&lt;/tt&gt; when this executor is no longer</span></span><br><span class="line"><span class="hljs-comment"> * referenced.</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">finalize</span><span class="hljs-params">()</span>  </span>&#123;</span><br><span class="line">    shutdown();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>覆写finalize()，根据注释executor没有强引用的时候，可以执行shutdown()。可以参考finalize章节。</p>
<h2 id="ThreadPoolExecutor-prestartCoreThread"><a href="#ThreadPoolExecutor-prestartCoreThread" class="headerlink" title="ThreadPoolExecutor#prestartCoreThread()"></a>ThreadPoolExecutor#prestartCoreThread()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Starts a core thread, causing it to idly wait for work. This</span></span><br><span class="line"><span class="hljs-comment"> * overrides the default policy of starting core threads only when</span></span><br><span class="line"><span class="hljs-comment"> * new tasks are executed. This method will return &lt;tt&gt;false&lt;/tt&gt;</span></span><br><span class="line"><span class="hljs-comment"> * if all core threads have already been started.</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> true if a thread was started</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">prestartCoreThread</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> addIfUnderCorePoolSize(<span class="hljs-keyword">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果poolSize &lt; corePoolSize，创建1个thread，返回true。根据注释知道，poolSize &gt;= corePoolSize，线程池里线程都启动，所以返回false。</p>
<h2 id="ThreadPoolExecutor-prestartAllCoreThreads"><a href="#ThreadPoolExecutor-prestartAllCoreThreads" class="headerlink" title="ThreadPoolExecutor#prestartAllCoreThreads()"></a>ThreadPoolExecutor#prestartAllCoreThreads()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment"> * Starts all core threads, causing them to idly wait for work. This</span></span><br><span class="line"><span class="hljs-comment"> * overrides the default policy of starting core threads only when</span></span><br><span class="line"><span class="hljs-comment"> * new tasks are executed.</span></span><br><span class="line"><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> the number of threads started</span></span><br><span class="line"><span class="hljs-comment"> */</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">prestartAllCoreThreads</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">int</span> n = <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-keyword">while</span> (addIfUnderCorePoolSize(<span class="hljs-keyword">null</span>))</span><br><span class="line">        ++n;</span><br><span class="line">    <span class="hljs-keyword">return</span> n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>prestartAllCoreThreads()相对prestartCoreThread()多while循环。在poolSize &lt; corePoolSize时候，不断创建runnable = null的线程。</p>
<h2 id="ThreadPoolExecutor-setCorePoolSize"><a href="#ThreadPoolExecutor-setCorePoolSize" class="headerlink" title="ThreadPoolExecutor#setCorePoolSize()"></a>ThreadPoolExecutor#setCorePoolSize()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setCorePoolSize</span><span class="hljs-params">(<span class="hljs-keyword">int</span> corePoolSize)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (corePoolSize &lt; <span class="hljs-number">0</span>)</span><br><span class="line">            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException();</span><br><span class="line">        <span class="hljs-keyword">final</span> ReentrantLock mainLock = <span class="hljs-keyword">this</span>.mainLock;</span><br><span class="line">        mainLock.lock();</span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">            <span class="hljs-keyword">int</span> extra = <span class="hljs-keyword">this</span>.corePoolSize - corePoolSize;</span><br><span class="line">            <span class="hljs-keyword">this</span>.corePoolSize = corePoolSize;</span><br><span class="line">            <span class="hljs-comment">// 1</span></span><br><span class="line">            <span class="hljs-keyword">if</span> (extra &lt; <span class="hljs-number">0</span>) &#123;</span><br><span class="line">                <span class="hljs-keyword">int</span> n = workQueue.size(); <span class="hljs-comment">// don't add more threads than tasks</span></span><br><span class="line">                <span class="hljs-keyword">while</span> (extra++ &lt; <span class="hljs-number">0</span> &amp;&amp; n-- &gt; <span class="hljs-number">0</span> &amp;&amp; poolSize &lt; corePoolSize) &#123;</span><br><span class="line">                    Thread t = addThread(<span class="hljs-keyword">null</span>);</span><br><span class="line">                    <span class="hljs-keyword">if</span> (t != <span class="hljs-keyword">null</span>)</span><br><span class="line">                        t.start();</span><br><span class="line">                    <span class="hljs-keyword">else</span></span><br><span class="line">                        <span class="hljs-keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (extra &gt; <span class="hljs-number">0</span> &amp;&amp; poolSize &gt; corePoolSize) &#123; <span class="hljs-comment">// 2</span></span><br><span class="line">                <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">                    Iterator&lt;Worker&gt; it = workers.iterator();</span><br><span class="line">                    <span class="hljs-keyword">while</span> (it.hasNext() &amp;&amp;</span><br><span class="line">                           extra-- &gt; <span class="hljs-number">0</span> &amp;&amp;</span><br><span class="line">                           poolSize &gt; corePoolSize &amp;&amp;</span><br><span class="line">                           workQueue.remainingCapacity() == <span class="hljs-number">0</span>)</span><br><span class="line">                        it.next().interruptIfIdle();</span><br><span class="line">                &#125; <span class="hljs-keyword">catch</span> (SecurityException ignore) &#123;</span><br><span class="line">                    <span class="hljs-comment">// Not an error; it is OK if the threads stay live</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="hljs-keyword">finally</span> &#123;</span><br><span class="line">            mainLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>标注代码分析</p>
<ol>
<li>new corePoolSize &gt; corePoolSize，新增extra数量的runnable = null的Thread。</li>
<li>new corePoolSize &lt; corePoolSize，中断worker阻塞队列中闲置的线程。</li>
</ol>
<h2 id="ThreadPoolExecutor-setMaximumPoolSize"><a href="#ThreadPoolExecutor-setMaximumPoolSize" class="headerlink" title="ThreadPoolExecutor#setMaximumPoolSize()"></a>ThreadPoolExecutor#setMaximumPoolSize()</h2><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setMaximumPoolSize</span><span class="hljs-params">(<span class="hljs-keyword">int</span> maximumPoolSize)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (maximumPoolSize &lt;= <span class="hljs-number">0</span> || maximumPoolSize &lt; corePoolSize)</span><br><span class="line">            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException();</span><br><span class="line">        <span class="hljs-keyword">final</span> ReentrantLock mainLock = <span class="hljs-keyword">this</span>.mainLock;</span><br><span class="line">        mainLock.lock();</span><br><span class="line">        <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">            <span class="hljs-keyword">int</span> extra = <span class="hljs-keyword">this</span>.maximumPoolSize - maximumPoolSize;</span><br><span class="line">            <span class="hljs-keyword">this</span>.maximumPoolSize = maximumPoolSize;</span><br><span class="line">            <span class="hljs-comment">// 1</span></span><br><span class="line">            <span class="hljs-keyword">if</span> (extra &gt; <span class="hljs-number">0</span> &amp;&amp; poolSize &gt; maximumPoolSize) &#123;</span><br><span class="line">                <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">                    Iterator&lt;Worker&gt; it = workers.iterator();</span><br><span class="line">                    <span class="hljs-keyword">while</span> (it.hasNext() &amp;&amp;</span><br><span class="line">                           extra &gt; <span class="hljs-number">0</span> &amp;&amp;</span><br><span class="line">                           poolSize &gt; maximumPoolSize) &#123;</span><br><span class="line">                        it.next().interruptIfIdle();</span><br><span class="line">                        --extra;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="hljs-keyword">catch</span> (SecurityException ignore) &#123;</span><br><span class="line">                    <span class="hljs-comment">// Not an error; it is OK if the threads stay live</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="hljs-keyword">finally</span> &#123;</span><br><span class="line">            mainLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>标注代码分析</p>
<ol>
<li>根据注释可以理解，如果new maximumPoolSize &gt; maximumPoolSize，则直接设值。如果new maximumPoolSize &lt; maximumPoolSize，中断workers阻塞队列中的闲置Thread。<h2 id="实现RejectedExecutionHandler接口"><a href="#实现RejectedExecutionHandler接口" class="headerlink" title="实现RejectedExecutionHandler接口"></a>实现RejectedExecutionHandler接口</h2><img src="./ThreadPoolExecutor-1-2.jpg" alt><h3 id="ThreadPoolExecutor-AbortPolicy"><a href="#ThreadPoolExecutor-AbortPolicy" class="headerlink" title="ThreadPoolExecutor#AbortPolicy"></a>ThreadPoolExecutor#AbortPolicy</h3>拒绝当前任务，抛出RejectedExecutionException。<h3 id="ThreadPoolExecutor-CallerRunsPolicy"><a href="#ThreadPoolExecutor-CallerRunsPolicy" class="headerlink" title="ThreadPoolExecutor#CallerRunsPolicy"></a>ThreadPoolExecutor#CallerRunsPolicy</h3>线程池未关闭，直接运行当前任务。<h3 id="ThreadPoolExecutor-DiscardPolicy"><a href="#ThreadPoolExecutor-DiscardPolicy" class="headerlink" title="ThreadPoolExecutor#DiscardPolicy"></a>ThreadPoolExecutor#DiscardPolicy</h3>丢弃当前任务，什么都不操作。<h3 id="ThreadPoolExecutor-DiscardOldestPolicy"><a href="#ThreadPoolExecutor-DiscardOldestPolicy" class="headerlink" title="ThreadPoolExecutor#DiscardOldestPolicy"></a>ThreadPoolExecutor#DiscardOldestPolicy</h3>丢弃Queue的第1个任务，也就是最早添加的Runnable，运行当前任务。<h1 id="3-总结"><a href="#3-总结" class="headerlink" title="3 总结"></a>3 总结</h1></li>
</ol>

        </div>
        
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <span class="is-size-6 has-text-grey has-mr-7">#</span>
                    <a class="has-link-grey -link" href="/tags/JDK6-源码/">JDK6 源码</a>
                </div>
            </div>
        </div>
        
        
        
        <div class="social-share"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">
<script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3>
        <div class="buttons is-centered">
            
                
<a class="button is-info donate">
    <span class="icon is-small">
        <i class="fab fa-alipay"></i>
    </span>
    <span>支付宝</span>
    <div class="qrcode"><img src="/images/alipaycode.jpg" alt="支付宝"></div>
</a>

                
                
<a class="button is-success donate">
    <span class="icon is-small">
        <i class="fab fa-weixin"></i>
    </span>
    <span>微信</span>
    <div class="qrcode"><img src="/images/wxcode.png" alt="微信"></div>
</a>

                
        </div>
    </div>
</div>



<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/Tomcat-1/">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item">Tomcat（一）总体结构</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/JDK1.6-SynchronousQueue/">
                <span class="level-item">JDK1.6 SynchronousQueue</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal">评论</h3>
        
<div id="comment-container"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.4.1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1.4.1/dist/gitalk.min.js"></script>
<script>
    var gitalk = new Gitalk({
        clientID: 'a70be08270bc7c083f83',
        clientSecret: '1b08252e3cf4b0c29b5f52f431ad9a54eef0a74a',
        id: '42811aaf35fd914e6b01d4a9d42ac7bb',
        repo: 'joeskye1701.github.io',
        owner: 'joeskye1701',
        admin: "joeskye1701"
    })
    gitalk.render('comment-container')
</script>

    </div>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered">
                <div>
                    
                        <img class="image is-128x128 has-mb-6" src="/images/thank-you-kobe.jpg" alt="Joe">
                    
                    
                    <p class="is-size-4 is-block">
                        Joe
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Developer &amp; Designer
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Shenzhen, China</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <p class="title has-text-weight-normal">
                        129
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        分类
                    </p>
                    <p class="title has-text-weight-normal">
                        26
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        标签
                    </p>
                    <p class="title has-text-weight-normal">
                        54
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/joeskye1701">
                关注我</a>
        </div>
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Github" href="https://github.com/joeskye1701">
                
                <i class="fab fa-github"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        

<div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            链接
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="http://wss.xxyseo.cn/" target="_blank">
                    <span class="level-left">
                        <span class="level-item">西乡大佬</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">wss.xxyseo.cn</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>


    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                分类
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/Android/">
            <span class="level-start">
                <span class="level-item">Android</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JDK6-源码/">
            <span class="level-start">
                <span class="level-item">JDK6 源码</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">18</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JDK7-源码/">
            <span class="level-start">
                <span class="level-item">JDK7 源码</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JDK8-源码/">
            <span class="level-start">
                <span class="level-item">JDK8 源码</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JMM/">
            <span class="level-start">
                <span class="level-item">JMM</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/JVM/">
            <span class="level-start">
                <span class="level-item">JVM</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">10</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Java/">
            <span class="level-start">
                <span class="level-item">Java</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">20</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Linux/">
            <span class="level-start">
                <span class="level-item">Linux</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/MyBatis/">
            <span class="level-start">
                <span class="level-item">MyBatis</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/MySQL/">
            <span class="level-start">
                <span class="level-item">MySQL</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Redis/">
            <span class="level-start">
                <span class="level-item">Redis</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Spring/">
            <span class="level-start">
                <span class="level-item">Spring</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Tomcat/">
            <span class="level-start">
                <span class="level-item">Tomcat</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">7</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/书/">
            <span class="level-start">
                <span class="level-item">书</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/多线程/">
            <span class="level-start">
                <span class="level-item">多线程</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/并发/">
            <span class="level-start">
                <span class="level-item">并发</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/开源项目/">
            <span class="level-start">
                <span class="level-item">开源项目</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/数学/">
            <span class="level-start">
                <span class="level-item">数学</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/数据库/">
            <span class="level-start">
                <span class="level-item">数据库</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/数据结构/">
            <span class="level-start">
                <span class="level-item">数据结构</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">5</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/日语/">
            <span class="level-start">
                <span class="level-item">日语</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/机器学习/">
            <span class="level-start">
                <span class="level-item">机器学习</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/算法/">
            <span class="level-start">
                <span class="level-item">算法</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">23</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/计算机基础/">
            <span class="level-start">
                <span class="level-item">计算机基础</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/设计模式/">
            <span class="level-start">
                <span class="level-item">设计模式</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/面试/">
            <span class="level-start">
                <span class="level-item">面试</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            标签云
        </h3>
        <a href="/tags/Android/" style="font-size: 10px;">Android</a> <a href="/tags/Centos/" style="font-size: 11.82px;">Centos</a> <a href="/tags/Effect-Java/" style="font-size: 10.91px;">Effect Java</a> <a href="/tags/JDK6-源码/" style="font-size: 18.18px;">JDK6 源码</a> <a href="/tags/JDK7-源码/" style="font-size: 14.55px;">JDK7 源码</a> <a href="/tags/JDK8-源码/" style="font-size: 10px;">JDK8 源码</a> <a href="/tags/JMM/" style="font-size: 15.45px;">JMM</a> <a href="/tags/JVM/" style="font-size: 16.36px;">JVM</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/Linux/" style="font-size: 12.73px;">Linux</a> <a href="/tags/MongoDB/" style="font-size: 10px;">MongoDB</a> <a href="/tags/Mongodb/" style="font-size: 10px;">Mongodb</a> <a href="/tags/MyBatis/" style="font-size: 11.82px;">MyBatis</a> <a href="/tags/MySQL/" style="font-size: 10.91px;">MySQL</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/Spring/" style="font-size: 12.73px;">Spring</a> <a href="/tags/Think-In-Java/" style="font-size: 10px;">Think In Java</a> <a href="/tags/Tomcat/" style="font-size: 15.45px;">Tomcat</a> <a href="/tags/Ubuntu/" style="font-size: 10px;">Ubuntu</a> <a href="/tags/一致性哈希算法/" style="font-size: 10px;">一致性哈希算法</a> <a href="/tags/书/" style="font-size: 11.82px;">书</a> <a href="/tags/倒排索引/" style="font-size: 10px;">倒排索引</a> <a href="/tags/内存泄漏/" style="font-size: 10px;">内存泄漏</a> <a href="/tags/分支限界算法/" style="font-size: 10.91px;">分支限界算法</a> <a href="/tags/分治法/" style="font-size: 10px;">分治法</a> <a href="/tags/分治算法/" style="font-size: 10px;">分治算法</a> <a href="/tags/分词算法/" style="font-size: 10.91px;">分词算法</a> <a href="/tags/动态规划/" style="font-size: 10px;">动态规划</a> <a href="/tags/动态规划算法/" style="font-size: 10.91px;">动态规划算法</a> <a href="/tags/华为/" style="font-size: 10px;">华为</a> <a href="/tags/回溯算法/" style="font-size: 12.73px;">回溯算法</a> <a href="/tags/多线程/" style="font-size: 10.91px;">多线程</a> <a href="/tags/工具/" style="font-size: 10px;">工具</a> <a href="/tags/并发/" style="font-size: 13.64px;">并发</a> <a href="/tags/开源项目/" style="font-size: 17.27px;">开源项目</a> <a href="/tags/手机游戏/" style="font-size: 10px;">手机游戏</a> <a href="/tags/排序算法/" style="font-size: 10px;">排序算法</a> <a href="/tags/推荐/" style="font-size: 10px;">推荐</a> <a href="/tags/散列表/" style="font-size: 10px;">散列表</a> <a href="/tags/数学/" style="font-size: 10px;">数学</a> <a href="/tags/数据库/" style="font-size: 10.91px;">数据库</a> <a href="/tags/数据结构/" style="font-size: 13.64px;">数据结构</a> <a href="/tags/日语/" style="font-size: 10px;">日语</a> <a href="/tags/最优路径算法/" style="font-size: 10px;">最优路径算法</a> <a href="/tags/机器学习/" style="font-size: 10px;">机器学习</a> <a href="/tags/源码/" style="font-size: 11.82px;">源码</a> <a href="/tags/算法/" style="font-size: 19.09px;">算法</a> <a href="/tags/线程安全/" style="font-size: 10.91px;">线程安全</a> <a href="/tags/编程珠玑/" style="font-size: 11.82px;">编程珠玑</a> <a href="/tags/计算机基础/" style="font-size: 10px;">计算机基础</a> <a href="/tags/设计模式/" style="font-size: 12.73px;">设计模式</a> <a href="/tags/贪心算法/" style="font-size: 11.82px;">贪心算法</a> <a href="/tags/跳表/" style="font-size: 10px;">跳表</a> <a href="/tags/面试/" style="font-size: 10px;">面试</a>
    </div>
</div>

    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            
<div class="card widget" id="toc">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                目录
            </h3>
            <ul class="menu-list"><li>
        <a class="is-flex" href="#1-介绍">
        <span class="has-mr-6">1</span>
        <span>1 介绍</span>
        </a></li><li>
        <a class="is-flex" href="#2-源码分析">
        <span class="has-mr-6">2</span>
        <span>2 源码分析</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#Executor">
        <span class="has-mr-6">2.1</span>
        <span>Executor</span>
        </a></li><li>
        <a class="is-flex" href="#ExecutorService">
        <span class="has-mr-6">2.2</span>
        <span>ExecutorService</span>
        </a></li><li>
        <a class="is-flex" href="#AbstractExecutorService-newTaskFor">
        <span class="has-mr-6">2.3</span>
        <span>AbstractExecutorService#newTaskFor</span>
        </a></li><li>
        <a class="is-flex" href="#AbstractExecutorService-submit">
        <span class="has-mr-6">2.4</span>
        <span>AbstractExecutorService#submit</span>
        </a></li><li>
        <a class="is-flex" href="#AbstractExecutorService-doInvokeAny">
        <span class="has-mr-6">2.5</span>
        <span>AbstractExecutorService#doInvokeAny()</span>
        </a></li><li>
        <a class="is-flex" href="#AbstractExecutorService-invokeAny">
        <span class="has-mr-6">2.6</span>
        <span>AbstractExecutorService#invokeAny()</span>
        </a></li><li>
        <a class="is-flex" href="#AbstractExecutorService-invokeAll">
        <span class="has-mr-6">2.7</span>
        <span>AbstractExecutorService#invokeAll()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor">
        <span class="has-mr-6">2.8</span>
        <span>ThreadPoolExecutor</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-构造函数">
        <span class="has-mr-6">2.9</span>
        <span>ThreadPoolExecutor 构造函数</span>
        </a></li><li>
        <a class="is-flex" href="#Executors-defaultThreadFactory">
        <span class="has-mr-6">2.10</span>
        <span>Executors#defaultThreadFactory()</span>
        </a></li><li>
        <a class="is-flex" href="#Executors-DefaultThreadFactory">
        <span class="has-mr-6">2.11</span>
        <span>Executors#DefaultThreadFactory</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-execute">
        <span class="has-mr-6">2.12</span>
        <span>ThreadPoolExecutor#execute()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-addIfUnderCorePoolSize">
        <span class="has-mr-6">2.13</span>
        <span>ThreadPoolExecutor#addIfUnderCorePoolSize()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-addThread">
        <span class="has-mr-6">2.14</span>
        <span>ThreadPoolExecutor#addThread()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-Worker">
        <span class="has-mr-6">2.15</span>
        <span>ThreadPoolExecutor#Worker</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-beforeExecute">
        <span class="has-mr-6">2.16</span>
        <span>ThreadPoolExecutor#beforeExecute()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-afterExecute">
        <span class="has-mr-6">2.17</span>
        <span>ThreadPoolExecutor#afterExecute()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-getTask">
        <span class="has-mr-6">2.18</span>
        <span>ThreadPoolExecutor#getTask()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-workerCanExit">
        <span class="has-mr-6">2.19</span>
        <span>ThreadPoolExecutor#workerCanExit()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-interruptIdleWorkers">
        <span class="has-mr-6">2.20</span>
        <span>ThreadPoolExecutor#interruptIdleWorkers()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-workerDone">
        <span class="has-mr-6">2.21</span>
        <span>ThreadPoolExecutor#workerDone()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-tryTerminate">
        <span class="has-mr-6">2.22</span>
        <span>ThreadPoolExecutor#tryTerminate()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-ensureQueuedTaskHandled">
        <span class="has-mr-6">2.23</span>
        <span>ThreadPoolExecutor#ensureQueuedTaskHandled()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-addIfUnderMaximumPoolSize">
        <span class="has-mr-6">2.24</span>
        <span>ThreadPoolExecutor#addIfUnderMaximumPoolSize()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-shutdown">
        <span class="has-mr-6">2.25</span>
        <span>ThreadPoolExecutor#shutdown()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-shutdownNow">
        <span class="has-mr-6">2.26</span>
        <span>ThreadPoolExecutor#shutdownNow()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-drainQueue">
        <span class="has-mr-6">2.27</span>
        <span>ThreadPoolExecutor#drainQueue()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-awaitTermination">
        <span class="has-mr-6">2.28</span>
        <span>ThreadPoolExecutor#awaitTermination()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-finalize">
        <span class="has-mr-6">2.29</span>
        <span>ThreadPoolExecutor#finalize()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-prestartCoreThread">
        <span class="has-mr-6">2.30</span>
        <span>ThreadPoolExecutor#prestartCoreThread()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-prestartAllCoreThreads">
        <span class="has-mr-6">2.31</span>
        <span>ThreadPoolExecutor#prestartAllCoreThreads()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-setCorePoolSize">
        <span class="has-mr-6">2.32</span>
        <span>ThreadPoolExecutor#setCorePoolSize()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-setMaximumPoolSize">
        <span class="has-mr-6">2.33</span>
        <span>ThreadPoolExecutor#setMaximumPoolSize()</span>
        </a></li><li>
        <a class="is-flex" href="#实现RejectedExecutionHandler接口">
        <span class="has-mr-6">2.34</span>
        <span>实现RejectedExecutionHandler接口</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#ThreadPoolExecutor-AbortPolicy">
        <span class="has-mr-6">2.34.1</span>
        <span>ThreadPoolExecutor#AbortPolicy</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-CallerRunsPolicy">
        <span class="has-mr-6">2.34.2</span>
        <span>ThreadPoolExecutor#CallerRunsPolicy</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-DiscardPolicy">
        <span class="has-mr-6">2.34.3</span>
        <span>ThreadPoolExecutor#DiscardPolicy</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-DiscardOldestPolicy">
        <span class="has-mr-6">2.34.4</span>
        <span>ThreadPoolExecutor#DiscardOldestPolicy</span>
        </a></li></ul></li></ul></li><li>
        <a class="is-flex" href="#3-总结">
        <span class="has-mr-6">3</span>
        <span>3 总结</span>
        </a></li></ul>
        </div>
    </div>
</div>

        
            
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            <!-- 
            <a href="/VIM-Command/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="VIM 命令">
                </p>
            </a>
             -->
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-12-10T02:31:22.000Z">2018-12-10</time></div>
                    <a href="/VIM-Command/" class="has-link-black-ter is-size-6">VIM 命令</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Linux/">Linux</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            <!-- 
            <a href="/Lock-Control/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="锁粒度的控制">
                </p>
            </a>
             -->
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-04T04:37:22.000Z">2018-11-04</time></div>
                    <a href="/Lock-Control/" class="has-link-black-ter is-size-6">锁粒度的控制</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Linux/">Linux</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            <!-- 
            <a href="/Temporary-Menory-Table/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="临时表和内存表">
                </p>
            </a>
             -->
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-04T04:37:22.000Z">2018-11-04</time></div>
                    <a href="/Temporary-Menory-Table/" class="has-link-black-ter is-size-6">临时表和内存表</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/MySQL/">MySQL</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            <!-- 
            <a href="/MySQL-Command/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="MySQL基本命令">
                </p>
            </a>
             -->
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-03T04:37:22.000Z">2018-11-03</time></div>
                    <a href="/MySQL-Command/" class="has-link-black-ter is-size-6">MySQL基本命令</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/MySQL/">MySQL</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            <!-- 
            <a href="/Centos-Line/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Centos命令行图形界面切换">
                </p>
            </a>
             -->
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-03T04:37:22.000Z">2018-11-03</time></div>
                    <a href="/Centos-Line/" class="has-link-black-ter is-size-6">Centos命令行图形界面切换</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Linux/">Linux</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2018/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">一月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/01/">
                <span class="level-start">
                    <span class="level-item">一月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/10/">
                <span class="level-start">
                    <span class="level-item">十月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">9</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/09/">
                <span class="level-start">
                    <span class="level-item">九月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">八月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/07/">
                <span class="level-start">
                    <span class="level-item">七月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/06/">
                <span class="level-start">
                    <span class="level-item">六月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/05/">
                <span class="level-start">
                    <span class="level-item">五月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/04/">
                <span class="level-start">
                    <span class="level-item">四月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/03/">
                <span class="level-start">
                    <span class="level-item">三月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/02/">
                <span class="level-start">
                    <span class="level-item">二月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/10/">
                <span class="level-start">
                    <span class="level-item">十月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">13</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/09/">
                <span class="level-start">
                    <span class="level-item">九月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/08/">
                <span class="level-start">
                    <span class="level-item">八月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/07/">
                <span class="level-start">
                    <span class="level-item">七月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/06/">
                <span class="level-start">
                    <span class="level-item">六月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/05/">
                <span class="level-start">
                    <span class="level-item">五月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/04/">
                <span class="level-start">
                    <span class="level-item">四月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/03/">
                <span class="level-start">
                    <span class="level-item">三月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/02/">
                <span class="level-start">
                    <span class="level-item">二月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/01/">
                <span class="level-start">
                    <span class="level-item">一月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/09/">
                <span class="level-start">
                    <span class="level-item">九月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/03/">
                <span class="level-start">
                    <span class="level-item">三月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/10/">
                <span class="level-start">
                    <span class="level-item">十月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/08/">
                <span class="level-start">
                    <span class="level-item">八月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/07/">
                <span class="level-start">
                    <span class="level-item">七月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/06/">
                <span class="level-start">
                    <span class="level-item">六月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/04/">
                <span class="level-start">
                    <span class="level-item">四月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/03/">
                <span class="level-start">
                    <span class="level-item">三月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/02/">
                <span class="level-start">
                    <span class="level-item">二月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/01/">
                <span class="level-start">
                    <span class="level-item">一月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Android/">
                        <span class="tag">Android</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Centos/">
                        <span class="tag">Centos</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Effect-Java/">
                        <span class="tag">Effect Java</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JDK6-源码/">
                        <span class="tag">JDK6 源码</span>
                        <span class="tag is-grey">18</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JDK7-源码/">
                        <span class="tag">JDK7 源码</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JDK8-源码/">
                        <span class="tag">JDK8 源码</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JMM/">
                        <span class="tag">JMM</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JVM/">
                        <span class="tag">JVM</span>
                        <span class="tag is-grey">10</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Java/">
                        <span class="tag">Java</span>
                        <span class="tag is-grey">40</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Linux/">
                        <span class="tag">Linux</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MongoDB/">
                        <span class="tag">MongoDB</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Mongodb/">
                        <span class="tag">Mongodb</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MyBatis/">
                        <span class="tag">MyBatis</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MySQL/">
                        <span class="tag">MySQL</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Redis/">
                        <span class="tag">Redis</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Spring/">
                        <span class="tag">Spring</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Think-In-Java/">
                        <span class="tag">Think In Java</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Tomcat/">
                        <span class="tag">Tomcat</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Ubuntu/">
                        <span class="tag">Ubuntu</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/一致性哈希算法/">
                        <span class="tag">一致性哈希算法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/书/">
                        <span class="tag">书</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/倒排索引/">
                        <span class="tag">倒排索引</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/内存泄漏/">
                        <span class="tag">内存泄漏</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/分支限界算法/">
                        <span class="tag">分支限界算法</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/分治法/">
                        <span class="tag">分治法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/分治算法/">
                        <span class="tag">分治算法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/分词算法/">
                        <span class="tag">分词算法</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/动态规划/">
                        <span class="tag">动态规划</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/动态规划算法/">
                        <span class="tag">动态规划算法</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/华为/">
                        <span class="tag">华为</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/回溯算法/">
                        <span class="tag">回溯算法</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/多线程/">
                        <span class="tag">多线程</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/工具/">
                        <span class="tag">工具</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/并发/">
                        <span class="tag">并发</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/开源项目/">
                        <span class="tag">开源项目</span>
                        <span class="tag is-grey">17</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/手机游戏/">
                        <span class="tag">手机游戏</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/排序算法/">
                        <span class="tag">排序算法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/推荐/">
                        <span class="tag">推荐</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/散列表/">
                        <span class="tag">散列表</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数学/">
                        <span class="tag">数学</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数据库/">
                        <span class="tag">数据库</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数据结构/">
                        <span class="tag">数据结构</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/日语/">
                        <span class="tag">日语</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/最优路径算法/">
                        <span class="tag">最优路径算法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/机器学习/">
                        <span class="tag">机器学习</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/源码/">
                        <span class="tag">源码</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/算法/">
                        <span class="tag">算法</span>
                        <span class="tag is-grey">26</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/线程安全/">
                        <span class="tag">线程安全</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/编程珠玑/">
                        <span class="tag">编程珠玑</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/计算机基础/">
                        <span class="tag">计算机基础</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/设计模式/">
                        <span class="tag">设计模式</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/贪心算法/">
                        <span class="tag">贪心算法</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/跳表/">
                        <span class="tag">跳表</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/面试/">
                        <span class="tag">面试</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        
<div class="card widget" id="toc">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                目录
            </h3>
            <ul class="menu-list"><li>
        <a class="is-flex" href="#1-介绍">
        <span class="has-mr-6">1</span>
        <span>1 介绍</span>
        </a></li><li>
        <a class="is-flex" href="#2-源码分析">
        <span class="has-mr-6">2</span>
        <span>2 源码分析</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#Executor">
        <span class="has-mr-6">2.1</span>
        <span>Executor</span>
        </a></li><li>
        <a class="is-flex" href="#ExecutorService">
        <span class="has-mr-6">2.2</span>
        <span>ExecutorService</span>
        </a></li><li>
        <a class="is-flex" href="#AbstractExecutorService-newTaskFor">
        <span class="has-mr-6">2.3</span>
        <span>AbstractExecutorService#newTaskFor</span>
        </a></li><li>
        <a class="is-flex" href="#AbstractExecutorService-submit">
        <span class="has-mr-6">2.4</span>
        <span>AbstractExecutorService#submit</span>
        </a></li><li>
        <a class="is-flex" href="#AbstractExecutorService-doInvokeAny">
        <span class="has-mr-6">2.5</span>
        <span>AbstractExecutorService#doInvokeAny()</span>
        </a></li><li>
        <a class="is-flex" href="#AbstractExecutorService-invokeAny">
        <span class="has-mr-6">2.6</span>
        <span>AbstractExecutorService#invokeAny()</span>
        </a></li><li>
        <a class="is-flex" href="#AbstractExecutorService-invokeAll">
        <span class="has-mr-6">2.7</span>
        <span>AbstractExecutorService#invokeAll()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor">
        <span class="has-mr-6">2.8</span>
        <span>ThreadPoolExecutor</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-构造函数">
        <span class="has-mr-6">2.9</span>
        <span>ThreadPoolExecutor 构造函数</span>
        </a></li><li>
        <a class="is-flex" href="#Executors-defaultThreadFactory">
        <span class="has-mr-6">2.10</span>
        <span>Executors#defaultThreadFactory()</span>
        </a></li><li>
        <a class="is-flex" href="#Executors-DefaultThreadFactory">
        <span class="has-mr-6">2.11</span>
        <span>Executors#DefaultThreadFactory</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-execute">
        <span class="has-mr-6">2.12</span>
        <span>ThreadPoolExecutor#execute()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-addIfUnderCorePoolSize">
        <span class="has-mr-6">2.13</span>
        <span>ThreadPoolExecutor#addIfUnderCorePoolSize()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-addThread">
        <span class="has-mr-6">2.14</span>
        <span>ThreadPoolExecutor#addThread()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-Worker">
        <span class="has-mr-6">2.15</span>
        <span>ThreadPoolExecutor#Worker</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-beforeExecute">
        <span class="has-mr-6">2.16</span>
        <span>ThreadPoolExecutor#beforeExecute()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-afterExecute">
        <span class="has-mr-6">2.17</span>
        <span>ThreadPoolExecutor#afterExecute()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-getTask">
        <span class="has-mr-6">2.18</span>
        <span>ThreadPoolExecutor#getTask()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-workerCanExit">
        <span class="has-mr-6">2.19</span>
        <span>ThreadPoolExecutor#workerCanExit()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-interruptIdleWorkers">
        <span class="has-mr-6">2.20</span>
        <span>ThreadPoolExecutor#interruptIdleWorkers()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-workerDone">
        <span class="has-mr-6">2.21</span>
        <span>ThreadPoolExecutor#workerDone()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-tryTerminate">
        <span class="has-mr-6">2.22</span>
        <span>ThreadPoolExecutor#tryTerminate()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-ensureQueuedTaskHandled">
        <span class="has-mr-6">2.23</span>
        <span>ThreadPoolExecutor#ensureQueuedTaskHandled()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-addIfUnderMaximumPoolSize">
        <span class="has-mr-6">2.24</span>
        <span>ThreadPoolExecutor#addIfUnderMaximumPoolSize()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-shutdown">
        <span class="has-mr-6">2.25</span>
        <span>ThreadPoolExecutor#shutdown()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-shutdownNow">
        <span class="has-mr-6">2.26</span>
        <span>ThreadPoolExecutor#shutdownNow()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-drainQueue">
        <span class="has-mr-6">2.27</span>
        <span>ThreadPoolExecutor#drainQueue()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-awaitTermination">
        <span class="has-mr-6">2.28</span>
        <span>ThreadPoolExecutor#awaitTermination()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-finalize">
        <span class="has-mr-6">2.29</span>
        <span>ThreadPoolExecutor#finalize()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-prestartCoreThread">
        <span class="has-mr-6">2.30</span>
        <span>ThreadPoolExecutor#prestartCoreThread()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-prestartAllCoreThreads">
        <span class="has-mr-6">2.31</span>
        <span>ThreadPoolExecutor#prestartAllCoreThreads()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-setCorePoolSize">
        <span class="has-mr-6">2.32</span>
        <span>ThreadPoolExecutor#setCorePoolSize()</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-setMaximumPoolSize">
        <span class="has-mr-6">2.33</span>
        <span>ThreadPoolExecutor#setMaximumPoolSize()</span>
        </a></li><li>
        <a class="is-flex" href="#实现RejectedExecutionHandler接口">
        <span class="has-mr-6">2.34</span>
        <span>实现RejectedExecutionHandler接口</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#ThreadPoolExecutor-AbortPolicy">
        <span class="has-mr-6">2.34.1</span>
        <span>ThreadPoolExecutor#AbortPolicy</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-CallerRunsPolicy">
        <span class="has-mr-6">2.34.2</span>
        <span>ThreadPoolExecutor#CallerRunsPolicy</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-DiscardPolicy">
        <span class="has-mr-6">2.34.3</span>
        <span>ThreadPoolExecutor#DiscardPolicy</span>
        </a></li><li>
        <a class="is-flex" href="#ThreadPoolExecutor-DiscardOldestPolicy">
        <span class="has-mr-6">2.34.4</span>
        <span>ThreadPoolExecutor#DiscardOldestPolicy</span>
        </a></li></ul></li></ul></li><li>
        <a class="is-flex" href="#3-总结">
        <span class="has-mr-6">3</span>
        <span>3 总结</span>
        </a></li></ul>
        </div>
    </div>
</div>

    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            <!-- 
            <a href="/VIM-Command/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="VIM 命令">
                </p>
            </a>
             -->
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-12-10T02:31:22.000Z">2018-12-10</time></div>
                    <a href="/VIM-Command/" class="has-link-black-ter is-size-6">VIM 命令</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Linux/">Linux</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            <!-- 
            <a href="/Lock-Control/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="锁粒度的控制">
                </p>
            </a>
             -->
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-04T04:37:22.000Z">2018-11-04</time></div>
                    <a href="/Lock-Control/" class="has-link-black-ter is-size-6">锁粒度的控制</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Linux/">Linux</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            <!-- 
            <a href="/Temporary-Menory-Table/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="临时表和内存表">
                </p>
            </a>
             -->
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-04T04:37:22.000Z">2018-11-04</time></div>
                    <a href="/Temporary-Menory-Table/" class="has-link-black-ter is-size-6">临时表和内存表</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/MySQL/">MySQL</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            <!-- 
            <a href="/MySQL-Command/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="MySQL基本命令">
                </p>
            </a>
             -->
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-03T04:37:22.000Z">2018-11-03</time></div>
                    <a href="/MySQL-Command/" class="has-link-black-ter is-size-6">MySQL基本命令</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/MySQL/">MySQL</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            <!-- 
            <a href="/Centos-Line/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Centos命令行图形界面切换">
                </p>
            </a>
             -->
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2018-11-03T04:37:22.000Z">2018-11-03</time></div>
                    <a href="/Centos-Line/" class="has-link-black-ter is-size-6">Centos命令行图形界面切换</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Linux/">Linux</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2018/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">一月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/01/">
                <span class="level-start">
                    <span class="level-item">一月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/10/">
                <span class="level-start">
                    <span class="level-item">十月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">9</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/09/">
                <span class="level-start">
                    <span class="level-item">九月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">八月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/07/">
                <span class="level-start">
                    <span class="level-item">七月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/06/">
                <span class="level-start">
                    <span class="level-item">六月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/05/">
                <span class="level-start">
                    <span class="level-item">五月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/04/">
                <span class="level-start">
                    <span class="level-item">四月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/03/">
                <span class="level-start">
                    <span class="level-item">三月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/02/">
                <span class="level-start">
                    <span class="level-item">二月 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/10/">
                <span class="level-start">
                    <span class="level-item">十月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">13</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/09/">
                <span class="level-start">
                    <span class="level-item">九月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/08/">
                <span class="level-start">
                    <span class="level-item">八月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/07/">
                <span class="level-start">
                    <span class="level-item">七月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/06/">
                <span class="level-start">
                    <span class="level-item">六月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/05/">
                <span class="level-start">
                    <span class="level-item">五月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/04/">
                <span class="level-start">
                    <span class="level-item">四月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/03/">
                <span class="level-start">
                    <span class="level-item">三月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/02/">
                <span class="level-start">
                    <span class="level-item">二月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2015/01/">
                <span class="level-start">
                    <span class="level-item">一月 2015</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/09/">
                <span class="level-start">
                    <span class="level-item">九月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2014/03/">
                <span class="level-start">
                    <span class="level-item">三月 2014</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/10/">
                <span class="level-start">
                    <span class="level-item">十月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/08/">
                <span class="level-start">
                    <span class="level-item">八月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/07/">
                <span class="level-start">
                    <span class="level-item">七月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/06/">
                <span class="level-start">
                    <span class="level-item">六月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/04/">
                <span class="level-start">
                    <span class="level-item">四月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/03/">
                <span class="level-start">
                    <span class="level-item">三月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/02/">
                <span class="level-start">
                    <span class="level-item">二月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2013/01/">
                <span class="level-start">
                    <span class="level-item">一月 2013</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Android/">
                        <span class="tag">Android</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Centos/">
                        <span class="tag">Centos</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Effect-Java/">
                        <span class="tag">Effect Java</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JDK6-源码/">
                        <span class="tag">JDK6 源码</span>
                        <span class="tag is-grey">18</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JDK7-源码/">
                        <span class="tag">JDK7 源码</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JDK8-源码/">
                        <span class="tag">JDK8 源码</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JMM/">
                        <span class="tag">JMM</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JVM/">
                        <span class="tag">JVM</span>
                        <span class="tag is-grey">10</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Java/">
                        <span class="tag">Java</span>
                        <span class="tag is-grey">40</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Linux/">
                        <span class="tag">Linux</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MongoDB/">
                        <span class="tag">MongoDB</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Mongodb/">
                        <span class="tag">Mongodb</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MyBatis/">
                        <span class="tag">MyBatis</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MySQL/">
                        <span class="tag">MySQL</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Redis/">
                        <span class="tag">Redis</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Spring/">
                        <span class="tag">Spring</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Think-In-Java/">
                        <span class="tag">Think In Java</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Tomcat/">
                        <span class="tag">Tomcat</span>
                        <span class="tag is-grey">7</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Ubuntu/">
                        <span class="tag">Ubuntu</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/一致性哈希算法/">
                        <span class="tag">一致性哈希算法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/书/">
                        <span class="tag">书</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/倒排索引/">
                        <span class="tag">倒排索引</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/内存泄漏/">
                        <span class="tag">内存泄漏</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/分支限界算法/">
                        <span class="tag">分支限界算法</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/分治法/">
                        <span class="tag">分治法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/分治算法/">
                        <span class="tag">分治算法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/分词算法/">
                        <span class="tag">分词算法</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/动态规划/">
                        <span class="tag">动态规划</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/动态规划算法/">
                        <span class="tag">动态规划算法</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/华为/">
                        <span class="tag">华为</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/回溯算法/">
                        <span class="tag">回溯算法</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/多线程/">
                        <span class="tag">多线程</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/工具/">
                        <span class="tag">工具</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/并发/">
                        <span class="tag">并发</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/开源项目/">
                        <span class="tag">开源项目</span>
                        <span class="tag is-grey">17</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/手机游戏/">
                        <span class="tag">手机游戏</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/排序算法/">
                        <span class="tag">排序算法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/推荐/">
                        <span class="tag">推荐</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/散列表/">
                        <span class="tag">散列表</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数学/">
                        <span class="tag">数学</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数据库/">
                        <span class="tag">数据库</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数据结构/">
                        <span class="tag">数据结构</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/日语/">
                        <span class="tag">日语</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/最优路径算法/">
                        <span class="tag">最优路径算法</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/机器学习/">
                        <span class="tag">机器学习</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/源码/">
                        <span class="tag">源码</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/算法/">
                        <span class="tag">算法</span>
                        <span class="tag is-grey">26</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/线程安全/">
                        <span class="tag">线程安全</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/编程珠玑/">
                        <span class="tag">编程珠玑</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/计算机基础/">
                        <span class="tag">计算机基础</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/设计模式/">
                        <span class="tag">设计模式</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/贪心算法/">
                        <span class="tag">贪心算法</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/跳表/">
                        <span class="tag">跳表</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/面试/">
                        <span class="tag">面试</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    Joe|博客
                
                </a>
                <p class="is-size-7">
                &copy; 2019 Joe&nbsp;
                <!-- Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        href="http://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a> -->
                
                </p>
            </div>
            <div class="level-end">
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>


    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    <script src="/js/clipboard.js" defer></script>
    

    
    
    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么...">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>